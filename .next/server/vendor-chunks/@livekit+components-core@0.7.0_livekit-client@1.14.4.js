"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@livekit+components-core@0.7.0_livekit-client@1.14.4";
exports.ids = ["vendor-chunks/@livekit+components-core@0.7.0_livekit-client@1.14.4"];
exports.modules = {

/***/ "(ssr)/./node_modules/.pnpm/@livekit+components-core@0.7.0_livekit-client@1.14.4/node_modules/@livekit/components-core/dist/index.mjs":
/*!**************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@livekit+components-core@0.7.0_livekit-client@1.14.4/node_modules/@livekit/components-core/dist/index.mjs ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DataTopic: () => (/* binding */ DataTopic),\n/* harmony export */   GRID_LAYOUTS: () => (/* binding */ GRID_LAYOUTS),\n/* harmony export */   PIN_DEFAULT_STATE: () => (/* binding */ PIN_DEFAULT_STATE),\n/* harmony export */   WIDGET_DEFAULT_STATE: () => (/* binding */ WIDGET_DEFAULT_STATE),\n/* harmony export */   activeSpeakerObserver: () => (/* binding */ activeSpeakerObserver),\n/* harmony export */   allParticipantEvents: () => (/* binding */ allParticipantEvents),\n/* harmony export */   allParticipantRoomEvents: () => (/* binding */ allParticipantRoomEvents),\n/* harmony export */   allRemoteParticipantEvents: () => (/* binding */ allRemoteParticipantEvents),\n/* harmony export */   allRemoteParticipantRoomEvents: () => (/* binding */ allRemoteParticipantRoomEvents),\n/* harmony export */   attachIfSubscribed: () => (/* binding */ attachIfSubscribed),\n/* harmony export */   computeMenuPosition: () => (/* binding */ computeMenuPosition),\n/* harmony export */   connectedParticipantObserver: () => (/* binding */ connectedParticipantObserver),\n/* harmony export */   connectedParticipantsObserver: () => (/* binding */ connectedParticipantsObserver),\n/* harmony export */   connectionStateObserver: () => (/* binding */ connectionStateObserver),\n/* harmony export */   createActiveDeviceObservable: () => (/* binding */ createActiveDeviceObservable),\n/* harmony export */   createConnectionQualityObserver: () => (/* binding */ createConnectionQualityObserver),\n/* harmony export */   createDataObserver: () => (/* binding */ createDataObserver),\n/* harmony export */   createDefaultGrammar: () => (/* binding */ createDefaultGrammar),\n/* harmony export */   createEmailRegExp: () => (/* reexport safe */ email_regex__WEBPACK_IMPORTED_MODULE_2__[\"default\"]),\n/* harmony export */   createInteractingObservable: () => (/* binding */ createInteractingObservable),\n/* harmony export */   createIsSpeakingObserver: () => (/* binding */ createIsSpeakingObserver),\n/* harmony export */   createMediaDeviceObserver: () => (/* binding */ createMediaDeviceObserver),\n/* harmony export */   createTrackObserver: () => (/* binding */ createTrackObserver),\n/* harmony export */   createUrlRegExp: () => (/* binding */ createUrlRegExp),\n/* harmony export */   cssPrefix: () => (/* binding */ cssPrefix),\n/* harmony export */   encryptionStatusObservable: () => (/* binding */ encryptionStatusObservable),\n/* harmony export */   getScrollBarWidth: () => (/* binding */ getScrollBarWidth),\n/* harmony export */   getTrackByIdentifier: () => (/* binding */ getTrackByIdentifier),\n/* harmony export */   getTrackReferenceId: () => (/* binding */ getTrackReferenceId),\n/* harmony export */   getTrackReferenceSource: () => (/* binding */ getTrackReferenceSource),\n/* harmony export */   isEqualTrackRef: () => (/* binding */ isEqualTrackRef),\n/* harmony export */   isLocal: () => (/* binding */ isLocal),\n/* harmony export */   isMobileBrowser: () => (/* binding */ isMobileBrowser),\n/* harmony export */   isParticipantSourcePinned: () => (/* binding */ isParticipantSourcePinned),\n/* harmony export */   isParticipantTrackReferencePinned: () => (/* binding */ isParticipantTrackReferencePinned),\n/* harmony export */   isPlaceholderReplacement: () => (/* binding */ isPlaceholderReplacement),\n/* harmony export */   isRemote: () => (/* binding */ isRemote),\n/* harmony export */   isSourceWitOptions: () => (/* binding */ isSourceWitOptions),\n/* harmony export */   isSourcesWithOptions: () => (/* binding */ isSourcesWithOptions),\n/* harmony export */   isTrackReference: () => (/* binding */ isTrackReference),\n/* harmony export */   isTrackReferencePinned: () => (/* binding */ isTrackReferencePinned),\n/* harmony export */   isTrackReferencePlaceholder: () => (/* binding */ isTrackReferencePlaceholder),\n/* harmony export */   isWeb: () => (/* binding */ isWeb),\n/* harmony export */   log: () => (/* binding */ log),\n/* harmony export */   mutedObserver: () => (/* binding */ mutedObserver),\n/* harmony export */   observeParticipantEvents: () => (/* binding */ observeParticipantEvents),\n/* harmony export */   observeParticipantMedia: () => (/* binding */ observeParticipantMedia),\n/* harmony export */   observeRoomEvents: () => (/* binding */ observeRoomEvents),\n/* harmony export */   observeTrackEvents: () => (/* binding */ observeTrackEvents),\n/* harmony export */   participantEventSelector: () => (/* binding */ participantEventSelector),\n/* harmony export */   participantInfoObserver: () => (/* binding */ participantInfoObserver),\n/* harmony export */   participantPermissionObserver: () => (/* binding */ participantPermissionObserver),\n/* harmony export */   roomAudioPlaybackAllowedObservable: () => (/* binding */ roomAudioPlaybackAllowedObservable),\n/* harmony export */   roomEventSelector: () => (/* binding */ roomEventSelector),\n/* harmony export */   roomInfoObserver: () => (/* binding */ roomInfoObserver),\n/* harmony export */   roomObserver: () => (/* binding */ roomObserver),\n/* harmony export */   screenShareObserver: () => (/* binding */ screenShareObserver),\n/* harmony export */   selectGridLayout: () => (/* binding */ selectGridLayout),\n/* harmony export */   sendMessage: () => (/* binding */ sendMessage),\n/* harmony export */   setDifference: () => (/* binding */ setDifference),\n/* harmony export */   setLogLevel: () => (/* binding */ setLogLevel),\n/* harmony export */   setupChat: () => (/* binding */ setupChat),\n/* harmony export */   setupChatToggle: () => (/* binding */ setupChatToggle),\n/* harmony export */   setupClearPinButton: () => (/* binding */ setupClearPinButton),\n/* harmony export */   setupConnectionQualityIndicator: () => (/* binding */ setupConnectionQualityIndicator),\n/* harmony export */   setupDataMessageHandler: () => (/* binding */ setupDataMessageHandler),\n/* harmony export */   setupDeviceSelector: () => (/* binding */ setupDeviceSelector),\n/* harmony export */   setupDisconnectButton: () => (/* binding */ setupDisconnectButton),\n/* harmony export */   setupFocusToggle: () => (/* binding */ setupFocusToggle),\n/* harmony export */   setupLiveKitRoom: () => (/* binding */ setupLiveKitRoom),\n/* harmony export */   setupManualToggle: () => (/* binding */ setupManualToggle),\n/* harmony export */   setupMediaToggle: () => (/* binding */ setupMediaToggle),\n/* harmony export */   setupMediaTrack: () => (/* binding */ setupMediaTrack),\n/* harmony export */   setupParticipantName: () => (/* binding */ setupParticipantName),\n/* harmony export */   setupParticipantTile: () => (/* binding */ setupParticipantTile),\n/* harmony export */   setupStartAudio: () => (/* binding */ setupStartAudio),\n/* harmony export */   setupTrackMutedIndicator: () => (/* binding */ setupTrackMutedIndicator),\n/* harmony export */   sortParticipants: () => (/* binding */ sortParticipants),\n/* harmony export */   sortTrackReferences: () => (/* binding */ sortTrackReferences),\n/* harmony export */   supportsScreenSharing: () => (/* binding */ supportsScreenSharing),\n/* harmony export */   tokenize: () => (/* binding */ tokenize),\n/* harmony export */   trackObservable: () => (/* binding */ trackObservable),\n/* harmony export */   trackReferencesObservable: () => (/* binding */ trackReferencesObservable),\n/* harmony export */   updatePages: () => (/* binding */ updatePages),\n/* harmony export */   wasClickOutside: () => (/* binding */ wasClickOutside)\n/* harmony export */ });\n/* harmony import */ var livekit_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! livekit-client */ \"(ssr)/./node_modules/.pnpm/livekit-client@1.14.4/node_modules/livekit-client/dist/livekit-client.esm.mjs\");\n/* harmony import */ var global_tld_list__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! global-tld-list */ \"(ssr)/./node_modules/.pnpm/global-tld-list@0.0.1139/node_modules/global-tld-list/dist/index.js\");\n/* harmony import */ var email_regex__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! email-regex */ \"(ssr)/./node_modules/.pnpm/email-regex@5.0.0/node_modules/email-regex/index.js\");\n/* harmony import */ var _floating_ui_dom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @floating-ui/dom */ \"(ssr)/./node_modules/.pnpm/@floating-ui+dom@1.5.3/node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var _floating_ui_dom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @floating-ui/dom */ \"(ssr)/./node_modules/.pnpm/@floating-ui+core@1.5.0/node_modules/@floating-ui/core/dist/floating-ui.core.mjs\");\n/* harmony import */ var loglevel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! loglevel */ \"(ssr)/./node_modules/.pnpm/loglevel@1.8.1/node_modules/loglevel/lib/loglevel.js\");\n/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! rxjs */ \"(ssr)/./node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/cjs/index.js\");\nvar __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    if (__hasOwnProp.call(b, prop))\n      __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b)) {\n      if (__propIsEnum.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    }\n  return a;\n};\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\nvar __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = (value) => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = (value) => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\n\n// src/constants.ts\nvar cssPrefix = \"lk\";\n\n// src/utils.ts\n\n\n// src/track-reference/track-reference.types.ts\nfunction isTrackReference(trackReference) {\n  if (typeof trackReference === \"undefined\") {\n    return false;\n  }\n  return isTrackReferenceSubscribed(trackReference) || isTrackReferencePublished(trackReference);\n}\nfunction isTrackReferenceSubscribed(trackReference) {\n  var _a;\n  if (!trackReference) {\n    return false;\n  }\n  return trackReference.hasOwnProperty(\"participant\") && trackReference.hasOwnProperty(\"source\") && trackReference.hasOwnProperty(\"track\") && typeof ((_a = trackReference.publication) == null ? void 0 : _a.track) !== \"undefined\";\n}\nfunction isTrackReferencePublished(trackReference) {\n  if (!trackReference) {\n    return false;\n  }\n  return trackReference.hasOwnProperty(\"participant\") && trackReference.hasOwnProperty(\"source\") && trackReference.hasOwnProperty(\"publication\") && typeof trackReference.publication !== \"undefined\";\n}\nfunction isTrackReferencePlaceholder(trackReference) {\n  if (!trackReference) {\n    return false;\n  }\n  return trackReference.hasOwnProperty(\"participant\") && trackReference.hasOwnProperty(\"source\") && typeof trackReference.publication === \"undefined\";\n}\n\n// src/track-reference/track-reference.utils.ts\nfunction getTrackReferenceId(trackReference) {\n  if (typeof trackReference === \"string\" || typeof trackReference === \"number\") {\n    return `${trackReference}`;\n  } else if (isTrackReferencePlaceholder(trackReference)) {\n    return `${trackReference.participant.identity}_${trackReference.source}_placeholder`;\n  } else if (isTrackReference(trackReference)) {\n    return `${trackReference.participant.identity}_${trackReference.publication.source}_${trackReference.publication.trackSid}`;\n  } else {\n    throw new Error(`Can't generate a id for the given track reference: ${trackReference}`);\n  }\n}\nfunction getTrackReferenceSource(trackReference) {\n  if (isTrackReference(trackReference)) {\n    return trackReference.publication.source;\n  } else {\n    return trackReference.source;\n  }\n}\nfunction isEqualTrackRef(a, b) {\n  if (a === void 0 || b === void 0) {\n    return false;\n  }\n  if (isTrackReference(a) && isTrackReference(b)) {\n    return a.publication.trackSid === b.publication.trackSid;\n  } else {\n    return getTrackReferenceId(a) === getTrackReferenceId(b);\n  }\n}\nfunction isTrackReferencePinned(trackReference, pinState) {\n  if (typeof pinState === \"undefined\") {\n    return false;\n  }\n  if (isTrackReference(trackReference)) {\n    return pinState.some(\n      (pinnedTrackReference) => pinnedTrackReference.participant.identity === trackReference.participant.identity && isTrackReference(pinnedTrackReference) && pinnedTrackReference.publication.trackSid === trackReference.publication.trackSid\n    );\n  } else if (isTrackReferencePlaceholder(trackReference)) {\n    return pinState.some(\n      (pinnedTrackReference) => pinnedTrackReference.participant.identity === trackReference.participant.identity && isTrackReferencePlaceholder(pinnedTrackReference) && pinnedTrackReference.source === trackReference.source\n    );\n  } else {\n    return false;\n  }\n}\nfunction isPlaceholderReplacement(currentTrackRef, nextTrackRef) {\n  return isTrackReferencePlaceholder(currentTrackRef) && isTrackReference(nextTrackRef) && nextTrackRef.participant.identity === currentTrackRef.participant.identity && nextTrackRef.source === currentTrackRef.source;\n}\n\n// src/utils.ts\nfunction isLocal(p) {\n  return p instanceof livekit_client__WEBPACK_IMPORTED_MODULE_0__.LocalParticipant;\n}\nfunction isRemote(p) {\n  return p instanceof livekit_client__WEBPACK_IMPORTED_MODULE_0__.RemoteParticipant;\n}\nvar attachIfSubscribed = (publication, element) => {\n  if (!publication)\n    return;\n  const { isSubscribed, track } = publication;\n  if (element && track) {\n    if (isSubscribed) {\n      track.attach(element);\n    } else {\n      track.detach(element);\n    }\n  }\n};\nfunction isParticipantSourcePinned(participant, source, pinState) {\n  if (pinState === void 0) {\n    return false;\n  }\n  return pinState.some(\n    ({ source: pinnedSource, participant: pinnedParticipant }) => pinnedSource === source && pinnedParticipant.identity === participant.identity\n  );\n}\nfunction isParticipantTrackReferencePinned(trackRef, pinState) {\n  if (pinState === void 0) {\n    return false;\n  }\n  return pinState.some((pinnedTrackRef) => isEqualTrackRef(pinnedTrackRef, trackRef));\n}\nfunction getScrollBarWidth() {\n  const inner = document.createElement(\"p\");\n  inner.style.width = \"100%\";\n  inner.style.height = \"200px\";\n  const outer = document.createElement(\"div\");\n  outer.style.position = \"absolute\";\n  outer.style.top = \"0px\";\n  outer.style.left = \"0px\";\n  outer.style.visibility = \"hidden\";\n  outer.style.width = \"200px\";\n  outer.style.height = \"150px\";\n  outer.style.overflow = \"hidden\";\n  outer.appendChild(inner);\n  document.body.appendChild(outer);\n  const w1 = inner.offsetWidth;\n  outer.style.overflow = \"scroll\";\n  let w2 = inner.offsetWidth;\n  if (w1 === w2) {\n    w2 = outer.clientWidth;\n  }\n  document.body.removeChild(outer);\n  const scrollBarWidth = w1 - w2;\n  return scrollBarWidth;\n}\n\n// src/helper/detectMobileBrowser.ts\nfunction isWeb() {\n  return typeof document !== \"undefined\";\n}\nfunction isMobileBrowser() {\n  return isWeb() ? /Mobi/i.test(window.navigator.userAgent) : false;\n}\n\n// src/helper/urlRegex.ts\n\nvar createUrlRegExp = (options) => {\n  options = __spreadValues({\n    strict: true\n  }, options);\n  const protocol = `(?:(?:[a-z]+:)?//)${options.strict ? \"\" : \"?\"}`;\n  const auth = \"(?:\\\\S+(?::\\\\S*)?@)?\";\n  const ip = new RegExp(\n    \"(?:25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]\\\\d|\\\\d)(?:\\\\.(?:25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]\\\\d|\\\\d)){3}\",\n    \"g\"\n  ).source;\n  const host = \"(?:(?:[a-z\\\\u00a1-\\\\uffff0-9][-_]*)*[a-z\\\\u00a1-\\\\uffff0-9]+)\";\n  const domain = \"(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)*\";\n  const tld = `(?:\\\\.${options.strict ? \"(?:[a-z\\\\u00a1-\\\\uffff]{2,})\" : `(?:${global_tld_list__WEBPACK_IMPORTED_MODULE_1__.TLDs.sort((a, b) => b.length - a.length).join(\"|\")})`})\\\\.?`;\n  const port = \"(?::\\\\d{2,5})?\";\n  const path = '(?:[/?#][^\\\\s\"]*)?';\n  const regex = `(?:${protocol}|www\\\\.)${auth}(?:localhost|${ip}|${host}${domain}${tld})${port}${path}`;\n  return options.exact ? new RegExp(`(?:^${regex}$)`, \"i\") : new RegExp(regex, \"ig\");\n};\n\n// src/helper/emailRegex.ts\n\n\n// src/helper/floating-menu.ts\n\nfunction computeMenuPosition(button, menu) {\n  return __async(this, null, function* () {\n    const { x, y } = yield (0,_floating_ui_dom__WEBPACK_IMPORTED_MODULE_3__.computePosition)(button, menu, {\n      placement: \"top\",\n      middleware: [(0,_floating_ui_dom__WEBPACK_IMPORTED_MODULE_4__.offset)(6), (0,_floating_ui_dom__WEBPACK_IMPORTED_MODULE_4__.flip)(), (0,_floating_ui_dom__WEBPACK_IMPORTED_MODULE_4__.shift)({ padding: 5 })]\n    });\n    return { x, y };\n  });\n}\nfunction wasClickOutside(insideElement, event) {\n  const isOutside = !insideElement.contains(event.target);\n  return isOutside;\n}\n\n// src/helper/tokenizer.ts\nvar createDefaultGrammar = () => {\n  return {\n    email: (0,email_regex__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(),\n    url: createUrlRegExp({ strict: false })\n  };\n};\nfunction tokenize(input, grammar) {\n  const matches = Object.entries(grammar).map(\n    ([type, rx], weight) => Array.from(input.matchAll(rx)).map(({ index, 0: content }) => ({\n      type,\n      weight,\n      content,\n      index: index != null ? index : 0\n    }))\n  ).flat().sort((a, b) => {\n    const d = a.index - b.index;\n    return d !== 0 ? d : a.weight - b.weight;\n  }).filter(({ index }, i, arr) => {\n    if (i === 0)\n      return true;\n    const prev = arr[i - 1];\n    return prev.index + prev.content.length <= index;\n  });\n  const tokens = [];\n  let pos = 0;\n  for (const { type, content, index } of matches) {\n    if (index > pos)\n      tokens.push(input.substring(pos, index));\n    tokens.push({ type, content });\n    pos = index + content.length;\n  }\n  if (input.length > pos)\n    tokens.push(input.substring(pos));\n  return tokens;\n}\n\n// src/helper/eventGroups.ts\n\nvar allRemoteParticipantRoomEvents = [\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.RoomMetadataChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ActiveSpeakersChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionQualityChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantConnected,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantDisconnected,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantPermissionsChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantMetadataChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackMuted,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnmuted,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackPublished,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnpublished,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackStreamStateChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscriptionFailed,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscriptionPermissionChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscriptionStatusChanged\n];\nvar allParticipantRoomEvents = [\n  ...allRemoteParticipantRoomEvents,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackPublished,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackUnpublished\n];\nvar allRemoteParticipantEvents = [\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ConnectionQualityChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.IsSpeakingChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ParticipantMetadataChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ParticipantPermissionsChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackMuted,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackUnmuted,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackPublished,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackUnpublished,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackStreamStateChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackSubscriptionFailed,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackSubscriptionPermissionChanged,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackSubscriptionStatusChanged\n];\nvar allParticipantEvents = [\n  ...allRemoteParticipantEvents,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.LocalTrackPublished,\n  livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.LocalTrackUnpublished\n];\n\n// src/logger.ts\n\n\nvar log = loglevel__WEBPACK_IMPORTED_MODULE_5__.getLogger(\"lk-components-js\");\nlog.setDefaultLevel(\"WARN\");\nfunction setLogLevel(level, options = {}) {\n  var _a;\n  log.setLevel(level);\n  (0,livekit_client__WEBPACK_IMPORTED_MODULE_0__.setLogLevel)((_a = options.liveKitClientLogLevel) != null ? _a : level);\n}\n\n// src/helper/grid-layouts.ts\nvar GRID_LAYOUTS = [\n  {\n    columns: 1,\n    rows: 1,\n    name: \"1x1\",\n    minTiles: 1,\n    maxTiles: 1,\n    minWidth: 0,\n    minHeight: 0\n  },\n  {\n    columns: 1,\n    rows: 2,\n    name: \"1x2\",\n    minTiles: 2,\n    maxTiles: 2,\n    minWidth: 0,\n    minHeight: 0\n  },\n  {\n    columns: 2,\n    rows: 1,\n    name: \"2x1\",\n    minTiles: 2,\n    maxTiles: 2,\n    minWidth: 900,\n    minHeight: 0\n  },\n  {\n    columns: 2,\n    rows: 2,\n    name: \"2x2\",\n    minTiles: 3,\n    maxTiles: 4,\n    minWidth: 560,\n    minHeight: 0\n  },\n  {\n    columns: 3,\n    rows: 3,\n    name: \"3x3\",\n    minTiles: 5,\n    maxTiles: 9,\n    minWidth: 700,\n    minHeight: 0\n  },\n  {\n    columns: 4,\n    rows: 4,\n    name: \"4x4\",\n    minTiles: 10,\n    maxTiles: 16,\n    minWidth: 960,\n    minHeight: 0\n  },\n  {\n    columns: 5,\n    rows: 5,\n    name: \"5x5\",\n    minTiles: 17,\n    maxTiles: 25,\n    minWidth: 1100,\n    minHeight: 0\n  }\n];\nfunction selectGridLayout(layouts, participantCount, width, height) {\n  let currentLayoutIndex = 0;\n  let layout = layouts.find((layout_, index, allLayouts) => {\n    currentLayoutIndex = index;\n    const isBiggerLayoutAvailable = allLayouts.findIndex((l, i) => {\n      const layoutIsBiggerThanCurrent = i > index;\n      const layoutFitsSameAmountOfParticipants = l.maxTiles === layout_.maxTiles;\n      return layoutIsBiggerThanCurrent && layoutFitsSameAmountOfParticipants;\n    }) !== -1;\n    return layout_.maxTiles >= participantCount && !isBiggerLayoutAvailable;\n  });\n  if (layout === void 0) {\n    layout = layouts[layouts.length - 1];\n    if (layout) {\n      log.warn(\n        `No layout found for: participantCount: ${participantCount}, width/height: ${width}/${height} fallback to biggest available layout (${layout.name}).`\n      );\n    } else {\n      throw new Error(`No layout or fallback layout found.`);\n    }\n  }\n  if (width < layout.minWidth || height < layout.minHeight) {\n    if (currentLayoutIndex > 0) {\n      const smallerLayout = layouts[currentLayoutIndex - 1];\n      layout = selectGridLayout(\n        layouts.slice(0, currentLayoutIndex),\n        smallerLayout.maxTiles,\n        width,\n        height\n      );\n    }\n  }\n  return layout;\n}\n\n// src/helper/set-helper.ts\nfunction setDifference(setA, setB) {\n  const _difference = new Set(setA);\n  for (const elem of setB) {\n    _difference.delete(elem);\n  }\n  return _difference;\n}\n\n// src/helper/featureDetection.ts\nfunction supportsScreenSharing() {\n  return typeof navigator !== \"undefined\" && navigator.mediaDevices && !!navigator.mediaDevices.getDisplayMedia;\n}\n\n// src/types.ts\nvar PIN_DEFAULT_STATE = [];\nvar WIDGET_DEFAULT_STATE = { showChat: false, unreadMessages: 0 };\nfunction isSourceWitOptions(source) {\n  return typeof source === \"object\";\n}\nfunction isSourcesWithOptions(sources) {\n  return Array.isArray(sources) && sources.filter(isSourceWitOptions).length > 0;\n}\n\n// src/sorting/sort-track-bundles.ts\n\n\n// src/sorting/base-sort-functions.ts\n\nfunction sortParticipantsByAudioLevel(a, b) {\n  return b.audioLevel - a.audioLevel;\n}\nfunction sortParticipantsByIsSpeaking(a, b) {\n  if (a.isSpeaking === b.isSpeaking) {\n    return 0;\n  } else {\n    return a.isSpeaking ? -1 : 1;\n  }\n}\nfunction sortParticipantsByLastSpokenAT(a, b) {\n  var _a, _b, _c, _d;\n  if (a.lastSpokeAt !== void 0 || b.lastSpokeAt !== void 0) {\n    return ((_b = (_a = b.lastSpokeAt) == null ? void 0 : _a.getTime()) != null ? _b : 0) - ((_d = (_c = a.lastSpokeAt) == null ? void 0 : _c.getTime()) != null ? _d : 0);\n  } else {\n    return 0;\n  }\n}\nfunction sortParticipantsByJoinedAt(a, b) {\n  var _a, _b, _c, _d;\n  return ((_b = (_a = a.joinedAt) == null ? void 0 : _a.getTime()) != null ? _b : 0) - ((_d = (_c = b.joinedAt) == null ? void 0 : _c.getTime()) != null ? _d : 0);\n}\nfunction sortTrackReferencesByType(a, b) {\n  if (isTrackReference(a)) {\n    if (isTrackReference(b)) {\n      return 0;\n    } else {\n      return -1;\n    }\n  } else if (isTrackReference(b)) {\n    return 1;\n  } else {\n    return 0;\n  }\n}\nfunction sortTrackRefsByIsCameraEnabled(a, b) {\n  const aVideo = a.participant.isCameraEnabled;\n  const bVideo = b.participant.isCameraEnabled;\n  if (aVideo !== bVideo) {\n    if (aVideo) {\n      return -1;\n    } else {\n      return 1;\n    }\n  } else {\n    return 0;\n  }\n}\n\n// src/sorting/sort-track-bundles.ts\nfunction sortTrackReferences(tracks) {\n  const localTracks = [];\n  const screenShareTracks = [];\n  const cameraTracks = [];\n  const undefinedTracks = [];\n  tracks.forEach((trackRef) => {\n    if (trackRef.participant.isLocal && trackRef.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera) {\n      localTracks.push(trackRef);\n    } else if (trackRef.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShare) {\n      screenShareTracks.push(trackRef);\n    } else if (trackRef.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera) {\n      cameraTracks.push(trackRef);\n    } else {\n      undefinedTracks.push(trackRef);\n    }\n  });\n  const sortedScreenShareTracks = sortScreenShareTracks(screenShareTracks);\n  const sortedCameraTracks = sortCameraTracks(cameraTracks);\n  return [...localTracks, ...sortedScreenShareTracks, ...sortedCameraTracks, ...undefinedTracks];\n}\nfunction sortScreenShareTracks(screenShareTracks) {\n  const localScreenShares = [];\n  const remoteScreenShares = [];\n  screenShareTracks.forEach((trackRef) => {\n    if (trackRef.participant.isLocal) {\n      localScreenShares.push(trackRef);\n    } else {\n      remoteScreenShares.push(trackRef);\n    }\n  });\n  localScreenShares.sort((a, b) => sortParticipantsByJoinedAt(a.participant, b.participant));\n  remoteScreenShares.sort((a, b) => sortParticipantsByJoinedAt(a.participant, b.participant));\n  const sortedScreenShareTrackRefs = [...remoteScreenShares, ...localScreenShares];\n  return sortedScreenShareTrackRefs;\n}\nfunction sortCameraTracks(cameraTrackReferences) {\n  const localCameraTracks = [];\n  const remoteCameraTracks = [];\n  cameraTrackReferences.forEach((trackRef) => {\n    if (trackRef.participant.isLocal) {\n      localCameraTracks.push(trackRef);\n    } else {\n      remoteCameraTracks.push(trackRef);\n    }\n  });\n  remoteCameraTracks.sort((a, b) => {\n    if (a.participant.isSpeaking && b.participant.isSpeaking) {\n      return sortParticipantsByAudioLevel(a.participant, b.participant);\n    }\n    if (a.participant.isSpeaking !== b.participant.isSpeaking) {\n      return sortParticipantsByIsSpeaking(a.participant, b.participant);\n    }\n    if (a.participant.lastSpokeAt !== b.participant.lastSpokeAt) {\n      return sortParticipantsByLastSpokenAT(a.participant, b.participant);\n    }\n    if (isTrackReference(a) !== isTrackReference(b)) {\n      return sortTrackReferencesByType(a, b);\n    }\n    if (a.participant.isCameraEnabled !== b.participant.isCameraEnabled) {\n      return sortTrackRefsByIsCameraEnabled(a, b);\n    }\n    return sortParticipantsByJoinedAt(a.participant, b.participant);\n  });\n  return [...localCameraTracks, ...remoteCameraTracks];\n}\n\n// src/sorting/sort-participants.ts\n\nfunction sortParticipants(participants) {\n  const sortedParticipants = [...participants];\n  sortedParticipants.sort((a, b) => {\n    if (a.isSpeaking && b.isSpeaking) {\n      return sortParticipantsByAudioLevel(a, b);\n    }\n    if (a.isSpeaking !== b.isSpeaking) {\n      return sortParticipantsByIsSpeaking(a, b);\n    }\n    if (a.lastSpokeAt !== b.lastSpokeAt) {\n      return sortParticipantsByLastSpokenAT(a, b);\n    }\n    const aVideo = a.videoTracks.size > 0;\n    const bVideo = b.videoTracks.size > 0;\n    if (aVideo !== bVideo) {\n      if (aVideo) {\n        return -1;\n      } else {\n        return 1;\n      }\n    }\n    return sortParticipantsByJoinedAt(a, b);\n  });\n  const localParticipant = sortedParticipants.find((p) => p instanceof livekit_client__WEBPACK_IMPORTED_MODULE_0__.LocalParticipant);\n  if (localParticipant) {\n    const localIdx = sortedParticipants.indexOf(localParticipant);\n    if (localIdx >= 0) {\n      sortedParticipants.splice(localIdx, 1);\n      if (sortedParticipants.length > 0) {\n        sortedParticipants.splice(0, 0, localParticipant);\n      } else {\n        sortedParticipants.push(localParticipant);\n      }\n    }\n  }\n  return sortedParticipants;\n}\n\n// src/helper/array-helper.ts\nfunction chunk(input, size) {\n  return input.reduce((arr, item, idx) => {\n    return idx % size === 0 ? [...arr, [item]] : [...arr.slice(0, -1), [...arr.slice(-1)[0], item]];\n  }, []);\n}\nfunction zip(a1, a2) {\n  const resultLength = Math.max(a1.length, a2.length);\n  return new Array(resultLength).fill([]).map((_val, idx) => [a1[idx], a2[idx]]);\n}\nfunction differenceBy(a1, a2, by) {\n  return a1.filter((c) => !a2.map((v) => by(v)).includes(by(c)));\n}\n\n// src/track-reference/test-utils.ts\n\nfunction flatTrackReferenceArray(list) {\n  return list.map((item) => {\n    if (typeof item === \"string\" || typeof item === \"number\") {\n      return `${item}`;\n    } else {\n      return getTrackReferenceId(item);\n    }\n  });\n}\n\n// src/sorting/tile-array-update.ts\nfunction visualPageChange(state, next) {\n  return {\n    dropped: differenceBy(state, next, getTrackReferenceId),\n    added: differenceBy(next, state, getTrackReferenceId)\n  };\n}\nfunction listNeedsUpdating(changes) {\n  return changes.added.length !== 0 || changes.dropped.length !== 0;\n}\nfunction findIndex(trackReference, trackReferences) {\n  const indexToReplace = trackReferences.findIndex(\n    (trackReference_) => getTrackReferenceId(trackReference_) === getTrackReferenceId(trackReference)\n  );\n  if (indexToReplace === -1) {\n    throw new Error(\n      `Element not part of the array: ${getTrackReferenceId(\n        trackReference\n      )} not in ${flatTrackReferenceArray(trackReferences)}`\n    );\n  }\n  return indexToReplace;\n}\nfunction swapItems(moveForward, moveBack, trackReferences) {\n  const indexToReplace = findIndex(moveForward, trackReferences);\n  const indexReplaceWith = findIndex(moveBack, trackReferences);\n  trackReferences.splice(indexToReplace, 1, moveBack);\n  trackReferences.splice(indexReplaceWith, 1, moveForward);\n  return trackReferences;\n}\nfunction dropItem(itemToDrop, list) {\n  const indexOfElementToDrop = findIndex(itemToDrop, list);\n  list.splice(indexOfElementToDrop, 1);\n  return list;\n}\nfunction addItem(itemToAdd, list) {\n  return [...list, itemToAdd];\n}\nfunction divideIntoPages(list, maxElementsOnPage) {\n  const pages = chunk(list, maxElementsOnPage);\n  return pages;\n}\nfunction updatePages(currentList, nextList, maxItemsOnPage) {\n  let updatedList = refreshList(currentList, nextList);\n  if (updatedList.length < nextList.length) {\n    const addedItems = differenceBy(nextList, updatedList, getTrackReferenceId);\n    updatedList = [...updatedList, ...addedItems];\n  }\n  const currentPages = divideIntoPages(updatedList, maxItemsOnPage);\n  const nextPages = divideIntoPages(nextList, maxItemsOnPage);\n  zip(currentPages, nextPages).forEach(([currentPage, nextPage], pageIndex) => {\n    if (currentPage && nextPage) {\n      const updatedPage = divideIntoPages(updatedList, maxItemsOnPage)[pageIndex];\n      const changes = visualPageChange(updatedPage, nextPage);\n      if (listNeedsUpdating(changes)) {\n        log.debug(\n          `Detected visual changes on page: ${pageIndex}, current: ${flatTrackReferenceArray(\n            currentPage\n          )}, next: ${flatTrackReferenceArray(nextPage)}`,\n          { changes }\n        );\n        if (changes.added.length === changes.dropped.length) {\n          zip(changes.added, changes.dropped).forEach(([added, dropped]) => {\n            if (added && dropped) {\n              updatedList = swapItems(added, dropped, updatedList);\n            } else {\n              throw new Error(\n                `For a swap action we need a addition and a removal one is missing: ${added}, ${dropped}`\n              );\n            }\n          });\n        }\n        if (changes.added.length === 0 && changes.dropped.length > 0) {\n          changes.dropped.forEach((item) => {\n            updatedList = dropItem(item, updatedList);\n          });\n        }\n        if (changes.added.length > 0 && changes.dropped.length === 0) {\n          changes.added.forEach((item) => {\n            updatedList = addItem(item, updatedList);\n          });\n        }\n      }\n    }\n  });\n  if (updatedList.length > nextList.length) {\n    const missingItems = differenceBy(updatedList, nextList, getTrackReferenceId);\n    updatedList = updatedList.filter(\n      (item) => !missingItems.map(getTrackReferenceId).includes(getTrackReferenceId(item))\n    );\n  }\n  return updatedList;\n}\nfunction refreshList(currentList, nextList) {\n  return currentList.map((currentItem) => {\n    const updateForCurrentItem = nextList.find(\n      (newItem_) => (\n        // If the IDs match or ..\n        getTrackReferenceId(currentItem) === getTrackReferenceId(newItem_) || // ... if the current item is a placeholder and the new item is the track reference can replace it.\n        typeof currentItem !== \"number\" && isTrackReferencePlaceholder(currentItem) && isTrackReference(newItem_) && isPlaceholderReplacement(currentItem, newItem_)\n      )\n    );\n    return updateForCurrentItem != null ? updateForCurrentItem : currentItem;\n  });\n}\n\n// src/components/mediaToggle.ts\n\n\n\n// src/observables/participant.ts\n\n\n\n// src/observables/room.ts\n\n\nfunction observeRoomEvents(room, ...events) {\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscribe) => {\n    const onRoomUpdate = () => {\n      subscribe.next(room);\n    };\n    events.forEach((evt) => {\n      room.on(evt, onRoomUpdate);\n    });\n    const unsubscribe = () => {\n      events.forEach((evt) => {\n        room.off(evt, onRoomUpdate);\n      });\n    };\n    return unsubscribe;\n  }).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(room));\n  return observable;\n}\nfunction roomEventSelector(room, event) {\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscribe) => {\n    const update = (...params) => {\n      subscribe.next(params);\n    };\n    room.on(event, update);\n    const unsubscribe = () => {\n      room.off(event, update);\n    };\n    return unsubscribe;\n  });\n  return observable;\n}\nfunction roomObserver(room) {\n  const observable = observeRoomEvents(\n    room,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantConnected,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantDisconnected,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ActiveSpeakersChanged,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscribed,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnsubscribed,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackPublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackUnpublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.AudioPlaybackStatusChanged,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged\n  ).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(room));\n  return observable;\n}\nfunction connectionStateObserver(room) {\n  return roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([connectionState]) => connectionState),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(room.state)\n  );\n}\nfunction screenShareObserver(room) {\n  let screenShareSubscriber;\n  const observers = [];\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscriber) => {\n    screenShareSubscriber = subscriber;\n    return () => {\n      observers.forEach((observer) => {\n        observer.unsubscribe();\n      });\n    };\n  });\n  const screenShareTracks = [];\n  const handleSub = (publication, participant) => {\n    if (publication.source !== livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShare && publication.source !== livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShareAudio) {\n      return;\n    }\n    let trackMap = screenShareTracks.find((tr) => tr.participant.identity === participant.identity);\n    const getScreenShareTracks = (participant2) => {\n      return participant2.getTracks().filter(\n        (track) => (track.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShare || track.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShareAudio) && track.track\n      );\n    };\n    if (!trackMap) {\n      trackMap = {\n        participant,\n        tracks: getScreenShareTracks(participant)\n      };\n    } else {\n      const index = screenShareTracks.indexOf(trackMap);\n      screenShareTracks.splice(index, 1);\n      trackMap.tracks = getScreenShareTracks(participant);\n    }\n    if (trackMap.tracks.length > 0) {\n      screenShareTracks.push(trackMap);\n    }\n    screenShareSubscriber.next(screenShareTracks);\n  };\n  observers.push(\n    roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscribed).subscribe(\n      ([, ...args]) => handleSub(...args)\n    )\n  );\n  observers.push(\n    roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnsubscribed).subscribe(\n      ([, ...args]) => handleSub(...args)\n    )\n  );\n  observers.push(\n    roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackPublished).subscribe((args) => handleSub(...args))\n  );\n  observers.push(\n    roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackUnpublished).subscribe((args) => {\n      handleSub(...args);\n    })\n  );\n  observers.push(\n    roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackMuted).subscribe((args) => {\n      handleSub(...args);\n    })\n  );\n  observers.push(\n    roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnmuted).subscribe((args) => {\n      handleSub(...args);\n    })\n  );\n  setTimeout(() => {\n    for (const p of room.participants.values()) {\n      p.getTracks().forEach((track) => {\n        handleSub(track, p);\n      });\n    }\n  }, 1);\n  return observable;\n}\nfunction roomInfoObserver(room) {\n  const observer = observeRoomEvents(\n    room,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.RoomMetadataChanged,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((r) => {\n      return { name: r.name, metadata: r.metadata };\n    })\n  );\n  return observer;\n}\nfunction activeSpeakerObserver(room) {\n  return roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ActiveSpeakersChanged).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([speakers]) => speakers)\n  );\n}\nfunction createMediaDeviceObserver(kind, requestPermissions = true) {\n  var _a;\n  const onDeviceChange = () => __async(this, null, function* () {\n    const newDevices = yield livekit_client__WEBPACK_IMPORTED_MODULE_0__.Room.getLocalDevices(kind, requestPermissions);\n    deviceSubject.next(newDevices);\n  });\n  const deviceSubject = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Subject();\n  const observable = deviceSubject.pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.finalize)(() => {\n      var _a2;\n      (_a2 = navigator == null ? void 0 : navigator.mediaDevices) == null ? void 0 : _a2.removeEventListener(\"devicechange\", onDeviceChange);\n    })\n  );\n  if (typeof window !== \"undefined\") {\n    if (!window.isSecureContext) {\n      throw new Error(\n        `Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices`\n      );\n    }\n    (_a = navigator == null ? void 0 : navigator.mediaDevices) == null ? void 0 : _a.addEventListener(\"devicechange\", onDeviceChange);\n  }\n  return (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.concat)(livekit_client__WEBPACK_IMPORTED_MODULE_0__.Room.getLocalDevices(kind, requestPermissions), observable);\n}\nfunction createDataObserver(room) {\n  return roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.DataReceived);\n}\nfunction roomAudioPlaybackAllowedObservable(room) {\n  const observable = observeRoomEvents(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.AudioPlaybackStatusChanged).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((room2) => {\n      return { canPlayAudio: room2.canPlaybackAudio };\n    })\n  );\n  return observable;\n}\nfunction createActiveDeviceObservable(room, kind) {\n  return roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ActiveDeviceChanged).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.filter)(([kindOfDevice]) => kindOfDevice === kind),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([kind2, deviceId]) => {\n      log.debug(\"activeDeviceObservable | RoomEvent.ActiveDeviceChanged\", { kind: kind2, deviceId });\n      return deviceId;\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(room.getActiveDevice(kind))\n  );\n}\nfunction encryptionStatusObservable(room, participant) {\n  return roomEventSelector(room, livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantEncryptionStatusChanged).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.filter)(\n      ([, p]) => participant.identity === (p == null ? void 0 : p.identity) || !p && participant.identity === room.localParticipant.identity\n    ),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([encrypted]) => encrypted),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(\n      participant instanceof livekit_client__WEBPACK_IMPORTED_MODULE_0__.LocalParticipant ? participant.isE2EEEnabled : participant.isEncrypted\n    )\n  );\n}\n\n// src/components/mediaTrack.ts\n\n\n\n// src/styles-interface/class-prefixer.ts\nfunction prefixClass(unprefixedClassName) {\n  return `${cssPrefix}-${unprefixedClassName}`;\n}\n\n// src/components/mediaTrack.ts\nfunction setupMediaTrack(trackIdentifier) {\n  const initialPub = getTrackByIdentifier(trackIdentifier);\n  const trackObserver = observeParticipantMedia(trackIdentifier.participant).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(() => {\n      return getTrackByIdentifier(trackIdentifier);\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(initialPub)\n  );\n  const className = prefixClass(\n    trackIdentifier.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera || trackIdentifier.source === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShare ? \"participant-media-video\" : \"participant-media-audio\"\n  );\n  return { className, trackObserver };\n}\nfunction getTrackByIdentifier(options) {\n  if (isTrackReference(options)) {\n    return options.publication;\n  } else {\n    const { source, name, participant } = options;\n    if (source && name) {\n      return participant.getTracks().find((pub) => pub.source === source && pub.trackName === name);\n    } else if (name) {\n      return participant.getTrackByName(name);\n    } else if (source) {\n      return participant.getTrack(source);\n    } else {\n      throw new Error(\"At least one of source and name needs to be defined\");\n    }\n  }\n}\n\n// src/observables/participant.ts\nfunction observeParticipantEvents(participant, ...events) {\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscribe) => {\n    const onParticipantUpdate = () => {\n      subscribe.next(participant);\n    };\n    events.forEach((evt) => {\n      participant.on(evt, onParticipantUpdate);\n    });\n    const unsubscribe = () => {\n      events.forEach((evt) => {\n        participant.off(evt, onParticipantUpdate);\n      });\n    };\n    return unsubscribe;\n  }).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(participant));\n  return observable;\n}\nfunction observeParticipantMedia(participant) {\n  const participantObserver = observeParticipantEvents(\n    participant,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackMuted,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackUnmuted,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ParticipantPermissionsChanged,\n    // ParticipantEvent.IsSpeakingChanged,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackPublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackUnpublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.LocalTrackPublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.LocalTrackUnpublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.MediaDevicesError,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackSubscriptionStatusChanged\n    // ParticipantEvent.ConnectionQualityChanged,\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((p) => {\n      const { isMicrophoneEnabled, isCameraEnabled, isScreenShareEnabled } = p;\n      const microphoneTrack = p.getTrack(livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Microphone);\n      const cameraTrack = p.getTrack(livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera);\n      const participantMedia = {\n        isCameraEnabled,\n        isMicrophoneEnabled,\n        isScreenShareEnabled,\n        cameraTrack,\n        microphoneTrack,\n        participant: p\n      };\n      return participantMedia;\n    })\n  );\n  return participantObserver;\n}\nfunction createTrackObserver(participant, options) {\n  return observeParticipantMedia(participant).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(() => {\n      return { publication: getTrackByIdentifier(options) };\n    })\n  );\n}\nfunction participantInfoObserver(participant) {\n  const observer = observeParticipantEvents(\n    participant,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ParticipantMetadataChanged\n    // ParticipantEvent.LocalTrackPublished,\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(({ name, identity, metadata }) => {\n      return {\n        name,\n        identity,\n        metadata\n      };\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)({\n      name: participant.name,\n      identity: participant.identity,\n      metadata: participant.metadata\n    })\n  );\n  return observer;\n}\nfunction createConnectionQualityObserver(participant) {\n  const observer = participantEventSelector(\n    participant,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ConnectionQualityChanged\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([quality]) => quality),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(participant.connectionQuality)\n  );\n  return observer;\n}\nfunction participantEventSelector(participant, event) {\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscribe) => {\n    const update = (...params) => {\n      subscribe.next(params);\n    };\n    participant.on(event, update);\n    const unsubscribe = () => {\n      participant.off(event, update);\n    };\n    return unsubscribe;\n  });\n  return observable;\n}\nfunction mutedObserver(trackRef) {\n  var _a, _b, _c, _d;\n  return observeParticipantEvents(\n    trackRef.participant,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackMuted,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackUnmuted,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackSubscribed,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.TrackUnsubscribed,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.LocalTrackPublished,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.LocalTrackUnpublished\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((participant) => {\n      var _a2, _b2;\n      const pub = (_a2 = trackRef.publication) != null ? _a2 : participant.getTrack(trackRef.source);\n      return (_b2 = pub == null ? void 0 : pub.isMuted) != null ? _b2 : true;\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(\n      (_d = (_c = (_a = trackRef.publication) == null ? void 0 : _a.isMuted) != null ? _c : (_b = trackRef.participant.getTrack(trackRef.source)) == null ? void 0 : _b.isMuted) != null ? _d : true\n    )\n  );\n}\nfunction createIsSpeakingObserver(participant) {\n  return participantEventSelector(participant, livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.IsSpeakingChanged).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([isSpeaking]) => isSpeaking)\n  );\n}\nfunction connectedParticipantsObserver(room, options = {}) {\n  var _a;\n  let subscriber;\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((sub) => {\n    subscriber = sub;\n    return () => listener.unsubscribe();\n  }).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(Array.from(room.participants.values())));\n  const additionalRoomEvents = (_a = options.additionalRoomEvents) != null ? _a : allParticipantRoomEvents;\n  const roomEvents = Array.from(\n    /* @__PURE__ */ new Set([\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantConnected,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantDisconnected,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged,\n      ...additionalRoomEvents\n    ])\n  );\n  const listener = observeRoomEvents(room, ...roomEvents).subscribe(\n    (r) => subscriber == null ? void 0 : subscriber.next(Array.from(r.participants.values()))\n  );\n  if (room.participants.size > 0) {\n    subscriber == null ? void 0 : subscriber.next(Array.from(room.participants.values()));\n  }\n  return observable;\n}\nfunction connectedParticipantObserver(room, identity, options = {}) {\n  var _a;\n  const additionalEvents = (_a = options.additionalEvents) != null ? _a : allParticipantEvents;\n  const observable = observeRoomEvents(\n    room,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantConnected,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantDisconnected,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.switchMap)((r) => {\n      const participant = r.getParticipantByIdentity(identity);\n      if (participant) {\n        return observeParticipantEvents(participant, ...additionalEvents);\n      } else {\n        return new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscribe) => subscribe.next(void 0));\n      }\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(room.getParticipantByIdentity(identity))\n  );\n  return observable;\n}\nfunction participantPermissionObserver(participant) {\n  const observer = participantEventSelector(\n    participant,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ParticipantPermissionsChanged\n  ).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(() => participant.permissions),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(participant.permissions)\n  );\n  return observer;\n}\n\n// src/components/mediaToggle.ts\nfunction setupMediaToggle(source, room, options) {\n  const { localParticipant } = room;\n  const getSourceEnabled = (source2, localParticipant2) => {\n    let isEnabled = false;\n    switch (source2) {\n      case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera:\n        isEnabled = localParticipant2.isCameraEnabled;\n        break;\n      case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Microphone:\n        isEnabled = localParticipant2.isMicrophoneEnabled;\n        break;\n      case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShare:\n        isEnabled = localParticipant2.isScreenShareEnabled;\n        break;\n      default:\n        break;\n    }\n    return isEnabled;\n  };\n  const enabledObserver = observeParticipantMedia(localParticipant).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((media) => {\n      return getSourceEnabled(source, media.participant);\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(getSourceEnabled(source, localParticipant))\n  );\n  const pendingSubject = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Subject();\n  const toggle = (forceState, captureOptions) => __async(this, null, function* () {\n    try {\n      captureOptions != null ? captureOptions : captureOptions = options;\n      pendingSubject.next(true);\n      switch (source) {\n        case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera:\n          yield localParticipant.setCameraEnabled(\n            forceState != null ? forceState : !localParticipant.isCameraEnabled,\n            captureOptions\n          );\n          break;\n        case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Microphone:\n          yield localParticipant.setMicrophoneEnabled(\n            forceState != null ? forceState : !localParticipant.isMicrophoneEnabled,\n            captureOptions\n          );\n          break;\n        case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.ScreenShare:\n          yield localParticipant.setScreenShareEnabled(\n            forceState != null ? forceState : !localParticipant.isScreenShareEnabled,\n            captureOptions\n          );\n          break;\n        default:\n          break;\n      }\n    } finally {\n      pendingSubject.next(false);\n    }\n  });\n  const className = prefixClass(\"button\");\n  return {\n    className,\n    toggle,\n    enabledObserver,\n    pendingObserver: pendingSubject.asObservable()\n  };\n}\nfunction setupManualToggle() {\n  let state = false;\n  const enabledSubject = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Subject();\n  const pendingSubject = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Subject();\n  const toggle = (forceState) => {\n    pendingSubject.next(true);\n    state = forceState != null ? forceState : !state;\n    enabledSubject.next(state);\n    pendingSubject.next(false);\n  };\n  const className = prefixClass(\"button\");\n  return {\n    className,\n    toggle,\n    enabledObserver: enabledSubject.asObservable(),\n    pendingObserver: pendingSubject.asObservable()\n  };\n}\n\n// src/components/mediaDeviceSelect.ts\n\n\nfunction setupDeviceSelector(kind, room, localTrack) {\n  const activeDeviceSubject = new rxjs__WEBPACK_IMPORTED_MODULE_6__.BehaviorSubject(void 0);\n  const activeDeviceObservable = room ? createActiveDeviceObservable(room, kind) : activeDeviceSubject.asObservable();\n  const setActiveMediaDevice = (_0, ..._1) => __async(this, [_0, ..._1], function* (id, options = {}) {\n    var _a, _b, _c;\n    if (room) {\n      log.debug(`Switching active device of kind \"${kind}\" with id ${id}.`);\n      yield room.switchActiveDevice(kind, id, options.exact);\n      const actualDeviceId = (_a = room.getActiveDevice(kind)) != null ? _a : id;\n      if (actualDeviceId !== id && id !== \"default\") {\n        log.info(\n          `We tried to select the device with id (${id}), but the browser decided to select the device with id (${actualDeviceId}) instead.`\n        );\n      }\n      let targetTrack = void 0;\n      if (kind === \"audioinput\")\n        targetTrack = (_b = room.localParticipant.getTrack(livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Microphone)) == null ? void 0 : _b.track;\n      else if (kind === \"videoinput\") {\n        targetTrack = (_c = room.localParticipant.getTrack(livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera)) == null ? void 0 : _c.track;\n      }\n      const useDefault = id === \"default\" && !targetTrack || id === \"default\" && (targetTrack == null ? void 0 : targetTrack.mediaStreamTrack.label.startsWith(\"Default\"));\n      activeDeviceSubject.next(useDefault ? id : actualDeviceId);\n    } else if (localTrack) {\n      yield localTrack.setDeviceId(options.exact ? { exact: id } : id);\n      const actualId = yield localTrack.getDeviceId();\n      activeDeviceSubject.next(\n        id === \"default\" && localTrack.mediaStreamTrack.label.startsWith(\"Default\") ? id : actualId\n      );\n    } else if (activeDeviceSubject.value !== id) {\n      log.warn(\n        \"device switch skipped, please provide either a room or a local track to switch on. \"\n      );\n      activeDeviceSubject.next(id);\n    }\n  });\n  const className = prefixClass(\"media-device-select\");\n  return {\n    className,\n    activeDeviceObservable,\n    setActiveMediaDevice\n  };\n}\n\n// src/components/disconnectButton.ts\nfunction setupDisconnectButton(room) {\n  const disconnect = (stopTracks) => {\n    room.disconnect(stopTracks);\n  };\n  const className = prefixClass(\"disconnect-button\");\n  return { className, disconnect };\n}\n\n// src/components/connectionQualityIndicator.ts\nfunction setupConnectionQualityIndicator(participant) {\n  const className = prefixClass(\"connection-quality\");\n  const connectionQualityObserver = createConnectionQualityObserver(participant);\n  return { className, connectionQualityObserver };\n}\n\n// src/components/trackMutedIndicator.ts\n\nfunction setupTrackMutedIndicator(trackRef) {\n  let classForSource = \"track-muted-indicator-camera\";\n  switch (trackRef.source) {\n    case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Camera:\n      classForSource = \"track-muted-indicator-camera\";\n      break;\n    case livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Source.Microphone:\n      classForSource = \"track-muted-indicator-microphone\";\n      break;\n    default:\n      break;\n  }\n  const className = prefixClass(classForSource);\n  const mediaMutedObserver = mutedObserver(trackRef);\n  return { className, mediaMutedObserver };\n}\n\n// src/components/participantName.ts\nfunction setupParticipantName(participant) {\n  const infoObserver = participantInfoObserver(participant);\n  return { className: \"lk-participant-name\", infoObserver };\n}\n\n// src/components/participantTile.ts\nfunction setupParticipantTile() {\n  const className = prefixClass(\"participant-tile\");\n  return {\n    className\n  };\n}\n\n// src/components/chat.ts\n\n\n\n// src/observables/dataChannel.ts\n\n\nvar DataTopic = {\n  CHAT: \"lk-chat-topic\"\n};\nfunction sendMessage(_0, _1, _2) {\n  return __async(this, arguments, function* (localParticipant, payload, topic, options = {}) {\n    const { kind, destination } = options;\n    yield localParticipant.publishData(payload, kind != null ? kind : livekit_client__WEBPACK_IMPORTED_MODULE_0__.DataPacket_Kind.RELIABLE, {\n      destination,\n      topic\n    });\n  });\n}\nfunction setupDataMessageHandler(room, topic, onMessage) {\n  const messageObservable = createDataObserver(room).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.filter)(([, , , messageTopic]) => topic === void 0 || messageTopic === topic),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(([payload, participant, , messageTopic]) => {\n      const msg = {\n        payload,\n        topic: messageTopic,\n        from: participant\n      };\n      onMessage == null ? void 0 : onMessage(msg);\n      return msg;\n    })\n  );\n  let isSendingSubscriber;\n  const isSendingObservable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscriber) => {\n    isSendingSubscriber = subscriber;\n  });\n  const send = (_0, ..._1) => __async(this, [_0, ..._1], function* (payload, options = {}) {\n    isSendingSubscriber.next(true);\n    try {\n      yield sendMessage(room.localParticipant, payload, topic, options);\n    } finally {\n      isSendingSubscriber.next(false);\n    }\n  });\n  return { messageObservable, isSendingObservable, send };\n}\n\n// src/components/chat.ts\nvar encoder = new TextEncoder();\nvar decoder = new TextDecoder();\nvar encode = (message) => encoder.encode(JSON.stringify({ message: message.message, timestamp: message.timestamp }));\nvar decode = (message) => JSON.parse(decoder.decode(message));\nfunction setupChat(room, options) {\n  const onDestroyObservable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Subject();\n  const messageSubject = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Subject();\n  const { messageObservable } = setupDataMessageHandler(room, DataTopic.CHAT);\n  messageObservable.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.takeUntil)(onDestroyObservable)).subscribe(messageSubject);\n  const { messageDecoder, messageEncoder } = options != null ? options : {};\n  const finalMessageDecoder = messageDecoder != null ? messageDecoder : decode;\n  const messagesObservable = messageSubject.pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((msg) => {\n      const parsedMessage = finalMessageDecoder(msg.payload);\n      const newMessage = __spreadProps(__spreadValues({}, parsedMessage), { from: msg.from });\n      return newMessage;\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.scan)((acc, value) => [...acc, value], []),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.takeUntil)(onDestroyObservable)\n  );\n  const isSending$ = new rxjs__WEBPACK_IMPORTED_MODULE_6__.BehaviorSubject(false);\n  const finalMessageEncoder = messageEncoder != null ? messageEncoder : encode;\n  const send = (message) => __async(this, null, function* () {\n    const timestamp = Date.now();\n    const encodedMsg = finalMessageEncoder({ message, timestamp });\n    isSending$.next(true);\n    try {\n      yield sendMessage(room.localParticipant, encodedMsg, DataTopic.CHAT, {\n        kind: livekit_client__WEBPACK_IMPORTED_MODULE_0__.DataPacket_Kind.RELIABLE\n      });\n      messageSubject.next({\n        payload: encodedMsg,\n        topic: DataTopic.CHAT,\n        from: room.localParticipant\n      });\n    } finally {\n      isSending$.next(false);\n    }\n  });\n  function destroy() {\n    onDestroyObservable.next();\n    onDestroyObservable.complete();\n  }\n  return { messageObservable: messagesObservable, isSendingObservable: isSending$, send, destroy };\n}\n\n// src/components/startAudio.ts\nfunction setupStartAudio() {\n  const handleStartAudioPlayback = (room) => __async(this, null, function* () {\n    log.info(\"Start Audio for room: \", room);\n    yield room.startAudio();\n  });\n  const className = prefixClass(\"start-audio-button\");\n  return { className, roomAudioPlaybackAllowedObservable, handleStartAudioPlayback };\n}\n\n// src/components/chatToggle.ts\nfunction setupChatToggle() {\n  const className = [prefixClass(\"button\"), prefixClass(\"chat-toggle\")].join(\" \");\n  return { className };\n}\n\n// src/components/focusToggle.ts\nfunction setupFocusToggle() {\n  const className = [prefixClass(\"button\"), prefixClass(\"focus-toggle-button\")].join(\" \");\n  return { className };\n}\n\n// src/components/clearPinButton.ts\nfunction setupClearPinButton() {\n  const className = \"lk-clear-pin-button lk-button\";\n  return { className };\n}\n\n// src/components/room.ts\nfunction setupLiveKitRoom() {\n  const className = \"lk-room-container\";\n  return { className };\n}\n\n// src/observables/track.ts\n\n\nfunction trackObservable(track) {\n  const trackObserver = observeTrackEvents(\n    track,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.TrackEvent.Muted,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.TrackEvent.Unmuted,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.TrackEvent.Subscribed,\n    livekit_client__WEBPACK_IMPORTED_MODULE_0__.TrackEvent.Unsubscribed\n  );\n  return trackObserver;\n}\nfunction observeTrackEvents(track, ...events) {\n  const observable = new rxjs__WEBPACK_IMPORTED_MODULE_6__.Observable((subscribe) => {\n    const onTrackUpdate = () => {\n      subscribe.next(track);\n    };\n    events.forEach((evt) => {\n      track.on(evt, onTrackUpdate);\n    });\n    const unsubscribe = () => {\n      events.forEach((evt) => {\n        track.off(evt, onTrackUpdate);\n      });\n    };\n    return unsubscribe;\n  }).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(track));\n  return observable;\n}\nfunction getTrackReferences(room, sources, onlySubscribedTracks = true) {\n  const localParticipant = room.localParticipant;\n  const allParticipants = [localParticipant, ...Array.from(room.participants.values())];\n  const trackReferences = [];\n  allParticipants.forEach((participant) => {\n    sources.forEach((source) => {\n      const sourceReferences = Array.from(\n        participant.tracks.values()\n      ).filter(\n        (track) => track.source === source && // either return all or only the ones that are subscribed\n        (!onlySubscribedTracks || track.track)\n      ).map((track) => {\n        return {\n          participant,\n          publication: track,\n          source: track.source\n        };\n      });\n      trackReferences.push(...sourceReferences);\n    });\n  });\n  return { trackReferences, participants: allParticipants };\n}\nfunction trackReferencesObservable(room, sources, options) {\n  var _a, _b;\n  const additionalRoomEvents = (_a = options.additionalRoomEvents) != null ? _a : allParticipantRoomEvents;\n  const onlySubscribedTracks = (_b = options.onlySubscribed) != null ? _b : true;\n  const roomEvents = Array.from(\n    (/* @__PURE__ */ new Set([\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantConnected,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ParticipantDisconnected,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackPublished,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.LocalTrackUnpublished,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackPublished,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnpublished,\n      livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscriptionStatusChanged,\n      ...additionalRoomEvents\n    ])).values()\n  );\n  const observable = observeRoomEvents(room, ...roomEvents).pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)((room2) => {\n      const data = getTrackReferences(room2, sources, onlySubscribedTracks);\n      log.debug(`TrackReference[] was updated. (length ${data.trackReferences.length})`, data);\n      return data;\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.startWith)(getTrackReferences(room, sources, onlySubscribedTracks))\n  );\n  return observable;\n}\n\n// src/observables/dom-event.ts\n\nfunction createInteractingObservable(htmlElement, inactiveAfter = 1e3) {\n  if (htmlElement === null)\n    return (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.of)(false);\n  const move$ = (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.fromEvent)(htmlElement, \"mousemove\", { passive: true }).pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.map)(() => true));\n  const moveAndStop$ = move$.pipe(\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.timeout)({\n      each: inactiveAfter,\n      with: () => (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.concat)((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.of)(false), moveAndStop$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_6__.skipUntil)(move$)))\n    }),\n    (0,rxjs__WEBPACK_IMPORTED_MODULE_6__.distinctUntilChanged)()\n  );\n  return moveAndStop$;\n}\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQGxpdmVraXQrY29tcG9uZW50cy1jb3JlQDAuNy4wX2xpdmVraXQtY2xpZW50QDEuMTQuNC9ub2RlX21vZHVsZXMvQGxpdmVraXQvY29tcG9uZW50cy1jb3JlL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLDZEQUE2RDtBQUMzSTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNxRTs7QUFFckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGVBQWU7QUFDN0IsSUFBSTtBQUNKLGNBQWMsb0NBQW9DLEdBQUcsc0JBQXNCO0FBQzNFLElBQUk7QUFDSixjQUFjLG9DQUFvQyxHQUFHLGtDQUFrQyxHQUFHLG9DQUFvQztBQUM5SCxJQUFJO0FBQ0osMEVBQTBFLGVBQWU7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFD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QUFDckY7QUFDQSxLQUFLO0FBQ0wsSUFBSSwrQ0FBVTtBQUNkO0FBQ0E7QUFDQTs7QUFFQTtBQUMrRztBQUMvRztBQUNBO0FBQ0EsV0FBVyx3Q0FBRTtBQUNiLGdCQUFnQiwrQ0FBUyw2QkFBNkIsZUFBZSxPQUFPLHlDQUFJO0FBQ2hGO0FBQ0EsSUFBSSw2Q0FBTztBQUNYO0FBQ0Esa0JBQWtCLDRDQUFPLENBQUMsd0NBQUUsMkJBQTJCLCtDQUFTO0FBQ2hFLEtBQUs7QUFDTCxJQUFJLDBEQUFvQjtBQUN4QjtBQUNBO0FBQ0E7QUF1RkU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL215LWFwcC8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbGl2ZWtpdCtjb21wb25lbnRzLWNvcmVAMC43LjBfbGl2ZWtpdC1jbGllbnRAMS4xNC40L25vZGVfbW9kdWxlcy9AbGl2ZWtpdC9jb21wb25lbnRzLWNvcmUvZGlzdC9pbmRleC5tanM/NWE1MiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xudmFyIF9fZGVmUHJvcHMgPSBPYmplY3QuZGVmaW5lUHJvcGVydGllcztcbnZhciBfX2dldE93blByb3BEZXNjcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzO1xudmFyIF9fZ2V0T3duUHJvcFN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzO1xudmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgX19wcm9wSXNFbnVtID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTtcbnZhciBfX2RlZk5vcm1hbFByb3AgPSAob2JqLCBrZXksIHZhbHVlKSA9PiBrZXkgaW4gb2JqID8gX19kZWZQcm9wKG9iaiwga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUsIHZhbHVlIH0pIDogb2JqW2tleV0gPSB2YWx1ZTtcbnZhciBfX3NwcmVhZFZhbHVlcyA9IChhLCBiKSA9PiB7XG4gIGZvciAodmFyIHByb3AgaW4gYiB8fCAoYiA9IHt9KSlcbiAgICBpZiAoX19oYXNPd25Qcm9wLmNhbGwoYiwgcHJvcCkpXG4gICAgICBfX2RlZk5vcm1hbFByb3AoYSwgcHJvcCwgYltwcm9wXSk7XG4gIGlmIChfX2dldE93blByb3BTeW1ib2xzKVxuICAgIGZvciAodmFyIHByb3Agb2YgX19nZXRPd25Qcm9wU3ltYm9scyhiKSkge1xuICAgICAgaWYgKF9fcHJvcElzRW51bS5jYWxsKGIsIHByb3ApKVxuICAgICAgICBfX2RlZk5vcm1hbFByb3AoYSwgcHJvcCwgYltwcm9wXSk7XG4gICAgfVxuICByZXR1cm4gYTtcbn07XG52YXIgX19zcHJlYWRQcm9wcyA9IChhLCBiKSA9PiBfX2RlZlByb3BzKGEsIF9fZ2V0T3duUHJvcERlc2NzKGIpKTtcbnZhciBfX2FzeW5jID0gKF9fdGhpcywgX19hcmd1bWVudHMsIGdlbmVyYXRvcikgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHZhciBmdWxmaWxsZWQgPSAodmFsdWUpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlamVjdGVkID0gKHZhbHVlKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBzdGVwKGdlbmVyYXRvci50aHJvdyh2YWx1ZSkpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZWplY3QoZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc3RlcCA9ICh4KSA9PiB4LmRvbmUgPyByZXNvbHZlKHgudmFsdWUpIDogUHJvbWlzZS5yZXNvbHZlKHgudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7XG4gICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KF9fdGhpcywgX19hcmd1bWVudHMpKS5uZXh0KCkpO1xuICB9KTtcbn07XG5cbi8vIHNyYy9jb25zdGFudHMudHNcbnZhciBjc3NQcmVmaXggPSBcImxrXCI7XG5cbi8vIHNyYy91dGlscy50c1xuaW1wb3J0IHsgTG9jYWxQYXJ0aWNpcGFudCwgUmVtb3RlUGFydGljaXBhbnQgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcblxuLy8gc3JjL3RyYWNrLXJlZmVyZW5jZS90cmFjay1yZWZlcmVuY2UudHlwZXMudHNcbmZ1bmN0aW9uIGlzVHJhY2tSZWZlcmVuY2UodHJhY2tSZWZlcmVuY2UpIHtcbiAgaWYgKHR5cGVvZiB0cmFja1JlZmVyZW5jZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gaXNUcmFja1JlZmVyZW5jZVN1YnNjcmliZWQodHJhY2tSZWZlcmVuY2UpIHx8IGlzVHJhY2tSZWZlcmVuY2VQdWJsaXNoZWQodHJhY2tSZWZlcmVuY2UpO1xufVxuZnVuY3Rpb24gaXNUcmFja1JlZmVyZW5jZVN1YnNjcmliZWQodHJhY2tSZWZlcmVuY2UpIHtcbiAgdmFyIF9hO1xuICBpZiAoIXRyYWNrUmVmZXJlbmNlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cmFja1JlZmVyZW5jZS5oYXNPd25Qcm9wZXJ0eShcInBhcnRpY2lwYW50XCIpICYmIHRyYWNrUmVmZXJlbmNlLmhhc093blByb3BlcnR5KFwic291cmNlXCIpICYmIHRyYWNrUmVmZXJlbmNlLmhhc093blByb3BlcnR5KFwidHJhY2tcIikgJiYgdHlwZW9mICgoX2EgPSB0cmFja1JlZmVyZW5jZS5wdWJsaWNhdGlvbikgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnRyYWNrKSAhPT0gXCJ1bmRlZmluZWRcIjtcbn1cbmZ1bmN0aW9uIGlzVHJhY2tSZWZlcmVuY2VQdWJsaXNoZWQodHJhY2tSZWZlcmVuY2UpIHtcbiAgaWYgKCF0cmFja1JlZmVyZW5jZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJhY2tSZWZlcmVuY2UuaGFzT3duUHJvcGVydHkoXCJwYXJ0aWNpcGFudFwiKSAmJiB0cmFja1JlZmVyZW5jZS5oYXNPd25Qcm9wZXJ0eShcInNvdXJjZVwiKSAmJiB0cmFja1JlZmVyZW5jZS5oYXNPd25Qcm9wZXJ0eShcInB1YmxpY2F0aW9uXCIpICYmIHR5cGVvZiB0cmFja1JlZmVyZW5jZS5wdWJsaWNhdGlvbiAhPT0gXCJ1bmRlZmluZWRcIjtcbn1cbmZ1bmN0aW9uIGlzVHJhY2tSZWZlcmVuY2VQbGFjZWhvbGRlcih0cmFja1JlZmVyZW5jZSkge1xuICBpZiAoIXRyYWNrUmVmZXJlbmNlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cmFja1JlZmVyZW5jZS5oYXNPd25Qcm9wZXJ0eShcInBhcnRpY2lwYW50XCIpICYmIHRyYWNrUmVmZXJlbmNlLmhhc093blByb3BlcnR5KFwic291cmNlXCIpICYmIHR5cGVvZiB0cmFja1JlZmVyZW5jZS5wdWJsaWNhdGlvbiA9PT0gXCJ1bmRlZmluZWRcIjtcbn1cblxuLy8gc3JjL3RyYWNrLXJlZmVyZW5jZS90cmFjay1yZWZlcmVuY2UudXRpbHMudHNcbmZ1bmN0aW9uIGdldFRyYWNrUmVmZXJlbmNlSWQodHJhY2tSZWZlcmVuY2UpIHtcbiAgaWYgKHR5cGVvZiB0cmFja1JlZmVyZW5jZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgdHJhY2tSZWZlcmVuY2UgPT09IFwibnVtYmVyXCIpIHtcbiAgICByZXR1cm4gYCR7dHJhY2tSZWZlcmVuY2V9YDtcbiAgfSBlbHNlIGlmIChpc1RyYWNrUmVmZXJlbmNlUGxhY2Vob2xkZXIodHJhY2tSZWZlcmVuY2UpKSB7XG4gICAgcmV0dXJuIGAke3RyYWNrUmVmZXJlbmNlLnBhcnRpY2lwYW50LmlkZW50aXR5fV8ke3RyYWNrUmVmZXJlbmNlLnNvdXJjZX1fcGxhY2Vob2xkZXJgO1xuICB9IGVsc2UgaWYgKGlzVHJhY2tSZWZlcmVuY2UodHJhY2tSZWZlcmVuY2UpKSB7XG4gICAgcmV0dXJuIGAke3RyYWNrUmVmZXJlbmNlLnBhcnRpY2lwYW50LmlkZW50aXR5fV8ke3RyYWNrUmVmZXJlbmNlLnB1YmxpY2F0aW9uLnNvdXJjZX1fJHt0cmFja1JlZmVyZW5jZS5wdWJsaWNhdGlvbi50cmFja1NpZH1gO1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZ2VuZXJhdGUgYSBpZCBmb3IgdGhlIGdpdmVuIHRyYWNrIHJlZmVyZW5jZTogJHt0cmFja1JlZmVyZW5jZX1gKTtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0VHJhY2tSZWZlcmVuY2VTb3VyY2UodHJhY2tSZWZlcmVuY2UpIHtcbiAgaWYgKGlzVHJhY2tSZWZlcmVuY2UodHJhY2tSZWZlcmVuY2UpKSB7XG4gICAgcmV0dXJuIHRyYWNrUmVmZXJlbmNlLnB1YmxpY2F0aW9uLnNvdXJjZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdHJhY2tSZWZlcmVuY2Uuc291cmNlO1xuICB9XG59XG5mdW5jdGlvbiBpc0VxdWFsVHJhY2tSZWYoYSwgYikge1xuICBpZiAoYSA9PT0gdm9pZCAwIHx8IGIgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAoaXNUcmFja1JlZmVyZW5jZShhKSAmJiBpc1RyYWNrUmVmZXJlbmNlKGIpKSB7XG4gICAgcmV0dXJuIGEucHVibGljYXRpb24udHJhY2tTaWQgPT09IGIucHVibGljYXRpb24udHJhY2tTaWQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGdldFRyYWNrUmVmZXJlbmNlSWQoYSkgPT09IGdldFRyYWNrUmVmZXJlbmNlSWQoYik7XG4gIH1cbn1cbmZ1bmN0aW9uIGlzVHJhY2tSZWZlcmVuY2VQaW5uZWQodHJhY2tSZWZlcmVuY2UsIHBpblN0YXRlKSB7XG4gIGlmICh0eXBlb2YgcGluU3RhdGUgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKGlzVHJhY2tSZWZlcmVuY2UodHJhY2tSZWZlcmVuY2UpKSB7XG4gICAgcmV0dXJuIHBpblN0YXRlLnNvbWUoXG4gICAgICAocGlubmVkVHJhY2tSZWZlcmVuY2UpID0+IHBpbm5lZFRyYWNrUmVmZXJlbmNlLnBhcnRpY2lwYW50LmlkZW50aXR5ID09PSB0cmFja1JlZmVyZW5jZS5wYXJ0aWNpcGFudC5pZGVudGl0eSAmJiBpc1RyYWNrUmVmZXJlbmNlKHBpbm5lZFRyYWNrUmVmZXJlbmNlKSAmJiBwaW5uZWRUcmFja1JlZmVyZW5jZS5wdWJsaWNhdGlvbi50cmFja1NpZCA9PT0gdHJhY2tSZWZlcmVuY2UucHVibGljYXRpb24udHJhY2tTaWRcbiAgICApO1xuICB9IGVsc2UgaWYgKGlzVHJhY2tSZWZlcmVuY2VQbGFjZWhvbGRlcih0cmFja1JlZmVyZW5jZSkpIHtcbiAgICByZXR1cm4gcGluU3RhdGUuc29tZShcbiAgICAgIChwaW5uZWRUcmFja1JlZmVyZW5jZSkgPT4gcGlubmVkVHJhY2tSZWZlcmVuY2UucGFydGljaXBhbnQuaWRlbnRpdHkgPT09IHRyYWNrUmVmZXJlbmNlLnBhcnRpY2lwYW50LmlkZW50aXR5ICYmIGlzVHJhY2tSZWZlcmVuY2VQbGFjZWhvbGRlcihwaW5uZWRUcmFja1JlZmVyZW5jZSkgJiYgcGlubmVkVHJhY2tSZWZlcmVuY2Uuc291cmNlID09PSB0cmFja1JlZmVyZW5jZS5zb3VyY2VcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuZnVuY3Rpb24gaXNQbGFjZWhvbGRlclJlcGxhY2VtZW50KGN1cnJlbnRUcmFja1JlZiwgbmV4dFRyYWNrUmVmKSB7XG4gIHJldHVybiBpc1RyYWNrUmVmZXJlbmNlUGxhY2Vob2xkZXIoY3VycmVudFRyYWNrUmVmKSAmJiBpc1RyYWNrUmVmZXJlbmNlKG5leHRUcmFja1JlZikgJiYgbmV4dFRyYWNrUmVmLnBhcnRpY2lwYW50LmlkZW50aXR5ID09PSBjdXJyZW50VHJhY2tSZWYucGFydGljaXBhbnQuaWRlbnRpdHkgJiYgbmV4dFRyYWNrUmVmLnNvdXJjZSA9PT0gY3VycmVudFRyYWNrUmVmLnNvdXJjZTtcbn1cblxuLy8gc3JjL3V0aWxzLnRzXG5mdW5jdGlvbiBpc0xvY2FsKHApIHtcbiAgcmV0dXJuIHAgaW5zdGFuY2VvZiBMb2NhbFBhcnRpY2lwYW50O1xufVxuZnVuY3Rpb24gaXNSZW1vdGUocCkge1xuICByZXR1cm4gcCBpbnN0YW5jZW9mIFJlbW90ZVBhcnRpY2lwYW50O1xufVxudmFyIGF0dGFjaElmU3Vic2NyaWJlZCA9IChwdWJsaWNhdGlvbiwgZWxlbWVudCkgPT4ge1xuICBpZiAoIXB1YmxpY2F0aW9uKVxuICAgIHJldHVybjtcbiAgY29uc3QgeyBpc1N1YnNjcmliZWQsIHRyYWNrIH0gPSBwdWJsaWNhdGlvbjtcbiAgaWYgKGVsZW1lbnQgJiYgdHJhY2spIHtcbiAgICBpZiAoaXNTdWJzY3JpYmVkKSB7XG4gICAgICB0cmFjay5hdHRhY2goZWxlbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRyYWNrLmRldGFjaChlbGVtZW50KTtcbiAgICB9XG4gIH1cbn07XG5mdW5jdGlvbiBpc1BhcnRpY2lwYW50U291cmNlUGlubmVkKHBhcnRpY2lwYW50LCBzb3VyY2UsIHBpblN0YXRlKSB7XG4gIGlmIChwaW5TdGF0ZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBwaW5TdGF0ZS5zb21lKFxuICAgICh7IHNvdXJjZTogcGlubmVkU291cmNlLCBwYXJ0aWNpcGFudDogcGlubmVkUGFydGljaXBhbnQgfSkgPT4gcGlubmVkU291cmNlID09PSBzb3VyY2UgJiYgcGlubmVkUGFydGljaXBhbnQuaWRlbnRpdHkgPT09IHBhcnRpY2lwYW50LmlkZW50aXR5XG4gICk7XG59XG5mdW5jdGlvbiBpc1BhcnRpY2lwYW50VHJhY2tSZWZlcmVuY2VQaW5uZWQodHJhY2tSZWYsIHBpblN0YXRlKSB7XG4gIGlmIChwaW5TdGF0ZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBwaW5TdGF0ZS5zb21lKChwaW5uZWRUcmFja1JlZikgPT4gaXNFcXVhbFRyYWNrUmVmKHBpbm5lZFRyYWNrUmVmLCB0cmFja1JlZikpO1xufVxuZnVuY3Rpb24gZ2V0U2Nyb2xsQmFyV2lkdGgoKSB7XG4gIGNvbnN0IGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gIGlubmVyLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gIGlubmVyLnN0eWxlLmhlaWdodCA9IFwiMjAwcHhcIjtcbiAgY29uc3Qgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBvdXRlci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgb3V0ZXIuc3R5bGUudG9wID0gXCIwcHhcIjtcbiAgb3V0ZXIuc3R5bGUubGVmdCA9IFwiMHB4XCI7XG4gIG91dGVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICBvdXRlci5zdHlsZS53aWR0aCA9IFwiMjAwcHhcIjtcbiAgb3V0ZXIuc3R5bGUuaGVpZ2h0ID0gXCIxNTBweFwiO1xuICBvdXRlci5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gIG91dGVyLmFwcGVuZENoaWxkKGlubmVyKTtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdXRlcik7XG4gIGNvbnN0IHcxID0gaW5uZXIub2Zmc2V0V2lkdGg7XG4gIG91dGVyLnN0eWxlLm92ZXJmbG93ID0gXCJzY3JvbGxcIjtcbiAgbGV0IHcyID0gaW5uZXIub2Zmc2V0V2lkdGg7XG4gIGlmICh3MSA9PT0gdzIpIHtcbiAgICB3MiA9IG91dGVyLmNsaWVudFdpZHRoO1xuICB9XG4gIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3V0ZXIpO1xuICBjb25zdCBzY3JvbGxCYXJXaWR0aCA9IHcxIC0gdzI7XG4gIHJldHVybiBzY3JvbGxCYXJXaWR0aDtcbn1cblxuLy8gc3JjL2hlbHBlci9kZXRlY3RNb2JpbGVCcm93c2VyLnRzXG5mdW5jdGlvbiBpc1dlYigpIHtcbiAgcmV0dXJuIHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIjtcbn1cbmZ1bmN0aW9uIGlzTW9iaWxlQnJvd3NlcigpIHtcbiAgcmV0dXJuIGlzV2ViKCkgPyAvTW9iaS9pLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpIDogZmFsc2U7XG59XG5cbi8vIHNyYy9oZWxwZXIvdXJsUmVnZXgudHNcbmltcG9ydCB7IFRMRHMgfSBmcm9tIFwiZ2xvYmFsLXRsZC1saXN0XCI7XG52YXIgY3JlYXRlVXJsUmVnRXhwID0gKG9wdGlvbnMpID0+IHtcbiAgb3B0aW9ucyA9IF9fc3ByZWFkVmFsdWVzKHtcbiAgICBzdHJpY3Q6IHRydWVcbiAgfSwgb3B0aW9ucyk7XG4gIGNvbnN0IHByb3RvY29sID0gYCg/Oig/OlthLXpdKzopPy8vKSR7b3B0aW9ucy5zdHJpY3QgPyBcIlwiIDogXCI/XCJ9YDtcbiAgY29uc3QgYXV0aCA9IFwiKD86XFxcXFMrKD86OlxcXFxTKik/QCk/XCI7XG4gIGNvbnN0IGlwID0gbmV3IFJlZ0V4cChcbiAgICBcIig/OjI1WzAtNV18MlswLTRdXFxcXGR8MVxcXFxkXFxcXGR8WzEtOV1cXFxcZHxcXFxcZCkoPzpcXFxcLig/OjI1WzAtNV18MlswLTRdXFxcXGR8MVxcXFxkXFxcXGR8WzEtOV1cXFxcZHxcXFxcZCkpezN9XCIsXG4gICAgXCJnXCJcbiAgKS5zb3VyY2U7XG4gIGNvbnN0IGhvc3QgPSBcIig/Oig/OlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XVstX10qKSpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rKVwiO1xuICBjb25zdCBkb21haW4gPSBcIig/OlxcXFwuKD86W2EtelxcXFx1MDBhMS1cXFxcdWZmZmYwLTldLSopKlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XSspKlwiO1xuICBjb25zdCB0bGQgPSBgKD86XFxcXC4ke29wdGlvbnMuc3RyaWN0ID8gXCIoPzpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZl17Mix9KVwiIDogYCg/OiR7VExEcy5zb3J0KChhLCBiKSA9PiBiLmxlbmd0aCAtIGEubGVuZ3RoKS5qb2luKFwifFwiKX0pYH0pXFxcXC4/YDtcbiAgY29uc3QgcG9ydCA9IFwiKD86OlxcXFxkezIsNX0pP1wiO1xuICBjb25zdCBwYXRoID0gJyg/OlsvPyNdW15cXFxcc1wiXSopPyc7XG4gIGNvbnN0IHJlZ2V4ID0gYCg/OiR7cHJvdG9jb2x9fHd3d1xcXFwuKSR7YXV0aH0oPzpsb2NhbGhvc3R8JHtpcH18JHtob3N0fSR7ZG9tYWlufSR7dGxkfSkke3BvcnR9JHtwYXRofWA7XG4gIHJldHVybiBvcHRpb25zLmV4YWN0ID8gbmV3IFJlZ0V4cChgKD86XiR7cmVnZXh9JClgLCBcImlcIikgOiBuZXcgUmVnRXhwKHJlZ2V4LCBcImlnXCIpO1xufTtcblxuLy8gc3JjL2hlbHBlci9lbWFpbFJlZ2V4LnRzXG5pbXBvcnQgY3JlYXRlRW1haWxSZWdFeHAgZnJvbSBcImVtYWlsLXJlZ2V4XCI7XG5cbi8vIHNyYy9oZWxwZXIvZmxvYXRpbmctbWVudS50c1xuaW1wb3J0IHsgY29tcHV0ZVBvc2l0aW9uLCBmbGlwLCBvZmZzZXQsIHNoaWZ0IH0gZnJvbSBcIkBmbG9hdGluZy11aS9kb21cIjtcbmZ1bmN0aW9uIGNvbXB1dGVNZW51UG9zaXRpb24oYnV0dG9uLCBtZW51KSB7XG4gIHJldHVybiBfX2FzeW5jKHRoaXMsIG51bGwsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgeyB4LCB5IH0gPSB5aWVsZCBjb21wdXRlUG9zaXRpb24oYnV0dG9uLCBtZW51LCB7XG4gICAgICBwbGFjZW1lbnQ6IFwidG9wXCIsXG4gICAgICBtaWRkbGV3YXJlOiBbb2Zmc2V0KDYpLCBmbGlwKCksIHNoaWZ0KHsgcGFkZGluZzogNSB9KV1cbiAgICB9KTtcbiAgICByZXR1cm4geyB4LCB5IH07XG4gIH0pO1xufVxuZnVuY3Rpb24gd2FzQ2xpY2tPdXRzaWRlKGluc2lkZUVsZW1lbnQsIGV2ZW50KSB7XG4gIGNvbnN0IGlzT3V0c2lkZSA9ICFpbnNpZGVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCk7XG4gIHJldHVybiBpc091dHNpZGU7XG59XG5cbi8vIHNyYy9oZWxwZXIvdG9rZW5pemVyLnRzXG52YXIgY3JlYXRlRGVmYXVsdEdyYW1tYXIgPSAoKSA9PiB7XG4gIHJldHVybiB7XG4gICAgZW1haWw6IGNyZWF0ZUVtYWlsUmVnRXhwKCksXG4gICAgdXJsOiBjcmVhdGVVcmxSZWdFeHAoeyBzdHJpY3Q6IGZhbHNlIH0pXG4gIH07XG59O1xuZnVuY3Rpb24gdG9rZW5pemUoaW5wdXQsIGdyYW1tYXIpIHtcbiAgY29uc3QgbWF0Y2hlcyA9IE9iamVjdC5lbnRyaWVzKGdyYW1tYXIpLm1hcChcbiAgICAoW3R5cGUsIHJ4XSwgd2VpZ2h0KSA9PiBBcnJheS5mcm9tKGlucHV0Lm1hdGNoQWxsKHJ4KSkubWFwKCh7IGluZGV4LCAwOiBjb250ZW50IH0pID0+ICh7XG4gICAgICB0eXBlLFxuICAgICAgd2VpZ2h0LFxuICAgICAgY29udGVudCxcbiAgICAgIGluZGV4OiBpbmRleCAhPSBudWxsID8gaW5kZXggOiAwXG4gICAgfSkpXG4gICkuZmxhdCgpLnNvcnQoKGEsIGIpID0+IHtcbiAgICBjb25zdCBkID0gYS5pbmRleCAtIGIuaW5kZXg7XG4gICAgcmV0dXJuIGQgIT09IDAgPyBkIDogYS53ZWlnaHQgLSBiLndlaWdodDtcbiAgfSkuZmlsdGVyKCh7IGluZGV4IH0sIGksIGFycikgPT4ge1xuICAgIGlmIChpID09PSAwKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgY29uc3QgcHJldiA9IGFycltpIC0gMV07XG4gICAgcmV0dXJuIHByZXYuaW5kZXggKyBwcmV2LmNvbnRlbnQubGVuZ3RoIDw9IGluZGV4O1xuICB9KTtcbiAgY29uc3QgdG9rZW5zID0gW107XG4gIGxldCBwb3MgPSAwO1xuICBmb3IgKGNvbnN0IHsgdHlwZSwgY29udGVudCwgaW5kZXggfSBvZiBtYXRjaGVzKSB7XG4gICAgaWYgKGluZGV4ID4gcG9zKVxuICAgICAgdG9rZW5zLnB1c2goaW5wdXQuc3Vic3RyaW5nKHBvcywgaW5kZXgpKTtcbiAgICB0b2tlbnMucHVzaCh7IHR5cGUsIGNvbnRlbnQgfSk7XG4gICAgcG9zID0gaW5kZXggKyBjb250ZW50Lmxlbmd0aDtcbiAgfVxuICBpZiAoaW5wdXQubGVuZ3RoID4gcG9zKVxuICAgIHRva2Vucy5wdXNoKGlucHV0LnN1YnN0cmluZyhwb3MpKTtcbiAgcmV0dXJuIHRva2Vucztcbn1cblxuLy8gc3JjL2hlbHBlci9ldmVudEdyb3Vwcy50c1xuaW1wb3J0IHsgUGFydGljaXBhbnRFdmVudCwgUm9vbUV2ZW50IH0gZnJvbSBcImxpdmVraXQtY2xpZW50XCI7XG52YXIgYWxsUmVtb3RlUGFydGljaXBhbnRSb29tRXZlbnRzID0gW1xuICBSb29tRXZlbnQuQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCxcbiAgUm9vbUV2ZW50LlJvb21NZXRhZGF0YUNoYW5nZWQsXG4gIFJvb21FdmVudC5BY3RpdmVTcGVha2Vyc0NoYW5nZWQsXG4gIFJvb21FdmVudC5Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQsXG4gIFJvb21FdmVudC5QYXJ0aWNpcGFudENvbm5lY3RlZCxcbiAgUm9vbUV2ZW50LlBhcnRpY2lwYW50RGlzY29ubmVjdGVkLFxuICBSb29tRXZlbnQuUGFydGljaXBhbnRQZXJtaXNzaW9uc0NoYW5nZWQsXG4gIFJvb21FdmVudC5QYXJ0aWNpcGFudE1ldGFkYXRhQ2hhbmdlZCxcbiAgUm9vbUV2ZW50LlRyYWNrTXV0ZWQsXG4gIFJvb21FdmVudC5UcmFja1VubXV0ZWQsXG4gIFJvb21FdmVudC5UcmFja1B1Ymxpc2hlZCxcbiAgUm9vbUV2ZW50LlRyYWNrVW5wdWJsaXNoZWQsXG4gIFJvb21FdmVudC5UcmFja1N0cmVhbVN0YXRlQ2hhbmdlZCxcbiAgUm9vbUV2ZW50LlRyYWNrU3Vic2NyaXB0aW9uRmFpbGVkLFxuICBSb29tRXZlbnQuVHJhY2tTdWJzY3JpcHRpb25QZXJtaXNzaW9uQ2hhbmdlZCxcbiAgUm9vbUV2ZW50LlRyYWNrU3Vic2NyaXB0aW9uU3RhdHVzQ2hhbmdlZFxuXTtcbnZhciBhbGxQYXJ0aWNpcGFudFJvb21FdmVudHMgPSBbXG4gIC4uLmFsbFJlbW90ZVBhcnRpY2lwYW50Um9vbUV2ZW50cyxcbiAgUm9vbUV2ZW50LkxvY2FsVHJhY2tQdWJsaXNoZWQsXG4gIFJvb21FdmVudC5Mb2NhbFRyYWNrVW5wdWJsaXNoZWRcbl07XG52YXIgYWxsUmVtb3RlUGFydGljaXBhbnRFdmVudHMgPSBbXG4gIFBhcnRpY2lwYW50RXZlbnQuQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkLFxuICBQYXJ0aWNpcGFudEV2ZW50LklzU3BlYWtpbmdDaGFuZ2VkLFxuICBQYXJ0aWNpcGFudEV2ZW50LlBhcnRpY2lwYW50TWV0YWRhdGFDaGFuZ2VkLFxuICBQYXJ0aWNpcGFudEV2ZW50LlBhcnRpY2lwYW50UGVybWlzc2lvbnNDaGFuZ2VkLFxuICBQYXJ0aWNpcGFudEV2ZW50LlRyYWNrTXV0ZWQsXG4gIFBhcnRpY2lwYW50RXZlbnQuVHJhY2tVbm11dGVkLFxuICBQYXJ0aWNpcGFudEV2ZW50LlRyYWNrUHVibGlzaGVkLFxuICBQYXJ0aWNpcGFudEV2ZW50LlRyYWNrVW5wdWJsaXNoZWQsXG4gIFBhcnRpY2lwYW50RXZlbnQuVHJhY2tTdHJlYW1TdGF0ZUNoYW5nZWQsXG4gIFBhcnRpY2lwYW50RXZlbnQuVHJhY2tTdWJzY3JpcHRpb25GYWlsZWQsXG4gIFBhcnRpY2lwYW50RXZlbnQuVHJhY2tTdWJzY3JpcHRpb25QZXJtaXNzaW9uQ2hhbmdlZCxcbiAgUGFydGljaXBhbnRFdmVudC5UcmFja1N1YnNjcmlwdGlvblN0YXR1c0NoYW5nZWRcbl07XG52YXIgYWxsUGFydGljaXBhbnRFdmVudHMgPSBbXG4gIC4uLmFsbFJlbW90ZVBhcnRpY2lwYW50RXZlbnRzLFxuICBQYXJ0aWNpcGFudEV2ZW50LkxvY2FsVHJhY2tQdWJsaXNoZWQsXG4gIFBhcnRpY2lwYW50RXZlbnQuTG9jYWxUcmFja1VucHVibGlzaGVkXG5dO1xuXG4vLyBzcmMvbG9nZ2VyLnRzXG5pbXBvcnQgeyBzZXRMb2dMZXZlbCBhcyBzZXRDbGllbnRTZGtMb2dMZXZlbCB9IGZyb20gXCJsaXZla2l0LWNsaWVudFwiO1xuaW1wb3J0IGxvZ2xldmVsIGZyb20gXCJsb2dsZXZlbFwiO1xudmFyIGxvZyA9IGxvZ2xldmVsLmdldExvZ2dlcihcImxrLWNvbXBvbmVudHMtanNcIik7XG5sb2cuc2V0RGVmYXVsdExldmVsKFwiV0FSTlwiKTtcbmZ1bmN0aW9uIHNldExvZ0xldmVsKGxldmVsLCBvcHRpb25zID0ge30pIHtcbiAgdmFyIF9hO1xuICBsb2cuc2V0TGV2ZWwobGV2ZWwpO1xuICBzZXRDbGllbnRTZGtMb2dMZXZlbCgoX2EgPSBvcHRpb25zLmxpdmVLaXRDbGllbnRMb2dMZXZlbCkgIT0gbnVsbCA/IF9hIDogbGV2ZWwpO1xufVxuXG4vLyBzcmMvaGVscGVyL2dyaWQtbGF5b3V0cy50c1xudmFyIEdSSURfTEFZT1VUUyA9IFtcbiAge1xuICAgIGNvbHVtbnM6IDEsXG4gICAgcm93czogMSxcbiAgICBuYW1lOiBcIjF4MVwiLFxuICAgIG1pblRpbGVzOiAxLFxuICAgIG1heFRpbGVzOiAxLFxuICAgIG1pbldpZHRoOiAwLFxuICAgIG1pbkhlaWdodDogMFxuICB9LFxuICB7XG4gICAgY29sdW1uczogMSxcbiAgICByb3dzOiAyLFxuICAgIG5hbWU6IFwiMXgyXCIsXG4gICAgbWluVGlsZXM6IDIsXG4gICAgbWF4VGlsZXM6IDIsXG4gICAgbWluV2lkdGg6IDAsXG4gICAgbWluSGVpZ2h0OiAwXG4gIH0sXG4gIHtcbiAgICBjb2x1bW5zOiAyLFxuICAgIHJvd3M6IDEsXG4gICAgbmFtZTogXCIyeDFcIixcbiAgICBtaW5UaWxlczogMixcbiAgICBtYXhUaWxlczogMixcbiAgICBtaW5XaWR0aDogOTAwLFxuICAgIG1pbkhlaWdodDogMFxuICB9LFxuICB7XG4gICAgY29sdW1uczogMixcbiAgICByb3dzOiAyLFxuICAgIG5hbWU6IFwiMngyXCIsXG4gICAgbWluVGlsZXM6IDMsXG4gICAgbWF4VGlsZXM6IDQsXG4gICAgbWluV2lkdGg6IDU2MCxcbiAgICBtaW5IZWlnaHQ6IDBcbiAgfSxcbiAge1xuICAgIGNvbHVtbnM6IDMsXG4gICAgcm93czogMyxcbiAgICBuYW1lOiBcIjN4M1wiLFxuICAgIG1pblRpbGVzOiA1LFxuICAgIG1heFRpbGVzOiA5LFxuICAgIG1pbldpZHRoOiA3MDAsXG4gICAgbWluSGVpZ2h0OiAwXG4gIH0sXG4gIHtcbiAgICBjb2x1bW5zOiA0LFxuICAgIHJvd3M6IDQsXG4gICAgbmFtZTogXCI0eDRcIixcbiAgICBtaW5UaWxlczogMTAsXG4gICAgbWF4VGlsZXM6IDE2LFxuICAgIG1pbldpZHRoOiA5NjAsXG4gICAgbWluSGVpZ2h0OiAwXG4gIH0sXG4gIHtcbiAgICBjb2x1bW5zOiA1LFxuICAgIHJvd3M6IDUsXG4gICAgbmFtZTogXCI1eDVcIixcbiAgICBtaW5UaWxlczogMTcsXG4gICAgbWF4VGlsZXM6IDI1LFxuICAgIG1pbldpZHRoOiAxMTAwLFxuICAgIG1pbkhlaWdodDogMFxuICB9XG5dO1xuZnVuY3Rpb24gc2VsZWN0R3JpZExheW91dChsYXlvdXRzLCBwYXJ0aWNpcGFudENvdW50LCB3aWR0aCwgaGVpZ2h0KSB7XG4gIGxldCBjdXJyZW50TGF5b3V0SW5kZXggPSAwO1xuICBsZXQgbGF5b3V0ID0gbGF5b3V0cy5maW5kKChsYXlvdXRfLCBpbmRleCwgYWxsTGF5b3V0cykgPT4ge1xuICAgIGN1cnJlbnRMYXlvdXRJbmRleCA9IGluZGV4O1xuICAgIGNvbnN0IGlzQmlnZ2VyTGF5b3V0QXZhaWxhYmxlID0gYWxsTGF5b3V0cy5maW5kSW5kZXgoKGwsIGkpID0+IHtcbiAgICAgIGNvbnN0IGxheW91dElzQmlnZ2VyVGhhbkN1cnJlbnQgPSBpID4gaW5kZXg7XG4gICAgICBjb25zdCBsYXlvdXRGaXRzU2FtZUFtb3VudE9mUGFydGljaXBhbnRzID0gbC5tYXhUaWxlcyA9PT0gbGF5b3V0Xy5tYXhUaWxlcztcbiAgICAgIHJldHVybiBsYXlvdXRJc0JpZ2dlclRoYW5DdXJyZW50ICYmIGxheW91dEZpdHNTYW1lQW1vdW50T2ZQYXJ0aWNpcGFudHM7XG4gICAgfSkgIT09IC0xO1xuICAgIHJldHVybiBsYXlvdXRfLm1heFRpbGVzID49IHBhcnRpY2lwYW50Q291bnQgJiYgIWlzQmlnZ2VyTGF5b3V0QXZhaWxhYmxlO1xuICB9KTtcbiAgaWYgKGxheW91dCA9PT0gdm9pZCAwKSB7XG4gICAgbGF5b3V0ID0gbGF5b3V0c1tsYXlvdXRzLmxlbmd0aCAtIDFdO1xuICAgIGlmIChsYXlvdXQpIHtcbiAgICAgIGxvZy53YXJuKFxuICAgICAgICBgTm8gbGF5b3V0IGZvdW5kIGZvcjogcGFydGljaXBhbnRDb3VudDogJHtwYXJ0aWNpcGFudENvdW50fSwgd2lkdGgvaGVpZ2h0OiAke3dpZHRofS8ke2hlaWdodH0gZmFsbGJhY2sgdG8gYmlnZ2VzdCBhdmFpbGFibGUgbGF5b3V0ICgke2xheW91dC5uYW1lfSkuYFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBsYXlvdXQgb3IgZmFsbGJhY2sgbGF5b3V0IGZvdW5kLmApO1xuICAgIH1cbiAgfVxuICBpZiAod2lkdGggPCBsYXlvdXQubWluV2lkdGggfHwgaGVpZ2h0IDwgbGF5b3V0Lm1pbkhlaWdodCkge1xuICAgIGlmIChjdXJyZW50TGF5b3V0SW5kZXggPiAwKSB7XG4gICAgICBjb25zdCBzbWFsbGVyTGF5b3V0ID0gbGF5b3V0c1tjdXJyZW50TGF5b3V0SW5kZXggLSAxXTtcbiAgICAgIGxheW91dCA9IHNlbGVjdEdyaWRMYXlvdXQoXG4gICAgICAgIGxheW91dHMuc2xpY2UoMCwgY3VycmVudExheW91dEluZGV4KSxcbiAgICAgICAgc21hbGxlckxheW91dC5tYXhUaWxlcyxcbiAgICAgICAgd2lkdGgsXG4gICAgICAgIGhlaWdodFxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxheW91dDtcbn1cblxuLy8gc3JjL2hlbHBlci9zZXQtaGVscGVyLnRzXG5mdW5jdGlvbiBzZXREaWZmZXJlbmNlKHNldEEsIHNldEIpIHtcbiAgY29uc3QgX2RpZmZlcmVuY2UgPSBuZXcgU2V0KHNldEEpO1xuICBmb3IgKGNvbnN0IGVsZW0gb2Ygc2V0Qikge1xuICAgIF9kaWZmZXJlbmNlLmRlbGV0ZShlbGVtKTtcbiAgfVxuICByZXR1cm4gX2RpZmZlcmVuY2U7XG59XG5cbi8vIHNyYy9oZWxwZXIvZmVhdHVyZURldGVjdGlvbi50c1xuZnVuY3Rpb24gc3VwcG9ydHNTY3JlZW5TaGFyaW5nKCkge1xuICByZXR1cm4gdHlwZW9mIG5hdmlnYXRvciAhPT0gXCJ1bmRlZmluZWRcIiAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmICEhbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXREaXNwbGF5TWVkaWE7XG59XG5cbi8vIHNyYy90eXBlcy50c1xudmFyIFBJTl9ERUZBVUxUX1NUQVRFID0gW107XG52YXIgV0lER0VUX0RFRkFVTFRfU1RBVEUgPSB7IHNob3dDaGF0OiBmYWxzZSwgdW5yZWFkTWVzc2FnZXM6IDAgfTtcbmZ1bmN0aW9uIGlzU291cmNlV2l0T3B0aW9ucyhzb3VyY2UpIHtcbiAgcmV0dXJuIHR5cGVvZiBzb3VyY2UgPT09IFwib2JqZWN0XCI7XG59XG5mdW5jdGlvbiBpc1NvdXJjZXNXaXRoT3B0aW9ucyhzb3VyY2VzKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHNvdXJjZXMpICYmIHNvdXJjZXMuZmlsdGVyKGlzU291cmNlV2l0T3B0aW9ucykubGVuZ3RoID4gMDtcbn1cblxuLy8gc3JjL3NvcnRpbmcvc29ydC10cmFjay1idW5kbGVzLnRzXG5pbXBvcnQgeyBUcmFjayBhcyBUcmFjazIgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcblxuLy8gc3JjL3NvcnRpbmcvYmFzZS1zb3J0LWZ1bmN0aW9ucy50c1xuaW1wb3J0IHsgVHJhY2sgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcbmZ1bmN0aW9uIHNvcnRQYXJ0aWNpcGFudHNCeUF1ZGlvTGV2ZWwoYSwgYikge1xuICByZXR1cm4gYi5hdWRpb0xldmVsIC0gYS5hdWRpb0xldmVsO1xufVxuZnVuY3Rpb24gc29ydFBhcnRpY2lwYW50c0J5SXNTcGVha2luZyhhLCBiKSB7XG4gIGlmIChhLmlzU3BlYWtpbmcgPT09IGIuaXNTcGVha2luZykge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhLmlzU3BlYWtpbmcgPyAtMSA6IDE7XG4gIH1cbn1cbmZ1bmN0aW9uIHNvcnRQYXJ0aWNpcGFudHNCeUxhc3RTcG9rZW5BVChhLCBiKSB7XG4gIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgaWYgKGEubGFzdFNwb2tlQXQgIT09IHZvaWQgMCB8fCBiLmxhc3RTcG9rZUF0ICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gKChfYiA9IChfYSA9IGIubGFzdFNwb2tlQXQpID09IG51bGwgPyB2b2lkIDAgOiBfYS5nZXRUaW1lKCkpICE9IG51bGwgPyBfYiA6IDApIC0gKChfZCA9IChfYyA9IGEubGFzdFNwb2tlQXQpID09IG51bGwgPyB2b2lkIDAgOiBfYy5nZXRUaW1lKCkpICE9IG51bGwgPyBfZCA6IDApO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAwO1xuICB9XG59XG5mdW5jdGlvbiBzb3J0UGFydGljaXBhbnRzQnlKb2luZWRBdChhLCBiKSB7XG4gIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgcmV0dXJuICgoX2IgPSAoX2EgPSBhLmpvaW5lZEF0KSA9PSBudWxsID8gdm9pZCAwIDogX2EuZ2V0VGltZSgpKSAhPSBudWxsID8gX2IgOiAwKSAtICgoX2QgPSAoX2MgPSBiLmpvaW5lZEF0KSA9PSBudWxsID8gdm9pZCAwIDogX2MuZ2V0VGltZSgpKSAhPSBudWxsID8gX2QgOiAwKTtcbn1cbmZ1bmN0aW9uIHNvcnRUcmFja1JlZmVyZW5jZXNCeVR5cGUoYSwgYikge1xuICBpZiAoaXNUcmFja1JlZmVyZW5jZShhKSkge1xuICAgIGlmIChpc1RyYWNrUmVmZXJlbmNlKGIpKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgfSBlbHNlIGlmIChpc1RyYWNrUmVmZXJlbmNlKGIpKSB7XG4gICAgcmV0dXJuIDE7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cbn1cbmZ1bmN0aW9uIHNvcnRUcmFja1JlZnNCeUlzQ2FtZXJhRW5hYmxlZChhLCBiKSB7XG4gIGNvbnN0IGFWaWRlbyA9IGEucGFydGljaXBhbnQuaXNDYW1lcmFFbmFibGVkO1xuICBjb25zdCBiVmlkZW8gPSBiLnBhcnRpY2lwYW50LmlzQ2FtZXJhRW5hYmxlZDtcbiAgaWYgKGFWaWRlbyAhPT0gYlZpZGVvKSB7XG4gICAgaWYgKGFWaWRlbykge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cbn1cblxuLy8gc3JjL3NvcnRpbmcvc29ydC10cmFjay1idW5kbGVzLnRzXG5mdW5jdGlvbiBzb3J0VHJhY2tSZWZlcmVuY2VzKHRyYWNrcykge1xuICBjb25zdCBsb2NhbFRyYWNrcyA9IFtdO1xuICBjb25zdCBzY3JlZW5TaGFyZVRyYWNrcyA9IFtdO1xuICBjb25zdCBjYW1lcmFUcmFja3MgPSBbXTtcbiAgY29uc3QgdW5kZWZpbmVkVHJhY2tzID0gW107XG4gIHRyYWNrcy5mb3JFYWNoKCh0cmFja1JlZikgPT4ge1xuICAgIGlmICh0cmFja1JlZi5wYXJ0aWNpcGFudC5pc0xvY2FsICYmIHRyYWNrUmVmLnNvdXJjZSA9PT0gVHJhY2syLlNvdXJjZS5DYW1lcmEpIHtcbiAgICAgIGxvY2FsVHJhY2tzLnB1c2godHJhY2tSZWYpO1xuICAgIH0gZWxzZSBpZiAodHJhY2tSZWYuc291cmNlID09PSBUcmFjazIuU291cmNlLlNjcmVlblNoYXJlKSB7XG4gICAgICBzY3JlZW5TaGFyZVRyYWNrcy5wdXNoKHRyYWNrUmVmKTtcbiAgICB9IGVsc2UgaWYgKHRyYWNrUmVmLnNvdXJjZSA9PT0gVHJhY2syLlNvdXJjZS5DYW1lcmEpIHtcbiAgICAgIGNhbWVyYVRyYWNrcy5wdXNoKHRyYWNrUmVmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdW5kZWZpbmVkVHJhY2tzLnB1c2godHJhY2tSZWYpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHNvcnRlZFNjcmVlblNoYXJlVHJhY2tzID0gc29ydFNjcmVlblNoYXJlVHJhY2tzKHNjcmVlblNoYXJlVHJhY2tzKTtcbiAgY29uc3Qgc29ydGVkQ2FtZXJhVHJhY2tzID0gc29ydENhbWVyYVRyYWNrcyhjYW1lcmFUcmFja3MpO1xuICByZXR1cm4gWy4uLmxvY2FsVHJhY2tzLCAuLi5zb3J0ZWRTY3JlZW5TaGFyZVRyYWNrcywgLi4uc29ydGVkQ2FtZXJhVHJhY2tzLCAuLi51bmRlZmluZWRUcmFja3NdO1xufVxuZnVuY3Rpb24gc29ydFNjcmVlblNoYXJlVHJhY2tzKHNjcmVlblNoYXJlVHJhY2tzKSB7XG4gIGNvbnN0IGxvY2FsU2NyZWVuU2hhcmVzID0gW107XG4gIGNvbnN0IHJlbW90ZVNjcmVlblNoYXJlcyA9IFtdO1xuICBzY3JlZW5TaGFyZVRyYWNrcy5mb3JFYWNoKCh0cmFja1JlZikgPT4ge1xuICAgIGlmICh0cmFja1JlZi5wYXJ0aWNpcGFudC5pc0xvY2FsKSB7XG4gICAgICBsb2NhbFNjcmVlblNoYXJlcy5wdXNoKHRyYWNrUmVmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3RlU2NyZWVuU2hhcmVzLnB1c2godHJhY2tSZWYpO1xuICAgIH1cbiAgfSk7XG4gIGxvY2FsU2NyZWVuU2hhcmVzLnNvcnQoKGEsIGIpID0+IHNvcnRQYXJ0aWNpcGFudHNCeUpvaW5lZEF0KGEucGFydGljaXBhbnQsIGIucGFydGljaXBhbnQpKTtcbiAgcmVtb3RlU2NyZWVuU2hhcmVzLnNvcnQoKGEsIGIpID0+IHNvcnRQYXJ0aWNpcGFudHNCeUpvaW5lZEF0KGEucGFydGljaXBhbnQsIGIucGFydGljaXBhbnQpKTtcbiAgY29uc3Qgc29ydGVkU2NyZWVuU2hhcmVUcmFja1JlZnMgPSBbLi4ucmVtb3RlU2NyZWVuU2hhcmVzLCAuLi5sb2NhbFNjcmVlblNoYXJlc107XG4gIHJldHVybiBzb3J0ZWRTY3JlZW5TaGFyZVRyYWNrUmVmcztcbn1cbmZ1bmN0aW9uIHNvcnRDYW1lcmFUcmFja3MoY2FtZXJhVHJhY2tSZWZlcmVuY2VzKSB7XG4gIGNvbnN0IGxvY2FsQ2FtZXJhVHJhY2tzID0gW107XG4gIGNvbnN0IHJlbW90ZUNhbWVyYVRyYWNrcyA9IFtdO1xuICBjYW1lcmFUcmFja1JlZmVyZW5jZXMuZm9yRWFjaCgodHJhY2tSZWYpID0+IHtcbiAgICBpZiAodHJhY2tSZWYucGFydGljaXBhbnQuaXNMb2NhbCkge1xuICAgICAgbG9jYWxDYW1lcmFUcmFja3MucHVzaCh0cmFja1JlZik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbW90ZUNhbWVyYVRyYWNrcy5wdXNoKHRyYWNrUmVmKTtcbiAgICB9XG4gIH0pO1xuICByZW1vdGVDYW1lcmFUcmFja3Muc29ydCgoYSwgYikgPT4ge1xuICAgIGlmIChhLnBhcnRpY2lwYW50LmlzU3BlYWtpbmcgJiYgYi5wYXJ0aWNpcGFudC5pc1NwZWFraW5nKSB7XG4gICAgICByZXR1cm4gc29ydFBhcnRpY2lwYW50c0J5QXVkaW9MZXZlbChhLnBhcnRpY2lwYW50LCBiLnBhcnRpY2lwYW50KTtcbiAgICB9XG4gICAgaWYgKGEucGFydGljaXBhbnQuaXNTcGVha2luZyAhPT0gYi5wYXJ0aWNpcGFudC5pc1NwZWFraW5nKSB7XG4gICAgICByZXR1cm4gc29ydFBhcnRpY2lwYW50c0J5SXNTcGVha2luZyhhLnBhcnRpY2lwYW50LCBiLnBhcnRpY2lwYW50KTtcbiAgICB9XG4gICAgaWYgKGEucGFydGljaXBhbnQubGFzdFNwb2tlQXQgIT09IGIucGFydGljaXBhbnQubGFzdFNwb2tlQXQpIHtcbiAgICAgIHJldHVybiBzb3J0UGFydGljaXBhbnRzQnlMYXN0U3Bva2VuQVQoYS5wYXJ0aWNpcGFudCwgYi5wYXJ0aWNpcGFudCk7XG4gICAgfVxuICAgIGlmIChpc1RyYWNrUmVmZXJlbmNlKGEpICE9PSBpc1RyYWNrUmVmZXJlbmNlKGIpKSB7XG4gICAgICByZXR1cm4gc29ydFRyYWNrUmVmZXJlbmNlc0J5VHlwZShhLCBiKTtcbiAgICB9XG4gICAgaWYgKGEucGFydGljaXBhbnQuaXNDYW1lcmFFbmFibGVkICE9PSBiLnBhcnRpY2lwYW50LmlzQ2FtZXJhRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIHNvcnRUcmFja1JlZnNCeUlzQ2FtZXJhRW5hYmxlZChhLCBiKTtcbiAgICB9XG4gICAgcmV0dXJuIHNvcnRQYXJ0aWNpcGFudHNCeUpvaW5lZEF0KGEucGFydGljaXBhbnQsIGIucGFydGljaXBhbnQpO1xuICB9KTtcbiAgcmV0dXJuIFsuLi5sb2NhbENhbWVyYVRyYWNrcywgLi4ucmVtb3RlQ2FtZXJhVHJhY2tzXTtcbn1cblxuLy8gc3JjL3NvcnRpbmcvc29ydC1wYXJ0aWNpcGFudHMudHNcbmltcG9ydCB7IExvY2FsUGFydGljaXBhbnQgYXMgTG9jYWxQYXJ0aWNpcGFudDIgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcbmZ1bmN0aW9uIHNvcnRQYXJ0aWNpcGFudHMocGFydGljaXBhbnRzKSB7XG4gIGNvbnN0IHNvcnRlZFBhcnRpY2lwYW50cyA9IFsuLi5wYXJ0aWNpcGFudHNdO1xuICBzb3J0ZWRQYXJ0aWNpcGFudHMuc29ydCgoYSwgYikgPT4ge1xuICAgIGlmIChhLmlzU3BlYWtpbmcgJiYgYi5pc1NwZWFraW5nKSB7XG4gICAgICByZXR1cm4gc29ydFBhcnRpY2lwYW50c0J5QXVkaW9MZXZlbChhLCBiKTtcbiAgICB9XG4gICAgaWYgKGEuaXNTcGVha2luZyAhPT0gYi5pc1NwZWFraW5nKSB7XG4gICAgICByZXR1cm4gc29ydFBhcnRpY2lwYW50c0J5SXNTcGVha2luZyhhLCBiKTtcbiAgICB9XG4gICAgaWYgKGEubGFzdFNwb2tlQXQgIT09IGIubGFzdFNwb2tlQXQpIHtcbiAgICAgIHJldHVybiBzb3J0UGFydGljaXBhbnRzQnlMYXN0U3Bva2VuQVQoYSwgYik7XG4gICAgfVxuICAgIGNvbnN0IGFWaWRlbyA9IGEudmlkZW9UcmFja3Muc2l6ZSA+IDA7XG4gICAgY29uc3QgYlZpZGVvID0gYi52aWRlb1RyYWNrcy5zaXplID4gMDtcbiAgICBpZiAoYVZpZGVvICE9PSBiVmlkZW8pIHtcbiAgICAgIGlmIChhVmlkZW8pIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzb3J0UGFydGljaXBhbnRzQnlKb2luZWRBdChhLCBiKTtcbiAgfSk7XG4gIGNvbnN0IGxvY2FsUGFydGljaXBhbnQgPSBzb3J0ZWRQYXJ0aWNpcGFudHMuZmluZCgocCkgPT4gcCBpbnN0YW5jZW9mIExvY2FsUGFydGljaXBhbnQyKTtcbiAgaWYgKGxvY2FsUGFydGljaXBhbnQpIHtcbiAgICBjb25zdCBsb2NhbElkeCA9IHNvcnRlZFBhcnRpY2lwYW50cy5pbmRleE9mKGxvY2FsUGFydGljaXBhbnQpO1xuICAgIGlmIChsb2NhbElkeCA+PSAwKSB7XG4gICAgICBzb3J0ZWRQYXJ0aWNpcGFudHMuc3BsaWNlKGxvY2FsSWR4LCAxKTtcbiAgICAgIGlmIChzb3J0ZWRQYXJ0aWNpcGFudHMubGVuZ3RoID4gMCkge1xuICAgICAgICBzb3J0ZWRQYXJ0aWNpcGFudHMuc3BsaWNlKDAsIDAsIGxvY2FsUGFydGljaXBhbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc29ydGVkUGFydGljaXBhbnRzLnB1c2gobG9jYWxQYXJ0aWNpcGFudCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBzb3J0ZWRQYXJ0aWNpcGFudHM7XG59XG5cbi8vIHNyYy9oZWxwZXIvYXJyYXktaGVscGVyLnRzXG5mdW5jdGlvbiBjaHVuayhpbnB1dCwgc2l6ZSkge1xuICByZXR1cm4gaW5wdXQucmVkdWNlKChhcnIsIGl0ZW0sIGlkeCkgPT4ge1xuICAgIHJldHVybiBpZHggJSBzaXplID09PSAwID8gWy4uLmFyciwgW2l0ZW1dXSA6IFsuLi5hcnIuc2xpY2UoMCwgLTEpLCBbLi4uYXJyLnNsaWNlKC0xKVswXSwgaXRlbV1dO1xuICB9LCBbXSk7XG59XG5mdW5jdGlvbiB6aXAoYTEsIGEyKSB7XG4gIGNvbnN0IHJlc3VsdExlbmd0aCA9IE1hdGgubWF4KGExLmxlbmd0aCwgYTIubGVuZ3RoKTtcbiAgcmV0dXJuIG5ldyBBcnJheShyZXN1bHRMZW5ndGgpLmZpbGwoW10pLm1hcCgoX3ZhbCwgaWR4KSA9PiBbYTFbaWR4XSwgYTJbaWR4XV0pO1xufVxuZnVuY3Rpb24gZGlmZmVyZW5jZUJ5KGExLCBhMiwgYnkpIHtcbiAgcmV0dXJuIGExLmZpbHRlcigoYykgPT4gIWEyLm1hcCgodikgPT4gYnkodikpLmluY2x1ZGVzKGJ5KGMpKSk7XG59XG5cbi8vIHNyYy90cmFjay1yZWZlcmVuY2UvdGVzdC11dGlscy50c1xuaW1wb3J0IHsgUGFydGljaXBhbnQsIFRyYWNrIGFzIFRyYWNrMywgVHJhY2tQdWJsaWNhdGlvbiB9IGZyb20gXCJsaXZla2l0LWNsaWVudFwiO1xuZnVuY3Rpb24gZmxhdFRyYWNrUmVmZXJlbmNlQXJyYXkobGlzdCkge1xuICByZXR1cm4gbGlzdC5tYXAoKGl0ZW0pID0+IHtcbiAgICBpZiAodHlwZW9mIGl0ZW0gPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIGl0ZW0gPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHJldHVybiBgJHtpdGVtfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBnZXRUcmFja1JlZmVyZW5jZUlkKGl0ZW0pO1xuICAgIH1cbiAgfSk7XG59XG5cbi8vIHNyYy9zb3J0aW5nL3RpbGUtYXJyYXktdXBkYXRlLnRzXG5mdW5jdGlvbiB2aXN1YWxQYWdlQ2hhbmdlKHN0YXRlLCBuZXh0KSB7XG4gIHJldHVybiB7XG4gICAgZHJvcHBlZDogZGlmZmVyZW5jZUJ5KHN0YXRlLCBuZXh0LCBnZXRUcmFja1JlZmVyZW5jZUlkKSxcbiAgICBhZGRlZDogZGlmZmVyZW5jZUJ5KG5leHQsIHN0YXRlLCBnZXRUcmFja1JlZmVyZW5jZUlkKVxuICB9O1xufVxuZnVuY3Rpb24gbGlzdE5lZWRzVXBkYXRpbmcoY2hhbmdlcykge1xuICByZXR1cm4gY2hhbmdlcy5hZGRlZC5sZW5ndGggIT09IDAgfHwgY2hhbmdlcy5kcm9wcGVkLmxlbmd0aCAhPT0gMDtcbn1cbmZ1bmN0aW9uIGZpbmRJbmRleCh0cmFja1JlZmVyZW5jZSwgdHJhY2tSZWZlcmVuY2VzKSB7XG4gIGNvbnN0IGluZGV4VG9SZXBsYWNlID0gdHJhY2tSZWZlcmVuY2VzLmZpbmRJbmRleChcbiAgICAodHJhY2tSZWZlcmVuY2VfKSA9PiBnZXRUcmFja1JlZmVyZW5jZUlkKHRyYWNrUmVmZXJlbmNlXykgPT09IGdldFRyYWNrUmVmZXJlbmNlSWQodHJhY2tSZWZlcmVuY2UpXG4gICk7XG4gIGlmIChpbmRleFRvUmVwbGFjZSA9PT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgRWxlbWVudCBub3QgcGFydCBvZiB0aGUgYXJyYXk6ICR7Z2V0VHJhY2tSZWZlcmVuY2VJZChcbiAgICAgICAgdHJhY2tSZWZlcmVuY2VcbiAgICAgICl9IG5vdCBpbiAke2ZsYXRUcmFja1JlZmVyZW5jZUFycmF5KHRyYWNrUmVmZXJlbmNlcyl9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGluZGV4VG9SZXBsYWNlO1xufVxuZnVuY3Rpb24gc3dhcEl0ZW1zKG1vdmVGb3J3YXJkLCBtb3ZlQmFjaywgdHJhY2tSZWZlcmVuY2VzKSB7XG4gIGNvbnN0IGluZGV4VG9SZXBsYWNlID0gZmluZEluZGV4KG1vdmVGb3J3YXJkLCB0cmFja1JlZmVyZW5jZXMpO1xuICBjb25zdCBpbmRleFJlcGxhY2VXaXRoID0gZmluZEluZGV4KG1vdmVCYWNrLCB0cmFja1JlZmVyZW5jZXMpO1xuICB0cmFja1JlZmVyZW5jZXMuc3BsaWNlKGluZGV4VG9SZXBsYWNlLCAxLCBtb3ZlQmFjayk7XG4gIHRyYWNrUmVmZXJlbmNlcy5zcGxpY2UoaW5kZXhSZXBsYWNlV2l0aCwgMSwgbW92ZUZvcndhcmQpO1xuICByZXR1cm4gdHJhY2tSZWZlcmVuY2VzO1xufVxuZnVuY3Rpb24gZHJvcEl0ZW0oaXRlbVRvRHJvcCwgbGlzdCkge1xuICBjb25zdCBpbmRleE9mRWxlbWVudFRvRHJvcCA9IGZpbmRJbmRleChpdGVtVG9Ecm9wLCBsaXN0KTtcbiAgbGlzdC5zcGxpY2UoaW5kZXhPZkVsZW1lbnRUb0Ryb3AsIDEpO1xuICByZXR1cm4gbGlzdDtcbn1cbmZ1bmN0aW9uIGFkZEl0ZW0oaXRlbVRvQWRkLCBsaXN0KSB7XG4gIHJldHVybiBbLi4ubGlzdCwgaXRlbVRvQWRkXTtcbn1cbmZ1bmN0aW9uIGRpdmlkZUludG9QYWdlcyhsaXN0LCBtYXhFbGVtZW50c09uUGFnZSkge1xuICBjb25zdCBwYWdlcyA9IGNodW5rKGxpc3QsIG1heEVsZW1lbnRzT25QYWdlKTtcbiAgcmV0dXJuIHBhZ2VzO1xufVxuZnVuY3Rpb24gdXBkYXRlUGFnZXMoY3VycmVudExpc3QsIG5leHRMaXN0LCBtYXhJdGVtc09uUGFnZSkge1xuICBsZXQgdXBkYXRlZExpc3QgPSByZWZyZXNoTGlzdChjdXJyZW50TGlzdCwgbmV4dExpc3QpO1xuICBpZiAodXBkYXRlZExpc3QubGVuZ3RoIDwgbmV4dExpc3QubGVuZ3RoKSB7XG4gICAgY29uc3QgYWRkZWRJdGVtcyA9IGRpZmZlcmVuY2VCeShuZXh0TGlzdCwgdXBkYXRlZExpc3QsIGdldFRyYWNrUmVmZXJlbmNlSWQpO1xuICAgIHVwZGF0ZWRMaXN0ID0gWy4uLnVwZGF0ZWRMaXN0LCAuLi5hZGRlZEl0ZW1zXTtcbiAgfVxuICBjb25zdCBjdXJyZW50UGFnZXMgPSBkaXZpZGVJbnRvUGFnZXModXBkYXRlZExpc3QsIG1heEl0ZW1zT25QYWdlKTtcbiAgY29uc3QgbmV4dFBhZ2VzID0gZGl2aWRlSW50b1BhZ2VzKG5leHRMaXN0LCBtYXhJdGVtc09uUGFnZSk7XG4gIHppcChjdXJyZW50UGFnZXMsIG5leHRQYWdlcykuZm9yRWFjaCgoW2N1cnJlbnRQYWdlLCBuZXh0UGFnZV0sIHBhZ2VJbmRleCkgPT4ge1xuICAgIGlmIChjdXJyZW50UGFnZSAmJiBuZXh0UGFnZSkge1xuICAgICAgY29uc3QgdXBkYXRlZFBhZ2UgPSBkaXZpZGVJbnRvUGFnZXModXBkYXRlZExpc3QsIG1heEl0ZW1zT25QYWdlKVtwYWdlSW5kZXhdO1xuICAgICAgY29uc3QgY2hhbmdlcyA9IHZpc3VhbFBhZ2VDaGFuZ2UodXBkYXRlZFBhZ2UsIG5leHRQYWdlKTtcbiAgICAgIGlmIChsaXN0TmVlZHNVcGRhdGluZyhjaGFuZ2VzKSkge1xuICAgICAgICBsb2cuZGVidWcoXG4gICAgICAgICAgYERldGVjdGVkIHZpc3VhbCBjaGFuZ2VzIG9uIHBhZ2U6ICR7cGFnZUluZGV4fSwgY3VycmVudDogJHtmbGF0VHJhY2tSZWZlcmVuY2VBcnJheShcbiAgICAgICAgICAgIGN1cnJlbnRQYWdlXG4gICAgICAgICAgKX0sIG5leHQ6ICR7ZmxhdFRyYWNrUmVmZXJlbmNlQXJyYXkobmV4dFBhZ2UpfWAsXG4gICAgICAgICAgeyBjaGFuZ2VzIH1cbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNoYW5nZXMuYWRkZWQubGVuZ3RoID09PSBjaGFuZ2VzLmRyb3BwZWQubGVuZ3RoKSB7XG4gICAgICAgICAgemlwKGNoYW5nZXMuYWRkZWQsIGNoYW5nZXMuZHJvcHBlZCkuZm9yRWFjaCgoW2FkZGVkLCBkcm9wcGVkXSkgPT4ge1xuICAgICAgICAgICAgaWYgKGFkZGVkICYmIGRyb3BwZWQpIHtcbiAgICAgICAgICAgICAgdXBkYXRlZExpc3QgPSBzd2FwSXRlbXMoYWRkZWQsIGRyb3BwZWQsIHVwZGF0ZWRMaXN0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBgRm9yIGEgc3dhcCBhY3Rpb24gd2UgbmVlZCBhIGFkZGl0aW9uIGFuZCBhIHJlbW92YWwgb25lIGlzIG1pc3Npbmc6ICR7YWRkZWR9LCAke2Ryb3BwZWR9YFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2VzLmFkZGVkLmxlbmd0aCA9PT0gMCAmJiBjaGFuZ2VzLmRyb3BwZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNoYW5nZXMuZHJvcHBlZC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICB1cGRhdGVkTGlzdCA9IGRyb3BJdGVtKGl0ZW0sIHVwZGF0ZWRMaXN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhbmdlcy5hZGRlZC5sZW5ndGggPiAwICYmIGNoYW5nZXMuZHJvcHBlZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBjaGFuZ2VzLmFkZGVkLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIHVwZGF0ZWRMaXN0ID0gYWRkSXRlbShpdGVtLCB1cGRhdGVkTGlzdCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBpZiAodXBkYXRlZExpc3QubGVuZ3RoID4gbmV4dExpc3QubGVuZ3RoKSB7XG4gICAgY29uc3QgbWlzc2luZ0l0ZW1zID0gZGlmZmVyZW5jZUJ5KHVwZGF0ZWRMaXN0LCBuZXh0TGlzdCwgZ2V0VHJhY2tSZWZlcmVuY2VJZCk7XG4gICAgdXBkYXRlZExpc3QgPSB1cGRhdGVkTGlzdC5maWx0ZXIoXG4gICAgICAoaXRlbSkgPT4gIW1pc3NpbmdJdGVtcy5tYXAoZ2V0VHJhY2tSZWZlcmVuY2VJZCkuaW5jbHVkZXMoZ2V0VHJhY2tSZWZlcmVuY2VJZChpdGVtKSlcbiAgICApO1xuICB9XG4gIHJldHVybiB1cGRhdGVkTGlzdDtcbn1cbmZ1bmN0aW9uIHJlZnJlc2hMaXN0KGN1cnJlbnRMaXN0LCBuZXh0TGlzdCkge1xuICByZXR1cm4gY3VycmVudExpc3QubWFwKChjdXJyZW50SXRlbSkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZUZvckN1cnJlbnRJdGVtID0gbmV4dExpc3QuZmluZChcbiAgICAgIChuZXdJdGVtXykgPT4gKFxuICAgICAgICAvLyBJZiB0aGUgSURzIG1hdGNoIG9yIC4uXG4gICAgICAgIGdldFRyYWNrUmVmZXJlbmNlSWQoY3VycmVudEl0ZW0pID09PSBnZXRUcmFja1JlZmVyZW5jZUlkKG5ld0l0ZW1fKSB8fCAvLyAuLi4gaWYgdGhlIGN1cnJlbnQgaXRlbSBpcyBhIHBsYWNlaG9sZGVyIGFuZCB0aGUgbmV3IGl0ZW0gaXMgdGhlIHRyYWNrIHJlZmVyZW5jZSBjYW4gcmVwbGFjZSBpdC5cbiAgICAgICAgdHlwZW9mIGN1cnJlbnRJdGVtICE9PSBcIm51bWJlclwiICYmIGlzVHJhY2tSZWZlcmVuY2VQbGFjZWhvbGRlcihjdXJyZW50SXRlbSkgJiYgaXNUcmFja1JlZmVyZW5jZShuZXdJdGVtXykgJiYgaXNQbGFjZWhvbGRlclJlcGxhY2VtZW50KGN1cnJlbnRJdGVtLCBuZXdJdGVtXylcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiB1cGRhdGVGb3JDdXJyZW50SXRlbSAhPSBudWxsID8gdXBkYXRlRm9yQ3VycmVudEl0ZW0gOiBjdXJyZW50SXRlbTtcbiAgfSk7XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL21lZGlhVG9nZ2xlLnRzXG5pbXBvcnQgeyBUcmFjayBhcyBUcmFjazcgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcbmltcG9ydCB7IFN1YmplY3QgYXMgU3ViamVjdDIsIG1hcCBhcyBtYXA0LCBzdGFydFdpdGggYXMgc3RhcnRXaXRoNCB9IGZyb20gXCJyeGpzXCI7XG5cbi8vIHNyYy9vYnNlcnZhYmxlcy9wYXJ0aWNpcGFudC50c1xuaW1wb3J0IHsgUGFydGljaXBhbnRFdmVudCBhcyBQYXJ0aWNpcGFudEV2ZW50MiwgUm9vbUV2ZW50IGFzIFJvb21FdmVudDMsIFRyYWNrIGFzIFRyYWNrNiB9IGZyb20gXCJsaXZla2l0LWNsaWVudFwiO1xuaW1wb3J0IHsgbWFwIGFzIG1hcDMsIHN3aXRjaE1hcCwgT2JzZXJ2YWJsZSBhcyBPYnNlcnZhYmxlMiwgc3RhcnRXaXRoIGFzIHN0YXJ0V2l0aDMgfSBmcm9tIFwicnhqc1wiO1xuXG4vLyBzcmMvb2JzZXJ2YWJsZXMvcm9vbS50c1xuaW1wb3J0IHsgU3ViamVjdCwgbWFwLCBPYnNlcnZhYmxlLCBzdGFydFdpdGgsIGZpbmFsaXplLCBmaWx0ZXIsIGNvbmNhdCB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgeyBMb2NhbFBhcnRpY2lwYW50IGFzIExvY2FsUGFydGljaXBhbnQzLCBSb29tLCBSb29tRXZlbnQgYXMgUm9vbUV2ZW50MiwgVHJhY2sgYXMgVHJhY2s0IH0gZnJvbSBcImxpdmVraXQtY2xpZW50XCI7XG5mdW5jdGlvbiBvYnNlcnZlUm9vbUV2ZW50cyhyb29tLCAuLi5ldmVudHMpIHtcbiAgY29uc3Qgb2JzZXJ2YWJsZSA9IG5ldyBPYnNlcnZhYmxlKChzdWJzY3JpYmUpID0+IHtcbiAgICBjb25zdCBvblJvb21VcGRhdGUgPSAoKSA9PiB7XG4gICAgICBzdWJzY3JpYmUubmV4dChyb29tKTtcbiAgICB9O1xuICAgIGV2ZW50cy5mb3JFYWNoKChldnQpID0+IHtcbiAgICAgIHJvb20ub24oZXZ0LCBvblJvb21VcGRhdGUpO1xuICAgIH0pO1xuICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gKCkgPT4ge1xuICAgICAgZXZlbnRzLmZvckVhY2goKGV2dCkgPT4ge1xuICAgICAgICByb29tLm9mZihldnQsIG9uUm9vbVVwZGF0ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiB1bnN1YnNjcmliZTtcbiAgfSkucGlwZShzdGFydFdpdGgocm9vbSkpO1xuICByZXR1cm4gb2JzZXJ2YWJsZTtcbn1cbmZ1bmN0aW9uIHJvb21FdmVudFNlbGVjdG9yKHJvb20sIGV2ZW50KSB7XG4gIGNvbnN0IG9ic2VydmFibGUgPSBuZXcgT2JzZXJ2YWJsZSgoc3Vic2NyaWJlKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlID0gKC4uLnBhcmFtcykgPT4ge1xuICAgICAgc3Vic2NyaWJlLm5leHQocGFyYW1zKTtcbiAgICB9O1xuICAgIHJvb20ub24oZXZlbnQsIHVwZGF0ZSk7XG4gICAgY29uc3QgdW5zdWJzY3JpYmUgPSAoKSA9PiB7XG4gICAgICByb29tLm9mZihldmVudCwgdXBkYXRlKTtcbiAgICB9O1xuICAgIHJldHVybiB1bnN1YnNjcmliZTtcbiAgfSk7XG4gIHJldHVybiBvYnNlcnZhYmxlO1xufVxuZnVuY3Rpb24gcm9vbU9ic2VydmVyKHJvb20pIHtcbiAgY29uc3Qgb2JzZXJ2YWJsZSA9IG9ic2VydmVSb29tRXZlbnRzKFxuICAgIHJvb20sXG4gICAgUm9vbUV2ZW50Mi5QYXJ0aWNpcGFudENvbm5lY3RlZCxcbiAgICBSb29tRXZlbnQyLlBhcnRpY2lwYW50RGlzY29ubmVjdGVkLFxuICAgIFJvb21FdmVudDIuQWN0aXZlU3BlYWtlcnNDaGFuZ2VkLFxuICAgIFJvb21FdmVudDIuVHJhY2tTdWJzY3JpYmVkLFxuICAgIFJvb21FdmVudDIuVHJhY2tVbnN1YnNjcmliZWQsXG4gICAgUm9vbUV2ZW50Mi5Mb2NhbFRyYWNrUHVibGlzaGVkLFxuICAgIFJvb21FdmVudDIuTG9jYWxUcmFja1VucHVibGlzaGVkLFxuICAgIFJvb21FdmVudDIuQXVkaW9QbGF5YmFja1N0YXR1c0NoYW5nZWQsXG4gICAgUm9vbUV2ZW50Mi5Db25uZWN0aW9uU3RhdGVDaGFuZ2VkXG4gICkucGlwZShzdGFydFdpdGgocm9vbSkpO1xuICByZXR1cm4gb2JzZXJ2YWJsZTtcbn1cbmZ1bmN0aW9uIGNvbm5lY3Rpb25TdGF0ZU9ic2VydmVyKHJvb20pIHtcbiAgcmV0dXJuIHJvb21FdmVudFNlbGVjdG9yKHJvb20sIFJvb21FdmVudDIuQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCkucGlwZShcbiAgICBtYXAoKFtjb25uZWN0aW9uU3RhdGVdKSA9PiBjb25uZWN0aW9uU3RhdGUpLFxuICAgIHN0YXJ0V2l0aChyb29tLnN0YXRlKVxuICApO1xufVxuZnVuY3Rpb24gc2NyZWVuU2hhcmVPYnNlcnZlcihyb29tKSB7XG4gIGxldCBzY3JlZW5TaGFyZVN1YnNjcmliZXI7XG4gIGNvbnN0IG9ic2VydmVycyA9IFtdO1xuICBjb25zdCBvYnNlcnZhYmxlID0gbmV3IE9ic2VydmFibGUoKHN1YnNjcmliZXIpID0+IHtcbiAgICBzY3JlZW5TaGFyZVN1YnNjcmliZXIgPSBzdWJzY3JpYmVyO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBvYnNlcnZlcnMuZm9yRWFjaCgob2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgb2JzZXJ2ZXIudW5zdWJzY3JpYmUoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuICBjb25zdCBzY3JlZW5TaGFyZVRyYWNrcyA9IFtdO1xuICBjb25zdCBoYW5kbGVTdWIgPSAocHVibGljYXRpb24sIHBhcnRpY2lwYW50KSA9PiB7XG4gICAgaWYgKHB1YmxpY2F0aW9uLnNvdXJjZSAhPT0gVHJhY2s0LlNvdXJjZS5TY3JlZW5TaGFyZSAmJiBwdWJsaWNhdGlvbi5zb3VyY2UgIT09IFRyYWNrNC5Tb3VyY2UuU2NyZWVuU2hhcmVBdWRpbykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgdHJhY2tNYXAgPSBzY3JlZW5TaGFyZVRyYWNrcy5maW5kKCh0cikgPT4gdHIucGFydGljaXBhbnQuaWRlbnRpdHkgPT09IHBhcnRpY2lwYW50LmlkZW50aXR5KTtcbiAgICBjb25zdCBnZXRTY3JlZW5TaGFyZVRyYWNrcyA9IChwYXJ0aWNpcGFudDIpID0+IHtcbiAgICAgIHJldHVybiBwYXJ0aWNpcGFudDIuZ2V0VHJhY2tzKCkuZmlsdGVyKFxuICAgICAgICAodHJhY2spID0+ICh0cmFjay5zb3VyY2UgPT09IFRyYWNrNC5Tb3VyY2UuU2NyZWVuU2hhcmUgfHwgdHJhY2suc291cmNlID09PSBUcmFjazQuU291cmNlLlNjcmVlblNoYXJlQXVkaW8pICYmIHRyYWNrLnRyYWNrXG4gICAgICApO1xuICAgIH07XG4gICAgaWYgKCF0cmFja01hcCkge1xuICAgICAgdHJhY2tNYXAgPSB7XG4gICAgICAgIHBhcnRpY2lwYW50LFxuICAgICAgICB0cmFja3M6IGdldFNjcmVlblNoYXJlVHJhY2tzKHBhcnRpY2lwYW50KVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW5kZXggPSBzY3JlZW5TaGFyZVRyYWNrcy5pbmRleE9mKHRyYWNrTWFwKTtcbiAgICAgIHNjcmVlblNoYXJlVHJhY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB0cmFja01hcC50cmFja3MgPSBnZXRTY3JlZW5TaGFyZVRyYWNrcyhwYXJ0aWNpcGFudCk7XG4gICAgfVxuICAgIGlmICh0cmFja01hcC50cmFja3MubGVuZ3RoID4gMCkge1xuICAgICAgc2NyZWVuU2hhcmVUcmFja3MucHVzaCh0cmFja01hcCk7XG4gICAgfVxuICAgIHNjcmVlblNoYXJlU3Vic2NyaWJlci5uZXh0KHNjcmVlblNoYXJlVHJhY2tzKTtcbiAgfTtcbiAgb2JzZXJ2ZXJzLnB1c2goXG4gICAgcm9vbUV2ZW50U2VsZWN0b3Iocm9vbSwgUm9vbUV2ZW50Mi5UcmFja1N1YnNjcmliZWQpLnN1YnNjcmliZShcbiAgICAgIChbLCAuLi5hcmdzXSkgPT4gaGFuZGxlU3ViKC4uLmFyZ3MpXG4gICAgKVxuICApO1xuICBvYnNlcnZlcnMucHVzaChcbiAgICByb29tRXZlbnRTZWxlY3Rvcihyb29tLCBSb29tRXZlbnQyLlRyYWNrVW5zdWJzY3JpYmVkKS5zdWJzY3JpYmUoXG4gICAgICAoWywgLi4uYXJnc10pID0+IGhhbmRsZVN1YiguLi5hcmdzKVxuICAgIClcbiAgKTtcbiAgb2JzZXJ2ZXJzLnB1c2goXG4gICAgcm9vbUV2ZW50U2VsZWN0b3Iocm9vbSwgUm9vbUV2ZW50Mi5Mb2NhbFRyYWNrUHVibGlzaGVkKS5zdWJzY3JpYmUoKGFyZ3MpID0+IGhhbmRsZVN1YiguLi5hcmdzKSlcbiAgKTtcbiAgb2JzZXJ2ZXJzLnB1c2goXG4gICAgcm9vbUV2ZW50U2VsZWN0b3Iocm9vbSwgUm9vbUV2ZW50Mi5Mb2NhbFRyYWNrVW5wdWJsaXNoZWQpLnN1YnNjcmliZSgoYXJncykgPT4ge1xuICAgICAgaGFuZGxlU3ViKC4uLmFyZ3MpO1xuICAgIH0pXG4gICk7XG4gIG9ic2VydmVycy5wdXNoKFxuICAgIHJvb21FdmVudFNlbGVjdG9yKHJvb20sIFJvb21FdmVudDIuVHJhY2tNdXRlZCkuc3Vic2NyaWJlKChhcmdzKSA9PiB7XG4gICAgICBoYW5kbGVTdWIoLi4uYXJncyk7XG4gICAgfSlcbiAgKTtcbiAgb2JzZXJ2ZXJzLnB1c2goXG4gICAgcm9vbUV2ZW50U2VsZWN0b3Iocm9vbSwgUm9vbUV2ZW50Mi5UcmFja1VubXV0ZWQpLnN1YnNjcmliZSgoYXJncykgPT4ge1xuICAgICAgaGFuZGxlU3ViKC4uLmFyZ3MpO1xuICAgIH0pXG4gICk7XG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGZvciAoY29uc3QgcCBvZiByb29tLnBhcnRpY2lwYW50cy52YWx1ZXMoKSkge1xuICAgICAgcC5nZXRUcmFja3MoKS5mb3JFYWNoKCh0cmFjaykgPT4ge1xuICAgICAgICBoYW5kbGVTdWIodHJhY2ssIHApO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCAxKTtcbiAgcmV0dXJuIG9ic2VydmFibGU7XG59XG5mdW5jdGlvbiByb29tSW5mb09ic2VydmVyKHJvb20pIHtcbiAgY29uc3Qgb2JzZXJ2ZXIgPSBvYnNlcnZlUm9vbUV2ZW50cyhcbiAgICByb29tLFxuICAgIFJvb21FdmVudDIuUm9vbU1ldGFkYXRhQ2hhbmdlZCxcbiAgICBSb29tRXZlbnQyLkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWRcbiAgKS5waXBlKFxuICAgIG1hcCgocikgPT4ge1xuICAgICAgcmV0dXJuIHsgbmFtZTogci5uYW1lLCBtZXRhZGF0YTogci5tZXRhZGF0YSB9O1xuICAgIH0pXG4gICk7XG4gIHJldHVybiBvYnNlcnZlcjtcbn1cbmZ1bmN0aW9uIGFjdGl2ZVNwZWFrZXJPYnNlcnZlcihyb29tKSB7XG4gIHJldHVybiByb29tRXZlbnRTZWxlY3Rvcihyb29tLCBSb29tRXZlbnQyLkFjdGl2ZVNwZWFrZXJzQ2hhbmdlZCkucGlwZShcbiAgICBtYXAoKFtzcGVha2Vyc10pID0+IHNwZWFrZXJzKVxuICApO1xufVxuZnVuY3Rpb24gY3JlYXRlTWVkaWFEZXZpY2VPYnNlcnZlcihraW5kLCByZXF1ZXN0UGVybWlzc2lvbnMgPSB0cnVlKSB7XG4gIHZhciBfYTtcbiAgY29uc3Qgb25EZXZpY2VDaGFuZ2UgPSAoKSA9PiBfX2FzeW5jKHRoaXMsIG51bGwsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgbmV3RGV2aWNlcyA9IHlpZWxkIFJvb20uZ2V0TG9jYWxEZXZpY2VzKGtpbmQsIHJlcXVlc3RQZXJtaXNzaW9ucyk7XG4gICAgZGV2aWNlU3ViamVjdC5uZXh0KG5ld0RldmljZXMpO1xuICB9KTtcbiAgY29uc3QgZGV2aWNlU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XG4gIGNvbnN0IG9ic2VydmFibGUgPSBkZXZpY2VTdWJqZWN0LnBpcGUoXG4gICAgZmluYWxpemUoKCkgPT4ge1xuICAgICAgdmFyIF9hMjtcbiAgICAgIChfYTIgPSBuYXZpZ2F0b3IgPT0gbnVsbCA/IHZvaWQgMCA6IG5hdmlnYXRvci5tZWRpYURldmljZXMpID09IG51bGwgPyB2b2lkIDAgOiBfYTIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRldmljZWNoYW5nZVwiLCBvbkRldmljZUNoYW5nZSk7XG4gICAgfSlcbiAgKTtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBpZiAoIXdpbmRvdy5pc1NlY3VyZUNvbnRleHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEFjY2Vzc2luZyBtZWRpYSBkZXZpY2VzIGlzIGF2YWlsYWJsZSBvbmx5IGluIHNlY3VyZSBjb250ZXh0cyAoSFRUUFMgYW5kIGxvY2FsaG9zdCksIGluIHNvbWUgb3IgYWxsIHN1cHBvcnRpbmcgYnJvd3NlcnMuIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL05hdmlnYXRvci9tZWRpYURldmljZXNgXG4gICAgICApO1xuICAgIH1cbiAgICAoX2EgPSBuYXZpZ2F0b3IgPT0gbnVsbCA/IHZvaWQgMCA6IG5hdmlnYXRvci5tZWRpYURldmljZXMpID09IG51bGwgPyB2b2lkIDAgOiBfYS5hZGRFdmVudExpc3RlbmVyKFwiZGV2aWNlY2hhbmdlXCIsIG9uRGV2aWNlQ2hhbmdlKTtcbiAgfVxuICByZXR1cm4gY29uY2F0KFJvb20uZ2V0TG9jYWxEZXZpY2VzKGtpbmQsIHJlcXVlc3RQZXJtaXNzaW9ucyksIG9ic2VydmFibGUpO1xufVxuZnVuY3Rpb24gY3JlYXRlRGF0YU9ic2VydmVyKHJvb20pIHtcbiAgcmV0dXJuIHJvb21FdmVudFNlbGVjdG9yKHJvb20sIFJvb21FdmVudDIuRGF0YVJlY2VpdmVkKTtcbn1cbmZ1bmN0aW9uIHJvb21BdWRpb1BsYXliYWNrQWxsb3dlZE9ic2VydmFibGUocm9vbSkge1xuICBjb25zdCBvYnNlcnZhYmxlID0gb2JzZXJ2ZVJvb21FdmVudHMocm9vbSwgUm9vbUV2ZW50Mi5BdWRpb1BsYXliYWNrU3RhdHVzQ2hhbmdlZCkucGlwZShcbiAgICBtYXAoKHJvb20yKSA9PiB7XG4gICAgICByZXR1cm4geyBjYW5QbGF5QXVkaW86IHJvb20yLmNhblBsYXliYWNrQXVkaW8gfTtcbiAgICB9KVxuICApO1xuICByZXR1cm4gb2JzZXJ2YWJsZTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUFjdGl2ZURldmljZU9ic2VydmFibGUocm9vbSwga2luZCkge1xuICByZXR1cm4gcm9vbUV2ZW50U2VsZWN0b3Iocm9vbSwgUm9vbUV2ZW50Mi5BY3RpdmVEZXZpY2VDaGFuZ2VkKS5waXBlKFxuICAgIGZpbHRlcigoW2tpbmRPZkRldmljZV0pID0+IGtpbmRPZkRldmljZSA9PT0ga2luZCksXG4gICAgbWFwKChba2luZDIsIGRldmljZUlkXSkgPT4ge1xuICAgICAgbG9nLmRlYnVnKFwiYWN0aXZlRGV2aWNlT2JzZXJ2YWJsZSB8IFJvb21FdmVudC5BY3RpdmVEZXZpY2VDaGFuZ2VkXCIsIHsga2luZDoga2luZDIsIGRldmljZUlkIH0pO1xuICAgICAgcmV0dXJuIGRldmljZUlkO1xuICAgIH0pLFxuICAgIHN0YXJ0V2l0aChyb29tLmdldEFjdGl2ZURldmljZShraW5kKSlcbiAgKTtcbn1cbmZ1bmN0aW9uIGVuY3J5cHRpb25TdGF0dXNPYnNlcnZhYmxlKHJvb20sIHBhcnRpY2lwYW50KSB7XG4gIHJldHVybiByb29tRXZlbnRTZWxlY3Rvcihyb29tLCBSb29tRXZlbnQyLlBhcnRpY2lwYW50RW5jcnlwdGlvblN0YXR1c0NoYW5nZWQpLnBpcGUoXG4gICAgZmlsdGVyKFxuICAgICAgKFssIHBdKSA9PiBwYXJ0aWNpcGFudC5pZGVudGl0eSA9PT0gKHAgPT0gbnVsbCA/IHZvaWQgMCA6IHAuaWRlbnRpdHkpIHx8ICFwICYmIHBhcnRpY2lwYW50LmlkZW50aXR5ID09PSByb29tLmxvY2FsUGFydGljaXBhbnQuaWRlbnRpdHlcbiAgICApLFxuICAgIG1hcCgoW2VuY3J5cHRlZF0pID0+IGVuY3J5cHRlZCksXG4gICAgc3RhcnRXaXRoKFxuICAgICAgcGFydGljaXBhbnQgaW5zdGFuY2VvZiBMb2NhbFBhcnRpY2lwYW50MyA/IHBhcnRpY2lwYW50LmlzRTJFRUVuYWJsZWQgOiBwYXJ0aWNpcGFudC5pc0VuY3J5cHRlZFxuICAgIClcbiAgKTtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvbWVkaWFUcmFjay50c1xuaW1wb3J0IHsgVHJhY2sgYXMgVHJhY2s1IH0gZnJvbSBcImxpdmVraXQtY2xpZW50XCI7XG5pbXBvcnQgeyBtYXAgYXMgbWFwMiwgc3RhcnRXaXRoIGFzIHN0YXJ0V2l0aDIgfSBmcm9tIFwicnhqc1wiO1xuXG4vLyBzcmMvc3R5bGVzLWludGVyZmFjZS9jbGFzcy1wcmVmaXhlci50c1xuZnVuY3Rpb24gcHJlZml4Q2xhc3ModW5wcmVmaXhlZENsYXNzTmFtZSkge1xuICByZXR1cm4gYCR7Y3NzUHJlZml4fS0ke3VucHJlZml4ZWRDbGFzc05hbWV9YDtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvbWVkaWFUcmFjay50c1xuZnVuY3Rpb24gc2V0dXBNZWRpYVRyYWNrKHRyYWNrSWRlbnRpZmllcikge1xuICBjb25zdCBpbml0aWFsUHViID0gZ2V0VHJhY2tCeUlkZW50aWZpZXIodHJhY2tJZGVudGlmaWVyKTtcbiAgY29uc3QgdHJhY2tPYnNlcnZlciA9IG9ic2VydmVQYXJ0aWNpcGFudE1lZGlhKHRyYWNrSWRlbnRpZmllci5wYXJ0aWNpcGFudCkucGlwZShcbiAgICBtYXAyKCgpID0+IHtcbiAgICAgIHJldHVybiBnZXRUcmFja0J5SWRlbnRpZmllcih0cmFja0lkZW50aWZpZXIpO1xuICAgIH0pLFxuICAgIHN0YXJ0V2l0aDIoaW5pdGlhbFB1YilcbiAgKTtcbiAgY29uc3QgY2xhc3NOYW1lID0gcHJlZml4Q2xhc3MoXG4gICAgdHJhY2tJZGVudGlmaWVyLnNvdXJjZSA9PT0gVHJhY2s1LlNvdXJjZS5DYW1lcmEgfHwgdHJhY2tJZGVudGlmaWVyLnNvdXJjZSA9PT0gVHJhY2s1LlNvdXJjZS5TY3JlZW5TaGFyZSA/IFwicGFydGljaXBhbnQtbWVkaWEtdmlkZW9cIiA6IFwicGFydGljaXBhbnQtbWVkaWEtYXVkaW9cIlxuICApO1xuICByZXR1cm4geyBjbGFzc05hbWUsIHRyYWNrT2JzZXJ2ZXIgfTtcbn1cbmZ1bmN0aW9uIGdldFRyYWNrQnlJZGVudGlmaWVyKG9wdGlvbnMpIHtcbiAgaWYgKGlzVHJhY2tSZWZlcmVuY2Uob3B0aW9ucykpIHtcbiAgICByZXR1cm4gb3B0aW9ucy5wdWJsaWNhdGlvbjtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB7IHNvdXJjZSwgbmFtZSwgcGFydGljaXBhbnQgfSA9IG9wdGlvbnM7XG4gICAgaWYgKHNvdXJjZSAmJiBuYW1lKSB7XG4gICAgICByZXR1cm4gcGFydGljaXBhbnQuZ2V0VHJhY2tzKCkuZmluZCgocHViKSA9PiBwdWIuc291cmNlID09PSBzb3VyY2UgJiYgcHViLnRyYWNrTmFtZSA9PT0gbmFtZSk7XG4gICAgfSBlbHNlIGlmIChuYW1lKSB7XG4gICAgICByZXR1cm4gcGFydGljaXBhbnQuZ2V0VHJhY2tCeU5hbWUobmFtZSk7XG4gICAgfSBlbHNlIGlmIChzb3VyY2UpIHtcbiAgICAgIHJldHVybiBwYXJ0aWNpcGFudC5nZXRUcmFjayhzb3VyY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBdCBsZWFzdCBvbmUgb2Ygc291cmNlIGFuZCBuYW1lIG5lZWRzIHRvIGJlIGRlZmluZWRcIik7XG4gICAgfVxuICB9XG59XG5cbi8vIHNyYy9vYnNlcnZhYmxlcy9wYXJ0aWNpcGFudC50c1xuZnVuY3Rpb24gb2JzZXJ2ZVBhcnRpY2lwYW50RXZlbnRzKHBhcnRpY2lwYW50LCAuLi5ldmVudHMpIHtcbiAgY29uc3Qgb2JzZXJ2YWJsZSA9IG5ldyBPYnNlcnZhYmxlMigoc3Vic2NyaWJlKSA9PiB7XG4gICAgY29uc3Qgb25QYXJ0aWNpcGFudFVwZGF0ZSA9ICgpID0+IHtcbiAgICAgIHN1YnNjcmliZS5uZXh0KHBhcnRpY2lwYW50KTtcbiAgICB9O1xuICAgIGV2ZW50cy5mb3JFYWNoKChldnQpID0+IHtcbiAgICAgIHBhcnRpY2lwYW50Lm9uKGV2dCwgb25QYXJ0aWNpcGFudFVwZGF0ZSk7XG4gICAgfSk7XG4gICAgY29uc3QgdW5zdWJzY3JpYmUgPSAoKSA9PiB7XG4gICAgICBldmVudHMuZm9yRWFjaCgoZXZ0KSA9PiB7XG4gICAgICAgIHBhcnRpY2lwYW50Lm9mZihldnQsIG9uUGFydGljaXBhbnRVcGRhdGUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gdW5zdWJzY3JpYmU7XG4gIH0pLnBpcGUoc3RhcnRXaXRoMyhwYXJ0aWNpcGFudCkpO1xuICByZXR1cm4gb2JzZXJ2YWJsZTtcbn1cbmZ1bmN0aW9uIG9ic2VydmVQYXJ0aWNpcGFudE1lZGlhKHBhcnRpY2lwYW50KSB7XG4gIGNvbnN0IHBhcnRpY2lwYW50T2JzZXJ2ZXIgPSBvYnNlcnZlUGFydGljaXBhbnRFdmVudHMoXG4gICAgcGFydGljaXBhbnQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuVHJhY2tNdXRlZCxcbiAgICBQYXJ0aWNpcGFudEV2ZW50Mi5UcmFja1VubXV0ZWQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuUGFydGljaXBhbnRQZXJtaXNzaW9uc0NoYW5nZWQsXG4gICAgLy8gUGFydGljaXBhbnRFdmVudC5Jc1NwZWFraW5nQ2hhbmdlZCxcbiAgICBQYXJ0aWNpcGFudEV2ZW50Mi5UcmFja1B1Ymxpc2hlZCxcbiAgICBQYXJ0aWNpcGFudEV2ZW50Mi5UcmFja1VucHVibGlzaGVkLFxuICAgIFBhcnRpY2lwYW50RXZlbnQyLkxvY2FsVHJhY2tQdWJsaXNoZWQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuTG9jYWxUcmFja1VucHVibGlzaGVkLFxuICAgIFBhcnRpY2lwYW50RXZlbnQyLk1lZGlhRGV2aWNlc0Vycm9yLFxuICAgIFBhcnRpY2lwYW50RXZlbnQyLlRyYWNrU3Vic2NyaXB0aW9uU3RhdHVzQ2hhbmdlZFxuICAgIC8vIFBhcnRpY2lwYW50RXZlbnQuQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkLFxuICApLnBpcGUoXG4gICAgbWFwMygocCkgPT4ge1xuICAgICAgY29uc3QgeyBpc01pY3JvcGhvbmVFbmFibGVkLCBpc0NhbWVyYUVuYWJsZWQsIGlzU2NyZWVuU2hhcmVFbmFibGVkIH0gPSBwO1xuICAgICAgY29uc3QgbWljcm9waG9uZVRyYWNrID0gcC5nZXRUcmFjayhUcmFjazYuU291cmNlLk1pY3JvcGhvbmUpO1xuICAgICAgY29uc3QgY2FtZXJhVHJhY2sgPSBwLmdldFRyYWNrKFRyYWNrNi5Tb3VyY2UuQ2FtZXJhKTtcbiAgICAgIGNvbnN0IHBhcnRpY2lwYW50TWVkaWEgPSB7XG4gICAgICAgIGlzQ2FtZXJhRW5hYmxlZCxcbiAgICAgICAgaXNNaWNyb3Bob25lRW5hYmxlZCxcbiAgICAgICAgaXNTY3JlZW5TaGFyZUVuYWJsZWQsXG4gICAgICAgIGNhbWVyYVRyYWNrLFxuICAgICAgICBtaWNyb3Bob25lVHJhY2ssXG4gICAgICAgIHBhcnRpY2lwYW50OiBwXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHBhcnRpY2lwYW50TWVkaWE7XG4gICAgfSlcbiAgKTtcbiAgcmV0dXJuIHBhcnRpY2lwYW50T2JzZXJ2ZXI7XG59XG5mdW5jdGlvbiBjcmVhdGVUcmFja09ic2VydmVyKHBhcnRpY2lwYW50LCBvcHRpb25zKSB7XG4gIHJldHVybiBvYnNlcnZlUGFydGljaXBhbnRNZWRpYShwYXJ0aWNpcGFudCkucGlwZShcbiAgICBtYXAzKCgpID0+IHtcbiAgICAgIHJldHVybiB7IHB1YmxpY2F0aW9uOiBnZXRUcmFja0J5SWRlbnRpZmllcihvcHRpb25zKSB9O1xuICAgIH0pXG4gICk7XG59XG5mdW5jdGlvbiBwYXJ0aWNpcGFudEluZm9PYnNlcnZlcihwYXJ0aWNpcGFudCkge1xuICBjb25zdCBvYnNlcnZlciA9IG9ic2VydmVQYXJ0aWNpcGFudEV2ZW50cyhcbiAgICBwYXJ0aWNpcGFudCxcbiAgICBQYXJ0aWNpcGFudEV2ZW50Mi5QYXJ0aWNpcGFudE1ldGFkYXRhQ2hhbmdlZFxuICAgIC8vIFBhcnRpY2lwYW50RXZlbnQuTG9jYWxUcmFja1B1Ymxpc2hlZCxcbiAgKS5waXBlKFxuICAgIG1hcDMoKHsgbmFtZSwgaWRlbnRpdHksIG1ldGFkYXRhIH0pID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGlkZW50aXR5LFxuICAgICAgICBtZXRhZGF0YVxuICAgICAgfTtcbiAgICB9KSxcbiAgICBzdGFydFdpdGgzKHtcbiAgICAgIG5hbWU6IHBhcnRpY2lwYW50Lm5hbWUsXG4gICAgICBpZGVudGl0eTogcGFydGljaXBhbnQuaWRlbnRpdHksXG4gICAgICBtZXRhZGF0YTogcGFydGljaXBhbnQubWV0YWRhdGFcbiAgICB9KVxuICApO1xuICByZXR1cm4gb2JzZXJ2ZXI7XG59XG5mdW5jdGlvbiBjcmVhdGVDb25uZWN0aW9uUXVhbGl0eU9ic2VydmVyKHBhcnRpY2lwYW50KSB7XG4gIGNvbnN0IG9ic2VydmVyID0gcGFydGljaXBhbnRFdmVudFNlbGVjdG9yKFxuICAgIHBhcnRpY2lwYW50LFxuICAgIFBhcnRpY2lwYW50RXZlbnQyLkNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZFxuICApLnBpcGUoXG4gICAgbWFwMygoW3F1YWxpdHldKSA9PiBxdWFsaXR5KSxcbiAgICBzdGFydFdpdGgzKHBhcnRpY2lwYW50LmNvbm5lY3Rpb25RdWFsaXR5KVxuICApO1xuICByZXR1cm4gb2JzZXJ2ZXI7XG59XG5mdW5jdGlvbiBwYXJ0aWNpcGFudEV2ZW50U2VsZWN0b3IocGFydGljaXBhbnQsIGV2ZW50KSB7XG4gIGNvbnN0IG9ic2VydmFibGUgPSBuZXcgT2JzZXJ2YWJsZTIoKHN1YnNjcmliZSkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZSA9ICguLi5wYXJhbXMpID0+IHtcbiAgICAgIHN1YnNjcmliZS5uZXh0KHBhcmFtcyk7XG4gICAgfTtcbiAgICBwYXJ0aWNpcGFudC5vbihldmVudCwgdXBkYXRlKTtcbiAgICBjb25zdCB1bnN1YnNjcmliZSA9ICgpID0+IHtcbiAgICAgIHBhcnRpY2lwYW50Lm9mZihldmVudCwgdXBkYXRlKTtcbiAgICB9O1xuICAgIHJldHVybiB1bnN1YnNjcmliZTtcbiAgfSk7XG4gIHJldHVybiBvYnNlcnZhYmxlO1xufVxuZnVuY3Rpb24gbXV0ZWRPYnNlcnZlcih0cmFja1JlZikge1xuICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gIHJldHVybiBvYnNlcnZlUGFydGljaXBhbnRFdmVudHMoXG4gICAgdHJhY2tSZWYucGFydGljaXBhbnQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuVHJhY2tNdXRlZCxcbiAgICBQYXJ0aWNpcGFudEV2ZW50Mi5UcmFja1VubXV0ZWQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuVHJhY2tTdWJzY3JpYmVkLFxuICAgIFBhcnRpY2lwYW50RXZlbnQyLlRyYWNrVW5zdWJzY3JpYmVkLFxuICAgIFBhcnRpY2lwYW50RXZlbnQyLkxvY2FsVHJhY2tQdWJsaXNoZWQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuTG9jYWxUcmFja1VucHVibGlzaGVkXG4gICkucGlwZShcbiAgICBtYXAzKChwYXJ0aWNpcGFudCkgPT4ge1xuICAgICAgdmFyIF9hMiwgX2IyO1xuICAgICAgY29uc3QgcHViID0gKF9hMiA9IHRyYWNrUmVmLnB1YmxpY2F0aW9uKSAhPSBudWxsID8gX2EyIDogcGFydGljaXBhbnQuZ2V0VHJhY2sodHJhY2tSZWYuc291cmNlKTtcbiAgICAgIHJldHVybiAoX2IyID0gcHViID09IG51bGwgPyB2b2lkIDAgOiBwdWIuaXNNdXRlZCkgIT0gbnVsbCA/IF9iMiA6IHRydWU7XG4gICAgfSksXG4gICAgc3RhcnRXaXRoMyhcbiAgICAgIChfZCA9IChfYyA9IChfYSA9IHRyYWNrUmVmLnB1YmxpY2F0aW9uKSA9PSBudWxsID8gdm9pZCAwIDogX2EuaXNNdXRlZCkgIT0gbnVsbCA/IF9jIDogKF9iID0gdHJhY2tSZWYucGFydGljaXBhbnQuZ2V0VHJhY2sodHJhY2tSZWYuc291cmNlKSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9iLmlzTXV0ZWQpICE9IG51bGwgPyBfZCA6IHRydWVcbiAgICApXG4gICk7XG59XG5mdW5jdGlvbiBjcmVhdGVJc1NwZWFraW5nT2JzZXJ2ZXIocGFydGljaXBhbnQpIHtcbiAgcmV0dXJuIHBhcnRpY2lwYW50RXZlbnRTZWxlY3RvcihwYXJ0aWNpcGFudCwgUGFydGljaXBhbnRFdmVudDIuSXNTcGVha2luZ0NoYW5nZWQpLnBpcGUoXG4gICAgbWFwMygoW2lzU3BlYWtpbmddKSA9PiBpc1NwZWFraW5nKVxuICApO1xufVxuZnVuY3Rpb24gY29ubmVjdGVkUGFydGljaXBhbnRzT2JzZXJ2ZXIocm9vbSwgb3B0aW9ucyA9IHt9KSB7XG4gIHZhciBfYTtcbiAgbGV0IHN1YnNjcmliZXI7XG4gIGNvbnN0IG9ic2VydmFibGUgPSBuZXcgT2JzZXJ2YWJsZTIoKHN1YikgPT4ge1xuICAgIHN1YnNjcmliZXIgPSBzdWI7XG4gICAgcmV0dXJuICgpID0+IGxpc3RlbmVyLnVuc3Vic2NyaWJlKCk7XG4gIH0pLnBpcGUoc3RhcnRXaXRoMyhBcnJheS5mcm9tKHJvb20ucGFydGljaXBhbnRzLnZhbHVlcygpKSkpO1xuICBjb25zdCBhZGRpdGlvbmFsUm9vbUV2ZW50cyA9IChfYSA9IG9wdGlvbnMuYWRkaXRpb25hbFJvb21FdmVudHMpICE9IG51bGwgPyBfYSA6IGFsbFBhcnRpY2lwYW50Um9vbUV2ZW50cztcbiAgY29uc3Qgcm9vbUV2ZW50cyA9IEFycmF5LmZyb20oXG4gICAgLyogQF9fUFVSRV9fICovIG5ldyBTZXQoW1xuICAgICAgUm9vbUV2ZW50My5QYXJ0aWNpcGFudENvbm5lY3RlZCxcbiAgICAgIFJvb21FdmVudDMuUGFydGljaXBhbnREaXNjb25uZWN0ZWQsXG4gICAgICBSb29tRXZlbnQzLkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQsXG4gICAgICAuLi5hZGRpdGlvbmFsUm9vbUV2ZW50c1xuICAgIF0pXG4gICk7XG4gIGNvbnN0IGxpc3RlbmVyID0gb2JzZXJ2ZVJvb21FdmVudHMocm9vbSwgLi4ucm9vbUV2ZW50cykuc3Vic2NyaWJlKFxuICAgIChyKSA9PiBzdWJzY3JpYmVyID09IG51bGwgPyB2b2lkIDAgOiBzdWJzY3JpYmVyLm5leHQoQXJyYXkuZnJvbShyLnBhcnRpY2lwYW50cy52YWx1ZXMoKSkpXG4gICk7XG4gIGlmIChyb29tLnBhcnRpY2lwYW50cy5zaXplID4gMCkge1xuICAgIHN1YnNjcmliZXIgPT0gbnVsbCA/IHZvaWQgMCA6IHN1YnNjcmliZXIubmV4dChBcnJheS5mcm9tKHJvb20ucGFydGljaXBhbnRzLnZhbHVlcygpKSk7XG4gIH1cbiAgcmV0dXJuIG9ic2VydmFibGU7XG59XG5mdW5jdGlvbiBjb25uZWN0ZWRQYXJ0aWNpcGFudE9ic2VydmVyKHJvb20sIGlkZW50aXR5LCBvcHRpb25zID0ge30pIHtcbiAgdmFyIF9hO1xuICBjb25zdCBhZGRpdGlvbmFsRXZlbnRzID0gKF9hID0gb3B0aW9ucy5hZGRpdGlvbmFsRXZlbnRzKSAhPSBudWxsID8gX2EgOiBhbGxQYXJ0aWNpcGFudEV2ZW50cztcbiAgY29uc3Qgb2JzZXJ2YWJsZSA9IG9ic2VydmVSb29tRXZlbnRzKFxuICAgIHJvb20sXG4gICAgUm9vbUV2ZW50My5QYXJ0aWNpcGFudENvbm5lY3RlZCxcbiAgICBSb29tRXZlbnQzLlBhcnRpY2lwYW50RGlzY29ubmVjdGVkLFxuICAgIFJvb21FdmVudDMuQ29ubmVjdGlvblN0YXRlQ2hhbmdlZFxuICApLnBpcGUoXG4gICAgc3dpdGNoTWFwKChyKSA9PiB7XG4gICAgICBjb25zdCBwYXJ0aWNpcGFudCA9IHIuZ2V0UGFydGljaXBhbnRCeUlkZW50aXR5KGlkZW50aXR5KTtcbiAgICAgIGlmIChwYXJ0aWNpcGFudCkge1xuICAgICAgICByZXR1cm4gb2JzZXJ2ZVBhcnRpY2lwYW50RXZlbnRzKHBhcnRpY2lwYW50LCAuLi5hZGRpdGlvbmFsRXZlbnRzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTIoKHN1YnNjcmliZSkgPT4gc3Vic2NyaWJlLm5leHQodm9pZCAwKSk7XG4gICAgICB9XG4gICAgfSksXG4gICAgc3RhcnRXaXRoMyhyb29tLmdldFBhcnRpY2lwYW50QnlJZGVudGl0eShpZGVudGl0eSkpXG4gICk7XG4gIHJldHVybiBvYnNlcnZhYmxlO1xufVxuZnVuY3Rpb24gcGFydGljaXBhbnRQZXJtaXNzaW9uT2JzZXJ2ZXIocGFydGljaXBhbnQpIHtcbiAgY29uc3Qgb2JzZXJ2ZXIgPSBwYXJ0aWNpcGFudEV2ZW50U2VsZWN0b3IoXG4gICAgcGFydGljaXBhbnQsXG4gICAgUGFydGljaXBhbnRFdmVudDIuUGFydGljaXBhbnRQZXJtaXNzaW9uc0NoYW5nZWRcbiAgKS5waXBlKFxuICAgIG1hcDMoKCkgPT4gcGFydGljaXBhbnQucGVybWlzc2lvbnMpLFxuICAgIHN0YXJ0V2l0aDMocGFydGljaXBhbnQucGVybWlzc2lvbnMpXG4gICk7XG4gIHJldHVybiBvYnNlcnZlcjtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvbWVkaWFUb2dnbGUudHNcbmZ1bmN0aW9uIHNldHVwTWVkaWFUb2dnbGUoc291cmNlLCByb29tLCBvcHRpb25zKSB7XG4gIGNvbnN0IHsgbG9jYWxQYXJ0aWNpcGFudCB9ID0gcm9vbTtcbiAgY29uc3QgZ2V0U291cmNlRW5hYmxlZCA9IChzb3VyY2UyLCBsb2NhbFBhcnRpY2lwYW50MikgPT4ge1xuICAgIGxldCBpc0VuYWJsZWQgPSBmYWxzZTtcbiAgICBzd2l0Y2ggKHNvdXJjZTIpIHtcbiAgICAgIGNhc2UgVHJhY2s3LlNvdXJjZS5DYW1lcmE6XG4gICAgICAgIGlzRW5hYmxlZCA9IGxvY2FsUGFydGljaXBhbnQyLmlzQ2FtZXJhRW5hYmxlZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFRyYWNrNy5Tb3VyY2UuTWljcm9waG9uZTpcbiAgICAgICAgaXNFbmFibGVkID0gbG9jYWxQYXJ0aWNpcGFudDIuaXNNaWNyb3Bob25lRW5hYmxlZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFRyYWNrNy5Tb3VyY2UuU2NyZWVuU2hhcmU6XG4gICAgICAgIGlzRW5hYmxlZCA9IGxvY2FsUGFydGljaXBhbnQyLmlzU2NyZWVuU2hhcmVFbmFibGVkO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gaXNFbmFibGVkO1xuICB9O1xuICBjb25zdCBlbmFibGVkT2JzZXJ2ZXIgPSBvYnNlcnZlUGFydGljaXBhbnRNZWRpYShsb2NhbFBhcnRpY2lwYW50KS5waXBlKFxuICAgIG1hcDQoKG1lZGlhKSA9PiB7XG4gICAgICByZXR1cm4gZ2V0U291cmNlRW5hYmxlZChzb3VyY2UsIG1lZGlhLnBhcnRpY2lwYW50KTtcbiAgICB9KSxcbiAgICBzdGFydFdpdGg0KGdldFNvdXJjZUVuYWJsZWQoc291cmNlLCBsb2NhbFBhcnRpY2lwYW50KSlcbiAgKTtcbiAgY29uc3QgcGVuZGluZ1N1YmplY3QgPSBuZXcgU3ViamVjdDIoKTtcbiAgY29uc3QgdG9nZ2xlID0gKGZvcmNlU3RhdGUsIGNhcHR1cmVPcHRpb25zKSA9PiBfX2FzeW5jKHRoaXMsIG51bGwsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNhcHR1cmVPcHRpb25zICE9IG51bGwgPyBjYXB0dXJlT3B0aW9ucyA6IGNhcHR1cmVPcHRpb25zID0gb3B0aW9ucztcbiAgICAgIHBlbmRpbmdTdWJqZWN0Lm5leHQodHJ1ZSk7XG4gICAgICBzd2l0Y2ggKHNvdXJjZSkge1xuICAgICAgICBjYXNlIFRyYWNrNy5Tb3VyY2UuQ2FtZXJhOlxuICAgICAgICAgIHlpZWxkIGxvY2FsUGFydGljaXBhbnQuc2V0Q2FtZXJhRW5hYmxlZChcbiAgICAgICAgICAgIGZvcmNlU3RhdGUgIT0gbnVsbCA/IGZvcmNlU3RhdGUgOiAhbG9jYWxQYXJ0aWNpcGFudC5pc0NhbWVyYUVuYWJsZWQsXG4gICAgICAgICAgICBjYXB0dXJlT3B0aW9uc1xuICAgICAgICAgICk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgVHJhY2s3LlNvdXJjZS5NaWNyb3Bob25lOlxuICAgICAgICAgIHlpZWxkIGxvY2FsUGFydGljaXBhbnQuc2V0TWljcm9waG9uZUVuYWJsZWQoXG4gICAgICAgICAgICBmb3JjZVN0YXRlICE9IG51bGwgPyBmb3JjZVN0YXRlIDogIWxvY2FsUGFydGljaXBhbnQuaXNNaWNyb3Bob25lRW5hYmxlZCxcbiAgICAgICAgICAgIGNhcHR1cmVPcHRpb25zXG4gICAgICAgICAgKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBUcmFjazcuU291cmNlLlNjcmVlblNoYXJlOlxuICAgICAgICAgIHlpZWxkIGxvY2FsUGFydGljaXBhbnQuc2V0U2NyZWVuU2hhcmVFbmFibGVkKFxuICAgICAgICAgICAgZm9yY2VTdGF0ZSAhPSBudWxsID8gZm9yY2VTdGF0ZSA6ICFsb2NhbFBhcnRpY2lwYW50LmlzU2NyZWVuU2hhcmVFbmFibGVkLFxuICAgICAgICAgICAgY2FwdHVyZU9wdGlvbnNcbiAgICAgICAgICApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBwZW5kaW5nU3ViamVjdC5uZXh0KGZhbHNlKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBjbGFzc05hbWUgPSBwcmVmaXhDbGFzcyhcImJ1dHRvblwiKTtcbiAgcmV0dXJuIHtcbiAgICBjbGFzc05hbWUsXG4gICAgdG9nZ2xlLFxuICAgIGVuYWJsZWRPYnNlcnZlcixcbiAgICBwZW5kaW5nT2JzZXJ2ZXI6IHBlbmRpbmdTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpXG4gIH07XG59XG5mdW5jdGlvbiBzZXR1cE1hbnVhbFRvZ2dsZSgpIHtcbiAgbGV0IHN0YXRlID0gZmFsc2U7XG4gIGNvbnN0IGVuYWJsZWRTdWJqZWN0ID0gbmV3IFN1YmplY3QyKCk7XG4gIGNvbnN0IHBlbmRpbmdTdWJqZWN0ID0gbmV3IFN1YmplY3QyKCk7XG4gIGNvbnN0IHRvZ2dsZSA9IChmb3JjZVN0YXRlKSA9PiB7XG4gICAgcGVuZGluZ1N1YmplY3QubmV4dCh0cnVlKTtcbiAgICBzdGF0ZSA9IGZvcmNlU3RhdGUgIT0gbnVsbCA/IGZvcmNlU3RhdGUgOiAhc3RhdGU7XG4gICAgZW5hYmxlZFN1YmplY3QubmV4dChzdGF0ZSk7XG4gICAgcGVuZGluZ1N1YmplY3QubmV4dChmYWxzZSk7XG4gIH07XG4gIGNvbnN0IGNsYXNzTmFtZSA9IHByZWZpeENsYXNzKFwiYnV0dG9uXCIpO1xuICByZXR1cm4ge1xuICAgIGNsYXNzTmFtZSxcbiAgICB0b2dnbGUsXG4gICAgZW5hYmxlZE9ic2VydmVyOiBlbmFibGVkU3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICBwZW5kaW5nT2JzZXJ2ZXI6IHBlbmRpbmdTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpXG4gIH07XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL21lZGlhRGV2aWNlU2VsZWN0LnRzXG5pbXBvcnQge1xuICBUcmFjayBhcyBUcmFjazhcbn0gZnJvbSBcImxpdmVraXQtY2xpZW50XCI7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuZnVuY3Rpb24gc2V0dXBEZXZpY2VTZWxlY3RvcihraW5kLCByb29tLCBsb2NhbFRyYWNrKSB7XG4gIGNvbnN0IGFjdGl2ZURldmljZVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHZvaWQgMCk7XG4gIGNvbnN0IGFjdGl2ZURldmljZU9ic2VydmFibGUgPSByb29tID8gY3JlYXRlQWN0aXZlRGV2aWNlT2JzZXJ2YWJsZShyb29tLCBraW5kKSA6IGFjdGl2ZURldmljZVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIGNvbnN0IHNldEFjdGl2ZU1lZGlhRGV2aWNlID0gKF8wLCAuLi5fMSkgPT4gX19hc3luYyh0aGlzLCBbXzAsIC4uLl8xXSwgZnVuY3Rpb24qIChpZCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgaWYgKHJvb20pIHtcbiAgICAgIGxvZy5kZWJ1ZyhgU3dpdGNoaW5nIGFjdGl2ZSBkZXZpY2Ugb2Yga2luZCBcIiR7a2luZH1cIiB3aXRoIGlkICR7aWR9LmApO1xuICAgICAgeWllbGQgcm9vbS5zd2l0Y2hBY3RpdmVEZXZpY2Uoa2luZCwgaWQsIG9wdGlvbnMuZXhhY3QpO1xuICAgICAgY29uc3QgYWN0dWFsRGV2aWNlSWQgPSAoX2EgPSByb29tLmdldEFjdGl2ZURldmljZShraW5kKSkgIT0gbnVsbCA/IF9hIDogaWQ7XG4gICAgICBpZiAoYWN0dWFsRGV2aWNlSWQgIT09IGlkICYmIGlkICE9PSBcImRlZmF1bHRcIikge1xuICAgICAgICBsb2cuaW5mbyhcbiAgICAgICAgICBgV2UgdHJpZWQgdG8gc2VsZWN0IHRoZSBkZXZpY2Ugd2l0aCBpZCAoJHtpZH0pLCBidXQgdGhlIGJyb3dzZXIgZGVjaWRlZCB0byBzZWxlY3QgdGhlIGRldmljZSB3aXRoIGlkICgke2FjdHVhbERldmljZUlkfSkgaW5zdGVhZC5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBsZXQgdGFyZ2V0VHJhY2sgPSB2b2lkIDA7XG4gICAgICBpZiAoa2luZCA9PT0gXCJhdWRpb2lucHV0XCIpXG4gICAgICAgIHRhcmdldFRyYWNrID0gKF9iID0gcm9vbS5sb2NhbFBhcnRpY2lwYW50LmdldFRyYWNrKFRyYWNrOC5Tb3VyY2UuTWljcm9waG9uZSkpID09IG51bGwgPyB2b2lkIDAgOiBfYi50cmFjaztcbiAgICAgIGVsc2UgaWYgKGtpbmQgPT09IFwidmlkZW9pbnB1dFwiKSB7XG4gICAgICAgIHRhcmdldFRyYWNrID0gKF9jID0gcm9vbS5sb2NhbFBhcnRpY2lwYW50LmdldFRyYWNrKFRyYWNrOC5Tb3VyY2UuQ2FtZXJhKSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jLnRyYWNrO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlRGVmYXVsdCA9IGlkID09PSBcImRlZmF1bHRcIiAmJiAhdGFyZ2V0VHJhY2sgfHwgaWQgPT09IFwiZGVmYXVsdFwiICYmICh0YXJnZXRUcmFjayA9PSBudWxsID8gdm9pZCAwIDogdGFyZ2V0VHJhY2subWVkaWFTdHJlYW1UcmFjay5sYWJlbC5zdGFydHNXaXRoKFwiRGVmYXVsdFwiKSk7XG4gICAgICBhY3RpdmVEZXZpY2VTdWJqZWN0Lm5leHQodXNlRGVmYXVsdCA/IGlkIDogYWN0dWFsRGV2aWNlSWQpO1xuICAgIH0gZWxzZSBpZiAobG9jYWxUcmFjaykge1xuICAgICAgeWllbGQgbG9jYWxUcmFjay5zZXREZXZpY2VJZChvcHRpb25zLmV4YWN0ID8geyBleGFjdDogaWQgfSA6IGlkKTtcbiAgICAgIGNvbnN0IGFjdHVhbElkID0geWllbGQgbG9jYWxUcmFjay5nZXREZXZpY2VJZCgpO1xuICAgICAgYWN0aXZlRGV2aWNlU3ViamVjdC5uZXh0KFxuICAgICAgICBpZCA9PT0gXCJkZWZhdWx0XCIgJiYgbG9jYWxUcmFjay5tZWRpYVN0cmVhbVRyYWNrLmxhYmVsLnN0YXJ0c1dpdGgoXCJEZWZhdWx0XCIpID8gaWQgOiBhY3R1YWxJZFxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKGFjdGl2ZURldmljZVN1YmplY3QudmFsdWUgIT09IGlkKSB7XG4gICAgICBsb2cud2FybihcbiAgICAgICAgXCJkZXZpY2Ugc3dpdGNoIHNraXBwZWQsIHBsZWFzZSBwcm92aWRlIGVpdGhlciBhIHJvb20gb3IgYSBsb2NhbCB0cmFjayB0byBzd2l0Y2ggb24uIFwiXG4gICAgICApO1xuICAgICAgYWN0aXZlRGV2aWNlU3ViamVjdC5uZXh0KGlkKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBjbGFzc05hbWUgPSBwcmVmaXhDbGFzcyhcIm1lZGlhLWRldmljZS1zZWxlY3RcIik7XG4gIHJldHVybiB7XG4gICAgY2xhc3NOYW1lLFxuICAgIGFjdGl2ZURldmljZU9ic2VydmFibGUsXG4gICAgc2V0QWN0aXZlTWVkaWFEZXZpY2VcbiAgfTtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvZGlzY29ubmVjdEJ1dHRvbi50c1xuZnVuY3Rpb24gc2V0dXBEaXNjb25uZWN0QnV0dG9uKHJvb20pIHtcbiAgY29uc3QgZGlzY29ubmVjdCA9IChzdG9wVHJhY2tzKSA9PiB7XG4gICAgcm9vbS5kaXNjb25uZWN0KHN0b3BUcmFja3MpO1xuICB9O1xuICBjb25zdCBjbGFzc05hbWUgPSBwcmVmaXhDbGFzcyhcImRpc2Nvbm5lY3QtYnV0dG9uXCIpO1xuICByZXR1cm4geyBjbGFzc05hbWUsIGRpc2Nvbm5lY3QgfTtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvY29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IudHNcbmZ1bmN0aW9uIHNldHVwQ29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IocGFydGljaXBhbnQpIHtcbiAgY29uc3QgY2xhc3NOYW1lID0gcHJlZml4Q2xhc3MoXCJjb25uZWN0aW9uLXF1YWxpdHlcIik7XG4gIGNvbnN0IGNvbm5lY3Rpb25RdWFsaXR5T2JzZXJ2ZXIgPSBjcmVhdGVDb25uZWN0aW9uUXVhbGl0eU9ic2VydmVyKHBhcnRpY2lwYW50KTtcbiAgcmV0dXJuIHsgY2xhc3NOYW1lLCBjb25uZWN0aW9uUXVhbGl0eU9ic2VydmVyIH07XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL3RyYWNrTXV0ZWRJbmRpY2F0b3IudHNcbmltcG9ydCB7IFRyYWNrIGFzIFRyYWNrOSB9IGZyb20gXCJsaXZla2l0LWNsaWVudFwiO1xuZnVuY3Rpb24gc2V0dXBUcmFja011dGVkSW5kaWNhdG9yKHRyYWNrUmVmKSB7XG4gIGxldCBjbGFzc0ZvclNvdXJjZSA9IFwidHJhY2stbXV0ZWQtaW5kaWNhdG9yLWNhbWVyYVwiO1xuICBzd2l0Y2ggKHRyYWNrUmVmLnNvdXJjZSkge1xuICAgIGNhc2UgVHJhY2s5LlNvdXJjZS5DYW1lcmE6XG4gICAgICBjbGFzc0ZvclNvdXJjZSA9IFwidHJhY2stbXV0ZWQtaW5kaWNhdG9yLWNhbWVyYVwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBUcmFjazkuU291cmNlLk1pY3JvcGhvbmU6XG4gICAgICBjbGFzc0ZvclNvdXJjZSA9IFwidHJhY2stbXV0ZWQtaW5kaWNhdG9yLW1pY3JvcGhvbmVcIjtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBicmVhaztcbiAgfVxuICBjb25zdCBjbGFzc05hbWUgPSBwcmVmaXhDbGFzcyhjbGFzc0ZvclNvdXJjZSk7XG4gIGNvbnN0IG1lZGlhTXV0ZWRPYnNlcnZlciA9IG11dGVkT2JzZXJ2ZXIodHJhY2tSZWYpO1xuICByZXR1cm4geyBjbGFzc05hbWUsIG1lZGlhTXV0ZWRPYnNlcnZlciB9O1xufVxuXG4vLyBzcmMvY29tcG9uZW50cy9wYXJ0aWNpcGFudE5hbWUudHNcbmZ1bmN0aW9uIHNldHVwUGFydGljaXBhbnROYW1lKHBhcnRpY2lwYW50KSB7XG4gIGNvbnN0IGluZm9PYnNlcnZlciA9IHBhcnRpY2lwYW50SW5mb09ic2VydmVyKHBhcnRpY2lwYW50KTtcbiAgcmV0dXJuIHsgY2xhc3NOYW1lOiBcImxrLXBhcnRpY2lwYW50LW5hbWVcIiwgaW5mb09ic2VydmVyIH07XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL3BhcnRpY2lwYW50VGlsZS50c1xuZnVuY3Rpb24gc2V0dXBQYXJ0aWNpcGFudFRpbGUoKSB7XG4gIGNvbnN0IGNsYXNzTmFtZSA9IHByZWZpeENsYXNzKFwicGFydGljaXBhbnQtdGlsZVwiKTtcbiAgcmV0dXJuIHtcbiAgICBjbGFzc05hbWVcbiAgfTtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvY2hhdC50c1xuaW1wb3J0IHsgRGF0YVBhY2tldF9LaW5kIGFzIERhdGFQYWNrZXRfS2luZDIgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCBhcyBCZWhhdmlvclN1YmplY3QyLCBTdWJqZWN0IGFzIFN1YmplY3QzLCBzY2FuLCBtYXAgYXMgbWFwNiwgdGFrZVVudGlsIH0gZnJvbSBcInJ4anNcIjtcblxuLy8gc3JjL29ic2VydmFibGVzL2RhdGFDaGFubmVsLnRzXG5pbXBvcnQgeyBEYXRhUGFja2V0X0tpbmQgfSBmcm9tIFwibGl2ZWtpdC1jbGllbnRcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgYXMgT2JzZXJ2YWJsZTMsIGZpbHRlciBhcyBmaWx0ZXIyLCBtYXAgYXMgbWFwNSB9IGZyb20gXCJyeGpzXCI7XG52YXIgRGF0YVRvcGljID0ge1xuICBDSEFUOiBcImxrLWNoYXQtdG9waWNcIlxufTtcbmZ1bmN0aW9uIHNlbmRNZXNzYWdlKF8wLCBfMSwgXzIpIHtcbiAgcmV0dXJuIF9fYXN5bmModGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiogKGxvY2FsUGFydGljaXBhbnQsIHBheWxvYWQsIHRvcGljLCBvcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB7IGtpbmQsIGRlc3RpbmF0aW9uIH0gPSBvcHRpb25zO1xuICAgIHlpZWxkIGxvY2FsUGFydGljaXBhbnQucHVibGlzaERhdGEocGF5bG9hZCwga2luZCAhPSBudWxsID8ga2luZCA6IERhdGFQYWNrZXRfS2luZC5SRUxJQUJMRSwge1xuICAgICAgZGVzdGluYXRpb24sXG4gICAgICB0b3BpY1xuICAgIH0pO1xuICB9KTtcbn1cbmZ1bmN0aW9uIHNldHVwRGF0YU1lc3NhZ2VIYW5kbGVyKHJvb20sIHRvcGljLCBvbk1lc3NhZ2UpIHtcbiAgY29uc3QgbWVzc2FnZU9ic2VydmFibGUgPSBjcmVhdGVEYXRhT2JzZXJ2ZXIocm9vbSkucGlwZShcbiAgICBmaWx0ZXIyKChbLCAsICwgbWVzc2FnZVRvcGljXSkgPT4gdG9waWMgPT09IHZvaWQgMCB8fCBtZXNzYWdlVG9waWMgPT09IHRvcGljKSxcbiAgICBtYXA1KChbcGF5bG9hZCwgcGFydGljaXBhbnQsICwgbWVzc2FnZVRvcGljXSkgPT4ge1xuICAgICAgY29uc3QgbXNnID0ge1xuICAgICAgICBwYXlsb2FkLFxuICAgICAgICB0b3BpYzogbWVzc2FnZVRvcGljLFxuICAgICAgICBmcm9tOiBwYXJ0aWNpcGFudFxuICAgICAgfTtcbiAgICAgIG9uTWVzc2FnZSA9PSBudWxsID8gdm9pZCAwIDogb25NZXNzYWdlKG1zZyk7XG4gICAgICByZXR1cm4gbXNnO1xuICAgIH0pXG4gICk7XG4gIGxldCBpc1NlbmRpbmdTdWJzY3JpYmVyO1xuICBjb25zdCBpc1NlbmRpbmdPYnNlcnZhYmxlID0gbmV3IE9ic2VydmFibGUzKChzdWJzY3JpYmVyKSA9PiB7XG4gICAgaXNTZW5kaW5nU3Vic2NyaWJlciA9IHN1YnNjcmliZXI7XG4gIH0pO1xuICBjb25zdCBzZW5kID0gKF8wLCAuLi5fMSkgPT4gX19hc3luYyh0aGlzLCBbXzAsIC4uLl8xXSwgZnVuY3Rpb24qIChwYXlsb2FkLCBvcHRpb25zID0ge30pIHtcbiAgICBpc1NlbmRpbmdTdWJzY3JpYmVyLm5leHQodHJ1ZSk7XG4gICAgdHJ5IHtcbiAgICAgIHlpZWxkIHNlbmRNZXNzYWdlKHJvb20ubG9jYWxQYXJ0aWNpcGFudCwgcGF5bG9hZCwgdG9waWMsIG9wdGlvbnMpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpc1NlbmRpbmdTdWJzY3JpYmVyLm5leHQoZmFsc2UpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB7IG1lc3NhZ2VPYnNlcnZhYmxlLCBpc1NlbmRpbmdPYnNlcnZhYmxlLCBzZW5kIH07XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL2NoYXQudHNcbnZhciBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XG52YXIgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xudmFyIGVuY29kZSA9IChtZXNzYWdlKSA9PiBlbmNvZGVyLmVuY29kZShKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IG1lc3NhZ2UubWVzc2FnZSwgdGltZXN0YW1wOiBtZXNzYWdlLnRpbWVzdGFtcCB9KSk7XG52YXIgZGVjb2RlID0gKG1lc3NhZ2UpID0+IEpTT04ucGFyc2UoZGVjb2Rlci5kZWNvZGUobWVzc2FnZSkpO1xuZnVuY3Rpb24gc2V0dXBDaGF0KHJvb20sIG9wdGlvbnMpIHtcbiAgY29uc3Qgb25EZXN0cm95T2JzZXJ2YWJsZSA9IG5ldyBTdWJqZWN0MygpO1xuICBjb25zdCBtZXNzYWdlU3ViamVjdCA9IG5ldyBTdWJqZWN0MygpO1xuICBjb25zdCB7IG1lc3NhZ2VPYnNlcnZhYmxlIH0gPSBzZXR1cERhdGFNZXNzYWdlSGFuZGxlcihyb29tLCBEYXRhVG9waWMuQ0hBVCk7XG4gIG1lc3NhZ2VPYnNlcnZhYmxlLnBpcGUodGFrZVVudGlsKG9uRGVzdHJveU9ic2VydmFibGUpKS5zdWJzY3JpYmUobWVzc2FnZVN1YmplY3QpO1xuICBjb25zdCB7IG1lc3NhZ2VEZWNvZGVyLCBtZXNzYWdlRW5jb2RlciB9ID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucyA6IHt9O1xuICBjb25zdCBmaW5hbE1lc3NhZ2VEZWNvZGVyID0gbWVzc2FnZURlY29kZXIgIT0gbnVsbCA/IG1lc3NhZ2VEZWNvZGVyIDogZGVjb2RlO1xuICBjb25zdCBtZXNzYWdlc09ic2VydmFibGUgPSBtZXNzYWdlU3ViamVjdC5waXBlKFxuICAgIG1hcDYoKG1zZykgPT4ge1xuICAgICAgY29uc3QgcGFyc2VkTWVzc2FnZSA9IGZpbmFsTWVzc2FnZURlY29kZXIobXNnLnBheWxvYWQpO1xuICAgICAgY29uc3QgbmV3TWVzc2FnZSA9IF9fc3ByZWFkUHJvcHMoX19zcHJlYWRWYWx1ZXMoe30sIHBhcnNlZE1lc3NhZ2UpLCB7IGZyb206IG1zZy5mcm9tIH0pO1xuICAgICAgcmV0dXJuIG5ld01lc3NhZ2U7XG4gICAgfSksXG4gICAgc2NhbigoYWNjLCB2YWx1ZSkgPT4gWy4uLmFjYywgdmFsdWVdLCBbXSksXG4gICAgdGFrZVVudGlsKG9uRGVzdHJveU9ic2VydmFibGUpXG4gICk7XG4gIGNvbnN0IGlzU2VuZGluZyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0MihmYWxzZSk7XG4gIGNvbnN0IGZpbmFsTWVzc2FnZUVuY29kZXIgPSBtZXNzYWdlRW5jb2RlciAhPSBudWxsID8gbWVzc2FnZUVuY29kZXIgOiBlbmNvZGU7XG4gIGNvbnN0IHNlbmQgPSAobWVzc2FnZSkgPT4gX19hc3luYyh0aGlzLCBudWxsLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgY29uc3QgZW5jb2RlZE1zZyA9IGZpbmFsTWVzc2FnZUVuY29kZXIoeyBtZXNzYWdlLCB0aW1lc3RhbXAgfSk7XG4gICAgaXNTZW5kaW5nJC5uZXh0KHRydWUpO1xuICAgIHRyeSB7XG4gICAgICB5aWVsZCBzZW5kTWVzc2FnZShyb29tLmxvY2FsUGFydGljaXBhbnQsIGVuY29kZWRNc2csIERhdGFUb3BpYy5DSEFULCB7XG4gICAgICAgIGtpbmQ6IERhdGFQYWNrZXRfS2luZDIuUkVMSUFCTEVcbiAgICAgIH0pO1xuICAgICAgbWVzc2FnZVN1YmplY3QubmV4dCh7XG4gICAgICAgIHBheWxvYWQ6IGVuY29kZWRNc2csXG4gICAgICAgIHRvcGljOiBEYXRhVG9waWMuQ0hBVCxcbiAgICAgICAgZnJvbTogcm9vbS5sb2NhbFBhcnRpY2lwYW50XG4gICAgICB9KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaXNTZW5kaW5nJC5uZXh0KGZhbHNlKTtcbiAgICB9XG4gIH0pO1xuICBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgIG9uRGVzdHJveU9ic2VydmFibGUubmV4dCgpO1xuICAgIG9uRGVzdHJveU9ic2VydmFibGUuY29tcGxldGUoKTtcbiAgfVxuICByZXR1cm4geyBtZXNzYWdlT2JzZXJ2YWJsZTogbWVzc2FnZXNPYnNlcnZhYmxlLCBpc1NlbmRpbmdPYnNlcnZhYmxlOiBpc1NlbmRpbmckLCBzZW5kLCBkZXN0cm95IH07XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL3N0YXJ0QXVkaW8udHNcbmZ1bmN0aW9uIHNldHVwU3RhcnRBdWRpbygpIHtcbiAgY29uc3QgaGFuZGxlU3RhcnRBdWRpb1BsYXliYWNrID0gKHJvb20pID0+IF9fYXN5bmModGhpcywgbnVsbCwgZnVuY3Rpb24qICgpIHtcbiAgICBsb2cuaW5mbyhcIlN0YXJ0IEF1ZGlvIGZvciByb29tOiBcIiwgcm9vbSk7XG4gICAgeWllbGQgcm9vbS5zdGFydEF1ZGlvKCk7XG4gIH0pO1xuICBjb25zdCBjbGFzc05hbWUgPSBwcmVmaXhDbGFzcyhcInN0YXJ0LWF1ZGlvLWJ1dHRvblwiKTtcbiAgcmV0dXJuIHsgY2xhc3NOYW1lLCByb29tQXVkaW9QbGF5YmFja0FsbG93ZWRPYnNlcnZhYmxlLCBoYW5kbGVTdGFydEF1ZGlvUGxheWJhY2sgfTtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvY2hhdFRvZ2dsZS50c1xuZnVuY3Rpb24gc2V0dXBDaGF0VG9nZ2xlKCkge1xuICBjb25zdCBjbGFzc05hbWUgPSBbcHJlZml4Q2xhc3MoXCJidXR0b25cIiksIHByZWZpeENsYXNzKFwiY2hhdC10b2dnbGVcIildLmpvaW4oXCIgXCIpO1xuICByZXR1cm4geyBjbGFzc05hbWUgfTtcbn1cblxuLy8gc3JjL2NvbXBvbmVudHMvZm9jdXNUb2dnbGUudHNcbmZ1bmN0aW9uIHNldHVwRm9jdXNUb2dnbGUoKSB7XG4gIGNvbnN0IGNsYXNzTmFtZSA9IFtwcmVmaXhDbGFzcyhcImJ1dHRvblwiKSwgcHJlZml4Q2xhc3MoXCJmb2N1cy10b2dnbGUtYnV0dG9uXCIpXS5qb2luKFwiIFwiKTtcbiAgcmV0dXJuIHsgY2xhc3NOYW1lIH07XG59XG5cbi8vIHNyYy9jb21wb25lbnRzL2NsZWFyUGluQnV0dG9uLnRzXG5mdW5jdGlvbiBzZXR1cENsZWFyUGluQnV0dG9uKCkge1xuICBjb25zdCBjbGFzc05hbWUgPSBcImxrLWNsZWFyLXBpbi1idXR0b24gbGstYnV0dG9uXCI7XG4gIHJldHVybiB7IGNsYXNzTmFtZSB9O1xufVxuXG4vLyBzcmMvY29tcG9uZW50cy9yb29tLnRzXG5mdW5jdGlvbiBzZXR1cExpdmVLaXRSb29tKCkge1xuICBjb25zdCBjbGFzc05hbWUgPSBcImxrLXJvb20tY29udGFpbmVyXCI7XG4gIHJldHVybiB7IGNsYXNzTmFtZSB9O1xufVxuXG4vLyBzcmMvb2JzZXJ2YWJsZXMvdHJhY2sudHNcbmltcG9ydCB7IFJvb21FdmVudCBhcyBSb29tRXZlbnQ0LCBUcmFja0V2ZW50IH0gZnJvbSBcImxpdmVraXQtY2xpZW50XCI7XG5pbXBvcnQgeyBtYXAgYXMgbWFwNywgT2JzZXJ2YWJsZSBhcyBPYnNlcnZhYmxlNCwgc3RhcnRXaXRoIGFzIHN0YXJ0V2l0aDUgfSBmcm9tIFwicnhqc1wiO1xuZnVuY3Rpb24gdHJhY2tPYnNlcnZhYmxlKHRyYWNrKSB7XG4gIGNvbnN0IHRyYWNrT2JzZXJ2ZXIgPSBvYnNlcnZlVHJhY2tFdmVudHMoXG4gICAgdHJhY2ssXG4gICAgVHJhY2tFdmVudC5NdXRlZCxcbiAgICBUcmFja0V2ZW50LlVubXV0ZWQsXG4gICAgVHJhY2tFdmVudC5TdWJzY3JpYmVkLFxuICAgIFRyYWNrRXZlbnQuVW5zdWJzY3JpYmVkXG4gICk7XG4gIHJldHVybiB0cmFja09ic2VydmVyO1xufVxuZnVuY3Rpb24gb2JzZXJ2ZVRyYWNrRXZlbnRzKHRyYWNrLCAuLi5ldmVudHMpIHtcbiAgY29uc3Qgb2JzZXJ2YWJsZSA9IG5ldyBPYnNlcnZhYmxlNCgoc3Vic2NyaWJlKSA9PiB7XG4gICAgY29uc3Qgb25UcmFja1VwZGF0ZSA9ICgpID0+IHtcbiAgICAgIHN1YnNjcmliZS5uZXh0KHRyYWNrKTtcbiAgICB9O1xuICAgIGV2ZW50cy5mb3JFYWNoKChldnQpID0+IHtcbiAgICAgIHRyYWNrLm9uKGV2dCwgb25UcmFja1VwZGF0ZSk7XG4gICAgfSk7XG4gICAgY29uc3QgdW5zdWJzY3JpYmUgPSAoKSA9PiB7XG4gICAgICBldmVudHMuZm9yRWFjaCgoZXZ0KSA9PiB7XG4gICAgICAgIHRyYWNrLm9mZihldnQsIG9uVHJhY2tVcGRhdGUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gdW5zdWJzY3JpYmU7XG4gIH0pLnBpcGUoc3RhcnRXaXRoNSh0cmFjaykpO1xuICByZXR1cm4gb2JzZXJ2YWJsZTtcbn1cbmZ1bmN0aW9uIGdldFRyYWNrUmVmZXJlbmNlcyhyb29tLCBzb3VyY2VzLCBvbmx5U3Vic2NyaWJlZFRyYWNrcyA9IHRydWUpIHtcbiAgY29uc3QgbG9jYWxQYXJ0aWNpcGFudCA9IHJvb20ubG9jYWxQYXJ0aWNpcGFudDtcbiAgY29uc3QgYWxsUGFydGljaXBhbnRzID0gW2xvY2FsUGFydGljaXBhbnQsIC4uLkFycmF5LmZyb20ocm9vbS5wYXJ0aWNpcGFudHMudmFsdWVzKCkpXTtcbiAgY29uc3QgdHJhY2tSZWZlcmVuY2VzID0gW107XG4gIGFsbFBhcnRpY2lwYW50cy5mb3JFYWNoKChwYXJ0aWNpcGFudCkgPT4ge1xuICAgIHNvdXJjZXMuZm9yRWFjaCgoc291cmNlKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VSZWZlcmVuY2VzID0gQXJyYXkuZnJvbShcbiAgICAgICAgcGFydGljaXBhbnQudHJhY2tzLnZhbHVlcygpXG4gICAgICApLmZpbHRlcihcbiAgICAgICAgKHRyYWNrKSA9PiB0cmFjay5zb3VyY2UgPT09IHNvdXJjZSAmJiAvLyBlaXRoZXIgcmV0dXJuIGFsbCBvciBvbmx5IHRoZSBvbmVzIHRoYXQgYXJlIHN1YnNjcmliZWRcbiAgICAgICAgKCFvbmx5U3Vic2NyaWJlZFRyYWNrcyB8fCB0cmFjay50cmFjaylcbiAgICAgICkubWFwKCh0cmFjaykgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHBhcnRpY2lwYW50LFxuICAgICAgICAgIHB1YmxpY2F0aW9uOiB0cmFjayxcbiAgICAgICAgICBzb3VyY2U6IHRyYWNrLnNvdXJjZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB0cmFja1JlZmVyZW5jZXMucHVzaCguLi5zb3VyY2VSZWZlcmVuY2VzKTtcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiB7IHRyYWNrUmVmZXJlbmNlcywgcGFydGljaXBhbnRzOiBhbGxQYXJ0aWNpcGFudHMgfTtcbn1cbmZ1bmN0aW9uIHRyYWNrUmVmZXJlbmNlc09ic2VydmFibGUocm9vbSwgc291cmNlcywgb3B0aW9ucykge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCBhZGRpdGlvbmFsUm9vbUV2ZW50cyA9IChfYSA9IG9wdGlvbnMuYWRkaXRpb25hbFJvb21FdmVudHMpICE9IG51bGwgPyBfYSA6IGFsbFBhcnRpY2lwYW50Um9vbUV2ZW50cztcbiAgY29uc3Qgb25seVN1YnNjcmliZWRUcmFja3MgPSAoX2IgPSBvcHRpb25zLm9ubHlTdWJzY3JpYmVkKSAhPSBudWxsID8gX2IgOiB0cnVlO1xuICBjb25zdCByb29tRXZlbnRzID0gQXJyYXkuZnJvbShcbiAgICAoLyogQF9fUFVSRV9fICovIG5ldyBTZXQoW1xuICAgICAgUm9vbUV2ZW50NC5QYXJ0aWNpcGFudENvbm5lY3RlZCxcbiAgICAgIFJvb21FdmVudDQuUGFydGljaXBhbnREaXNjb25uZWN0ZWQsXG4gICAgICBSb29tRXZlbnQ0LkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQsXG4gICAgICBSb29tRXZlbnQ0LkxvY2FsVHJhY2tQdWJsaXNoZWQsXG4gICAgICBSb29tRXZlbnQ0LkxvY2FsVHJhY2tVbnB1Ymxpc2hlZCxcbiAgICAgIFJvb21FdmVudDQuVHJhY2tQdWJsaXNoZWQsXG4gICAgICBSb29tRXZlbnQ0LlRyYWNrVW5wdWJsaXNoZWQsXG4gICAgICBSb29tRXZlbnQ0LlRyYWNrU3Vic2NyaXB0aW9uU3RhdHVzQ2hhbmdlZCxcbiAgICAgIC4uLmFkZGl0aW9uYWxSb29tRXZlbnRzXG4gICAgXSkpLnZhbHVlcygpXG4gICk7XG4gIGNvbnN0IG9ic2VydmFibGUgPSBvYnNlcnZlUm9vbUV2ZW50cyhyb29tLCAuLi5yb29tRXZlbnRzKS5waXBlKFxuICAgIG1hcDcoKHJvb20yKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gZ2V0VHJhY2tSZWZlcmVuY2VzKHJvb20yLCBzb3VyY2VzLCBvbmx5U3Vic2NyaWJlZFRyYWNrcyk7XG4gICAgICBsb2cuZGVidWcoYFRyYWNrUmVmZXJlbmNlW10gd2FzIHVwZGF0ZWQuIChsZW5ndGggJHtkYXRhLnRyYWNrUmVmZXJlbmNlcy5sZW5ndGh9KWAsIGRhdGEpO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSksXG4gICAgc3RhcnRXaXRoNShnZXRUcmFja1JlZmVyZW5jZXMocm9vbSwgc291cmNlcywgb25seVN1YnNjcmliZWRUcmFja3MpKVxuICApO1xuICByZXR1cm4gb2JzZXJ2YWJsZTtcbn1cblxuLy8gc3JjL29ic2VydmFibGVzL2RvbS1ldmVudC50c1xuaW1wb3J0IHsgY29uY2F0IGFzIGNvbmNhdDIsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmcm9tRXZlbnQsIG1hcCBhcyBtYXA4LCBvZiwgc2tpcFVudGlsLCB0aW1lb3V0IH0gZnJvbSBcInJ4anNcIjtcbmZ1bmN0aW9uIGNyZWF0ZUludGVyYWN0aW5nT2JzZXJ2YWJsZShodG1sRWxlbWVudCwgaW5hY3RpdmVBZnRlciA9IDFlMykge1xuICBpZiAoaHRtbEVsZW1lbnQgPT09IG51bGwpXG4gICAgcmV0dXJuIG9mKGZhbHNlKTtcbiAgY29uc3QgbW92ZSQgPSBmcm9tRXZlbnQoaHRtbEVsZW1lbnQsIFwibW91c2Vtb3ZlXCIsIHsgcGFzc2l2ZTogdHJ1ZSB9KS5waXBlKG1hcDgoKCkgPT4gdHJ1ZSkpO1xuICBjb25zdCBtb3ZlQW5kU3RvcCQgPSBtb3ZlJC5waXBlKFxuICAgIHRpbWVvdXQoe1xuICAgICAgZWFjaDogaW5hY3RpdmVBZnRlcixcbiAgICAgIHdpdGg6ICgpID0+IGNvbmNhdDIob2YoZmFsc2UpLCBtb3ZlQW5kU3RvcCQucGlwZShza2lwVW50aWwobW92ZSQpKSlcbiAgICB9KSxcbiAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXG4gICk7XG4gIHJldHVybiBtb3ZlQW5kU3RvcCQ7XG59XG5leHBvcnQge1xuICBEYXRhVG9waWMsXG4gIEdSSURfTEFZT1VUUyxcbiAgUElOX0RFRkFVTFRfU1RBVEUsXG4gIFdJREdFVF9ERUZBVUxUX1NUQVRFLFxuICBhY3RpdmVTcGVha2VyT2JzZXJ2ZXIsXG4gIGFsbFBhcnRpY2lwYW50RXZlbnRzLFxuICBhbGxQYXJ0aWNpcGFudFJvb21FdmVudHMsXG4gIGFsbFJlbW90ZVBhcnRpY2lwYW50RXZlbnRzLFxuICBhbGxSZW1vdGVQYXJ0aWNpcGFudFJvb21FdmVudHMsXG4gIGF0dGFjaElmU3Vic2NyaWJlZCxcbiAgY29tcHV0ZU1lbnVQb3NpdGlvbixcbiAgY29ubmVjdGVkUGFydGljaXBhbnRPYnNlcnZlcixcbiAgY29ubmVjdGVkUGFydGljaXBhbnRzT2JzZXJ2ZXIsXG4gIGNvbm5lY3Rpb25TdGF0ZU9ic2VydmVyLFxuICBjcmVhdGVBY3RpdmVEZXZpY2VPYnNlcnZhYmxlLFxuICBjcmVhdGVDb25uZWN0aW9uUXVhbGl0eU9ic2VydmVyLFxuICBjcmVhdGVEYXRhT2JzZXJ2ZXIsXG4gIGNyZWF0ZURlZmF1bHRHcmFtbWFyLFxuICBjcmVhdGVFbWFpbFJlZ0V4cCxcbiAgY3JlYXRlSW50ZXJhY3RpbmdPYnNlcnZhYmxlLFxuICBjcmVhdGVJc1NwZWFraW5nT2JzZXJ2ZXIsXG4gIGNyZWF0ZU1lZGlhRGV2aWNlT2JzZXJ2ZXIsXG4gIGNyZWF0ZVRyYWNrT2JzZXJ2ZXIsXG4gIGNyZWF0ZVVybFJlZ0V4cCxcbiAgY3NzUHJlZml4LFxuICBlbmNyeXB0aW9uU3RhdHVzT2JzZXJ2YWJsZSxcbiAgZ2V0U2Nyb2xsQmFyV2lkdGgsXG4gIGdldFRyYWNrQnlJZGVudGlmaWVyLFxuICBnZXRUcmFja1JlZmVyZW5jZUlkLFxuICBnZXRUcmFja1JlZmVyZW5jZVNvdXJjZSxcbiAgaXNFcXVhbFRyYWNrUmVmLFxuICBpc0xvY2FsLFxuICBpc01vYmlsZUJyb3dzZXIsXG4gIGlzUGFydGljaXBhbnRTb3VyY2VQaW5uZWQsXG4gIGlzUGFydGljaXBhbnRUcmFja1JlZmVyZW5jZVBpbm5lZCxcbiAgaXNQbGFjZWhvbGRlclJlcGxhY2VtZW50LFxuICBpc1JlbW90ZSxcbiAgaXNTb3VyY2VXaXRPcHRpb25zLFxuICBpc1NvdXJjZXNXaXRoT3B0aW9ucyxcbiAgaXNUcmFja1JlZmVyZW5jZSxcbiAgaXNUcmFja1JlZmVyZW5jZVBpbm5lZCxcbiAgaXNUcmFja1JlZmVyZW5jZVBsYWNlaG9sZGVyLFxuICBpc1dlYixcbiAgbG9nLFxuICBtdXRlZE9ic2VydmVyLFxuICBvYnNlcnZlUGFydGljaXBhbnRFdmVudHMsXG4gIG9ic2VydmVQYXJ0aWNpcGFudE1lZGlhLFxuICBvYnNlcnZlUm9vbUV2ZW50cyxcbiAgb2JzZXJ2ZVRyYWNrRXZlbnRzLFxuICBwYXJ0aWNpcGFudEV2ZW50U2VsZWN0b3IsXG4gIHBhcnRpY2lwYW50SW5mb09ic2VydmVyLFxuICBwYXJ0aWNpcGFudFBlcm1pc3Npb25PYnNlcnZlcixcbiAgcm9vbUF1ZGlvUGxheWJhY2tBbGxvd2VkT2JzZXJ2YWJsZSxcbiAgcm9vbUV2ZW50U2VsZWN0b3IsXG4gIHJvb21JbmZvT2JzZXJ2ZXIsXG4gIHJvb21PYnNlcnZlcixcbiAgc2NyZWVuU2hhcmVPYnNlcnZlcixcbiAgc2VsZWN0R3JpZExheW91dCxcbiAgc2VuZE1lc3NhZ2UsXG4gIHNldERpZmZlcmVuY2UsXG4gIHNldExvZ0xldmVsLFxuICBzZXR1cENoYXQsXG4gIHNldHVwQ2hhdFRvZ2dsZSxcbiAgc2V0dXBDbGVhclBpbkJ1dHRvbixcbiAgc2V0dXBDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcixcbiAgc2V0dXBEYXRhTWVzc2FnZUhhbmRsZXIsXG4gIHNldHVwRGV2aWNlU2VsZWN0b3IsXG4gIHNldHVwRGlzY29ubmVjdEJ1dHRvbixcbiAgc2V0dXBGb2N1c1RvZ2dsZSxcbiAgc2V0dXBMaXZlS2l0Um9vbSxcbiAgc2V0dXBNYW51YWxUb2dnbGUsXG4gIHNldHVwTWVkaWFUb2dnbGUsXG4gIHNldHVwTWVkaWFUcmFjayxcbiAgc2V0dXBQYXJ0aWNpcGFudE5hbWUsXG4gIHNldHVwUGFydGljaXBhbnRUaWxlLFxuICBzZXR1cFN0YXJ0QXVkaW8sXG4gIHNldHVwVHJhY2tNdXRlZEluZGljYXRvcixcbiAgc29ydFBhcnRpY2lwYW50cyxcbiAgc29ydFRyYWNrUmVmZXJlbmNlcyxcbiAgc3VwcG9ydHNTY3JlZW5TaGFyaW5nLFxuICB0b2tlbml6ZSxcbiAgdHJhY2tPYnNlcnZhYmxlLFxuICB0cmFja1JlZmVyZW5jZXNPYnNlcnZhYmxlLFxuICB1cGRhdGVQYWdlcyxcbiAgd2FzQ2xpY2tPdXRzaWRlXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@livekit+components-core@0.7.0_livekit-client@1.14.4/node_modules/@livekit/components-core/dist/index.mjs\n");

/***/ })

};
;